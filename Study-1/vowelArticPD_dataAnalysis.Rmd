---
title: "A multidimensional study of articulation deficits in Parkinsonâ€™s disease - Data Analysis: Study 1"
---

```{r}
rm(list = ls())
```

# Packages
```{r}
library(tidyverse) # install.packages('tidyverse')
library(emmeans)
library(ggpubr) # install.packages('ggpubr')
library(plyr) # install.packages('plyr')
library(beepr) # install.packages('beepr')
library(plotrix) # install.packages('plotrix')
source('Functions/MSL Tools.R')
```

# Load Data
```{r}
fileInventories <- rio::import(file = "Data/RawData/File Inventories.xlsx") %>%
  dplyr::rename(DatabaseID = `Sub #`,
                dxTime = `Time Since Diagnosis`) %>%
  dplyr::select(DatabaseID, dxTime, MoCA)

listenerRatings <- rio::import(file = "Data/PreppedData/ListenerData/ListenerRatings_allRatings.csv") %>%
  dplyr::filter(ratingType == "Int") %>%
  dplyr::filter(condition == "conv") %>%
  dplyr::group_by(DatabaseID, StudyID) %>%
  dplyr::summarise(Rating_M = mean(Rating, na.rm = T))

speakerList <- rio::import(file = "Data/PreppedData/Speaker List_Clean.csv") %>%
  dplyr::select(!`Folder 2`:`Sentence Repetition`) %>%
  base::merge(., fileInventories) %>%
  base::merge(., listenerRatings) %>%
  
  # Making sure dxTime is numeric
  dplyr::mutate(dxTime = as.numeric(dxTime)) %>%
  
  # Refactoring Sex
  dplyr::mutate(Sex = factor(Sex, 
                             levels = c(
                               "M",
                               "F"
                               ),
                             labels = c(
                               "Male Speakers",
                               "Female Speakers"
                             ))) %>%
  
  # Severity-surrogate ratings
  dplyr::mutate(Severity = case_when(
    Group == "HC" ~ "",
    Rating_M > 94 ~ "Normal",
    between(Rating_M, 85, 94.99) ~ "Mild",
    between(Rating_M, 70, 84.99) ~ "Moderate",
    between(Rating_M, 45, 69.99) ~ "Severe",
    Rating_M < 45 ~ "Profound"
  )) %>%
  
  # Removing the MoCA Scores - Not all speakers had them
  dplyr::select(!MoCA)
```


## Listener Descriptions
```{r}
listenerRatings <- rio::import(file = "Data/PreppedData/ListenerData/ListenerRatings_allRatings.csv")

ratingCount <- listenerRatings %>%
  dplyr::group_by(StudyID, ratingType) %>%
  dplyr::summarise(n = NROW(Rating)) %>%
  dplyr::ungroup()

ratingCount %>%
  dplyr::summarise(mean = mean(n),
                   sd = sd(n),
                   min = min(n),
                   max = max(n))

NROW(unique(listenerRatings$ListenerID))

listenerDemo <- rio::import(file = "Data/PreppedData/ListenerData/ListenerDemographics.csv")
NROW(unique(listenerDemo$ListenerID))

# Age and N
listenerDemo %>%
  dplyr::mutate(duration = `Duration (in seconds)`/60) %>%
  #dplyr::group_by(gender) %>%
  dplyr::summarise(age_m = mean(age, na.rm = T),
                   age_sd = sd(age, na.rm = T),
                   min = base::min(age, na.rm = T),
                   max = base::max(age, na.rm = T),
                   N = NROW(age),
                   duration_M = base::mean(duration, na.rm = T),
                   duration_sd = sd(duration, na.rm = T))

listenerDemo %>%
  dplyr::mutate(duration = `Duration (in seconds)`/60) %>%
  dplyr::group_by(gender) %>%
  dplyr::summarise(N = NROW(age))

listenerDemo %>%
  dplyr::mutate(duration = `Duration (in seconds)`/60) %>%
  dplyr::group_by(race) %>%
  dplyr::summarise(N = NROW(race))

listenerDemo %>%
  dplyr::mutate(duration = `Duration (in seconds)`/60) %>%
  dplyr::group_by(ethnicity) %>%
  dplyr::summarise(N = NROW(ethnicity))
```

# APA reporting function
```{r}

apa_lmResults <- function(model, fixedEffect) {
  
coefficients <- summary(model)[["coefficients"]] %>%
  as.data.frame() %>%
  dplyr::rename(
    stdError = `Std. Error`,
    t = `t value`,
    p = `Pr(>|t|)`) %>%
  dplyr::mutate(
    Estimate = round(Estimate, digits = 2),
    #df = round(df, digits = 2),
    t = round(t, digits = 2),
    p = round(p, digits = 3),
  ) %>%
  dplyr::filter(rownames(.) == fixedEffect)

if(coefficients$p < .001) {
  p <- "p<.001"
} else {
  p <- paste0("p=",as.numeric(coefficients$p))
}

df <- as.numeric(model$df.residual)
t <- paste0("t(",df,")=", as.numeric(coefficients$t))

CI_intervals <- stats::confint(model) %>%
  as.data.frame() %>%
  dplyr::mutate(
    ll = round(`2.5 %`, digits = 2),
    ul = round(`97.5 %`, digits = 2),
                ) %>%
  dplyr::select(ll, ul) %>%
  dplyr::filter(rownames(.) == fixedEffect)

CI <- base::paste0("95% CI [",
                  as.numeric(CI_intervals$ll),
                  ", ",
                  as.numeric(CI_intervals$ul),
                  "]")

formula <- paste(t, p, CI, sep = ", ")

return(formula)

rm(coefficients, t, p, CI_intervals, CI)
}

apa_lmeResults <- function(model, fixedEffect) {
  
coefficients <- summary(model)[["coefficients"]] %>%
  as.data.frame() %>%
  dplyr::rename(
    stdError = `Std. Error`,
    t = `t value`,
    p = `Pr(>|t|)`) %>%
  dplyr::mutate(
    Estimate = round(Estimate, digits = 2),
    df = round(df, digits = 2),
    t = round(t, digits = 2),
    p = round(p, digits = 3),
  ) %>%
  dplyr::filter(rownames(.) == fixedEffect)

if(coefficients$p < .001) {
  p <- "p<.001"
} else {
  p <- paste0("p=",as.numeric(coefficients$p))
}

t <- paste0("t(",as.numeric(coefficients$df),")=", as.numeric(coefficients$t))

CI_intervals <- stats::confint(model) %>%
  as.data.frame() %>%
  dplyr::mutate(
    ll = round(`2.5 %`, digits = 2),
    ul = round(`97.5 %`, digits = 2),
                ) %>%
  dplyr::select(ll, ul) %>%
  dplyr::filter(rownames(.) == fixedEffect)

CI <- base::paste0("95% CI [",
                  as.numeric(CI_intervals$ll),
                  ", ",
                  as.numeric(CI_intervals$ul),
                  "]")

formula <- paste(t, p, CI, sep = ", ")

return(formula)

rm(coefficients, t, p, CI_intervals, CI)
}

apa_levelDescriptives <- function(data,level, outcome) {

  
descriptiveData <- modelData %>%
  dplyr::select(Group, Sex, sym(outcome)) %>%
  dplyr::rename(outcome = 3)

group <- descriptiveData %>%
  dplyr::group_by(Group) %>%
  dplyr::summarize(M = mean(outcome, na.rm = T),
                SD = sd(outcome, na.rm = T),
                .groups = 'drop') %>%
  dplyr::mutate(M = round(M, digits = 2),
                SD = round(SD, digits = 2)) %>%
  dplyr::rename(Grouping = 1) %>%
  as.data.frame()

sex <- descriptiveData %>%
  dplyr::group_by(Sex) %>%
  dplyr::summarize(M = mean(outcome, na.rm = T),
                SD = sd(outcome, na.rm = T),
                .groups = 'drop') %>%
  dplyr::mutate(M = round(M, digits = 2),
                SD = round(SD, digits = 2)) %>%
  dplyr::rename(Grouping = 1) %>%
  as.data.frame()

groupSex <- descriptiveData %>%
  dplyr::group_by(Group, Sex) %>%
  dplyr::summarize(M = mean(outcome, na.rm = T),
                SD = sd(outcome, na.rm = T),
                .groups = 'drop') %>%
  dplyr::ungroup() %>%
  dplyr::mutate(M = round(M, digits = 2),
                SD = round(SD, digits = 2),
                Grouping = paste(Group, Sex, sep = "_")) %>%
  dplyr::select(Grouping, M, SD) %>%
  as.data.frame()

descriptives <- rbind(group,
                      sex,
                      groupSex) %>%
  dplyr::filter(Grouping == level)
  
  output <- paste0(level,": (M=",descriptives$M,", SD=",descriptives$SD,")")
  
  return(output)
  
  rm(descriptives, group, sex, groupSex)
  
}


apa_emmsPairs <- function(emmsPair, sex, Condition) {
  summary_table <- summary(emmsPair, infer = TRUE) %>%
    dplyr::filter(Sex == sex) %>%
    dplyr::filter(condition == condition)
  
if(summary_table$p.value < .001) {
  p <- "p < .001"
} else {
    p <- paste0("p=",
                round(summary_table$p.value, digits = 3))
  }
  
  if("t.ratio" %in% colnames(summary_table)) {
  output <- paste(
    sex,
    ", HC - PD: (",
    "t(",
    round(summary_table$df, digits = 2),
    ")=",
    as.numeric(round(summary_table$t.ratio, 2)),
    ", ",
    p,
    ")",
    sep = "")
  }
  
  
  if("z.ratio" %in% colnames(summary_table)) {
  output <- paste(
    sex,
    ", HC - PD: (",
    "z = (",
    as.numeric(round(summary_table$z.ratio, 2)),
    ", ",
    p,
    ")",
    sep = "")
  }
  
  return(output)
}

apa_s1_emmPairs <- function(emmsPair, sex, Condition) {
  summary_table <- summary(emmsPair, infer = TRUE) %>%
    dplyr::filter(Sex == sex) %>%
    dplyr::filter(condition == Condition)
  
  if(summary_table$p.value < .001) {
  p <- "p<.001"
} else {
    p <- paste0("p=",
                round(summary_table$p.value, digits = 3))
  }
  
  if("t.ratio" %in% colnames(summary_table)) {
  output <- paste(
    sex,
    ", HC - PD: (",
    "t(",
    round(summary_table$df, digits = 2),
    ")=",
    as.numeric(round(summary_table$t.ratio, 2)),
    ", ",
    p,
    ")",
    sep = "")
  }
  
  
  if("z.ratio" %in% colnames(summary_table)) {
  output <- paste(
    sex,
    ", HC - PD: (",
    "z=",
    as.numeric(round(summary_table$z.ratio, 2)),
    ", ",
    p,
    ")",
    sep = "")
  }
  
  return(output)
}

apa_s2_emmPairs <- function(emmsPair, Sex_Input, Group_Input, Contrast_Input) {
  summary_table <- summary(emmsPair, infer = TRUE) %>%
    dplyr::filter(Sex == Sex_Input) %>%
    dplyr::filter(Group == Group_Input) %>%
    dplyr::filter(contrast == Contrast_Input)
  
  if(summary_table$p.value < .001) {
  p <- "p<.001"
} else {
    p <- paste0("p=",
                round(summary_table$p.value, digits = 3))
  }
  
  if("t.ratio" %in% colnames(summary_table)) {
  output <- paste(
    Sex_Input,
    ", ",
    Group_Input,
    ", ",
    Contrast_Input,
    ": (",
    "t(",
    round(summary_table$df, digits = 2),
    ")=",
    as.numeric(round(summary_table$t.ratio, 2)),
    ", ",
    p,
    ")",
    sep = "")
  }
  
  
  if("z.ratio" %in% colnames(summary_table)) {
  output <- paste(
    Sex_Input,
    ", ",
    Group_Input,
    ", ",
    Contrast_Input,
    ": (",
    "z=",
    as.numeric(round(summary_table$z.ratio, 2)),
    ", ",
    p,
    ")",
    sep = "")
  }
  
  return(output)
}



```

# Study 1
The first study examines group differences between PD and HC for the following measures:
(1) Intelligibility
(2) Articulatory Precision
(3) Acoustic Distance
(4) Kinematic Distance (TB Displacement)
(5) Acoustic VSA
(6) Kinematic VSA
(7) F2 Slope
(8) Kinematic Speed (TB Peak Speed)

Alpha will be evaluated at the bonferonni corrected level of 0.0055.
```{r}
alpha_s1 <- .05/5

# Prepping the model folders to be saved
dir.create(path = "Models/",showWarnings = F)
```

## Perceptual Measures
### 1. Intelligibility
```{r}
perceptualMeasures <- rio::import(file = "Data/PreppedData/ListenerData/ListenerRatings_allRatings.csv") %>%
  dplyr::select(!V1) %>%
  dplyr::filter(ratingType == "Int") %>%
  dplyr::rename(Int = Rating) %>%
  dplyr::mutate(Sex = factor(Sex, levels = c("M","F")),
                condition = factor(condition,
                                   levels = c("conv",
                                              "moreClear",
                                              "lessClear")))

modelData <- perceptualMeasures

# Taking out the trash
rm(perceptualMeasures)
```

M0 - Fully unconditional model
```{r}
# Building the model
Int_m0 <- lmerTest::lmer(Int ~ 1 +
                           (1 | ListenerID) +
                           (1 | StudyID),
                         data = modelData)
# Model summary
summary(Int_m0)

```

M1 - Condition
```{r}
# Building the model
Int_m1 <- lmerTest::lmer(Int ~ condition +
                           (1 | ListenerID) +
                           (1 | StudyID),
                         data = modelData)
# Model summary
summary(Int_m1)

# Perform likelihood ratio test
anova(Int_m0, Int_m1)

```
M2 - Condition*Group
```{r}
# Building the model
Int_m2 <- lmerTest::lmer(Int ~ 
                           condition*Group +
                           (1 | ListenerID) +
                           (1 | StudyID),
                         data = modelData)
# Model summary
summary(Int_m2)

# Perform likelihood ratio test
anova(Int_m1, Int_m2)
```

M3 - Condition*Group*Sex
```{r}
# Building the model
Int_m3 <- lmerTest::lmer(Int ~ condition*Group*Sex +
                           (1 | ListenerID) +
                           (1 | StudyID),
                         data = modelData)
# Model summary
summary(Int_m3)

# Perform likelihood ratio test
anova(Int_m2, Int_m3)

```

#### Final Model
```{r}
Int_finalModel <- Int_m3

summary(Int_finalModel)

# Saving the model
base::saveRDS(
  object = Int_finalModel,
  file = "Study-1/Models/Int_finalModel.rds")

# Taking out the trash
rm(list=ls(pattern="^Int_m"))
rm(list=ls(pattern="^emms_"))
rm(modelData)
```

### 2. Articulatory Precision
```{r}
perceptualMeasures <- rio::import(file = "Data/PreppedData/ListenerData/ListenerRatings_allRatings.csv") %>%
  dplyr::select(!V1) %>%
  #dplyr::filter(condition == "conv") %>%
  dplyr::filter(ratingType == "AP") %>%
  dplyr::rename(AP = Rating) %>%
  dplyr::mutate(Sex = factor(Sex, levels = c("M","F")),
                condition = factor(condition,
                                   levels = c("conv",
                                              "moreClear",
                                              "lessClear")))

modelData <- perceptualMeasures

# Taking out the trash
rm(perceptualMeasures)
```

M0 - Fully unconditional model
```{r}
# Building the model
AP_m0 <- lmerTest::lmer(AP ~ 1 +
                           (1 | ListenerID) +
                           (1 | StudyID),
                         data = modelData)
# Model summary
summary(AP_m0)

```

M1 - Condition
```{r}
# Building the model
AP_m1 <- lmerTest::lmer(AP ~ condition +
                           (1 | ListenerID) +
                           (1 | StudyID),
                         data = modelData)
# Model summary
summary(AP_m1)

# Perform likelihood ratio test
anova(AP_m0, AP_m1)

```

M2 - Condition*Group
```{r}
# Building the model
AP_m2 <- lmerTest::lmer(AP ~
                           condition*Group +
                           (1 | ListenerID) +
                           (1 | StudyID),
                         data = modelData)
# Model summary
summary(AP_m2)

# Perform likelihood ratio test
anova(AP_m1, AP_m2)

```

M3 - Condition*Group*Sex
```{r}
# Building the model
AP_m3 <- lmerTest::lmer(AP ~ condition*Group*Sex +
                           (1 | ListenerID) +
                           (1 | StudyID),
                         data = modelData)
# Model summary
summary(AP_m3)

# Perform likelihood ratio test
anova(AP_m2, AP_m3)
```

#### Final Model
```{r}
AP_finalModel <- AP_m3

summary(AP_finalModel)

# Saving the model
base::saveRDS(
  object = AP_finalModel,
  file = "Study-1/Models/AP_finalModel.rds")

# Taking out the trash
rm(list=ls(pattern="^AP_m"))
rm(list=ls(pattern="^emms"))
rm(modelData)
```

## Acoustic Measures

### 3. aVSA
```{r}
vsaMeasures <- rio::import(file = "Data/PreppedData/CollatedData/TargetMeasures_vsaMeasures.csv") %>%
  #dplyr::filter(condition == "conv") %>%
  dplyr::mutate(Sex = factor(Sex, levels = c("M","F")),
                condition = factor(condition,
                                   levels = c("conv",
                                              "moreClear",
                                              "lessClear")),
                aVSA = aVSA/1000)

modelData <- vsaMeasures

# Taking out the trash
rm(vsaMeasures)
```

M0 - Fully unconditional model
```{r}
# Building the model
aVSA_m0 <- lmerTest::lmer(aVSA ~ 1 +
                       (1 | StudyID),
                     data = modelData)

# Model summary
summary(aVSA_m0)

```

M1 - Condition
```{r}
# Building the model
aVSA_m1 <- lmerTest::lmer(aVSA ~ condition +
                       (1 | StudyID),
                     data = modelData)
# Model summary
summary(aVSA_m1)

# Perform likelihood ratio test
anova(aVSA_m0, aVSA_m1)

```
M2 - Condition*Group
```{r}
# Building the model
aVSA_m2 <- lmerTest::lmer(aVSA ~ condition*Group +
                       (1 | StudyID),
                     data = modelData)
# Model summary
summary(aVSA_m2)

# Perform likelihood ratio test
anova(aVSA_m1, aVSA_m2)
```

M3 - Condition*Group*Sex
```{r}
# Building the model
aVSA_m3 <- lmerTest::lmer(aVSA ~ condition*Group*Sex +
                       (1 | StudyID),
                     data = modelData)
# Model summary
summary(aVSA_m3)

# Perform likelihood ratio test
anova(aVSA_m2, aVSA_m3)
```

#### Final Model
```{r}
aVSA_finalModel <- aVSA_m3
summary(aVSA_finalModel)

# Saving the model
base::saveRDS(
  object = aVSA_finalModel,
  file = "Study-1/Models/aVSA_finalModel.rds")

# Taking out the trash
rm(list=ls(pattern="^aVSA_m"))
rm(list=ls(pattern="^emms"))
rm(modelData)
```
### 4. Aco Distance
```{r}
aiMeasures <- rio::import(file = "Data/PreppedData/CollatedData/TargetMeasures_aiMeasures.csv") %>%
  #dplyr::filter(condition == "conv") %>%
  dplyr::mutate(Sex = factor(Sex, levels = c("M","F")),
                condition = factor(condition,
                                   levels = c("conv",
                                              "moreClear",
                                              "lessClear")))

modelData <- aiMeasures

# Taking out the trash
rm(aiMeasures)
```

M0 - Fully unconditional model
```{r}
# Building the model
acoDistance_m0 <- lmerTest::lmer(acoDistance ~ 1 +
                           (1 | StudyID),
                         data = modelData)
# Model summary
summary(acoDistance_m0)

```

M1 - Condition
```{r}
# Building the model
acoDistance_m1 <- lmerTest::lmer(acoDistance ~ condition +
                           (1 | StudyID),
                         data = modelData)
# Model summary
summary(acoDistance_m1)

# Perform likelihood ratio test
anova(acoDistance_m0, acoDistance_m1)

```
M2 - condition*Group
```{r}
# Building the model
acoDistance_m2 <- lmerTest::lmer(acoDistance ~ condition*Group +
                           (1 | StudyID),
                         data = modelData)
# Model summary
summary(acoDistance_m2)

# Perform likelihood ratio test
anova(acoDistance_m1, acoDistance_m2)
```

M3 - Condition*Group*Sex
```{r}
# Building the model
acoDistance_m3 <- lmerTest::lmer(acoDistance ~ condition*Group*Sex +
                           (1 | StudyID),
                         data = modelData)
# Model summary
summary(acoDistance_m3)

# Perform likelihood ratio test
anova(acoDistance_m2, acoDistance_m3)
```

#### Final Model
```{r}
acoDistance_finalModel <- acoDistance_m3
summary(acoDistance_finalModel)

# Saving the model
base::saveRDS(
  object = acoDistance_finalModel,
  file = "Study-1/Models/acoDistance_finalModel.rds")

# Taking out the trash
rm(list=ls(pattern="^acoDistance_m"))
rm(list=ls(pattern="^emms"))
rm(modelData)
```

### 5. F2 Slope
```{r}
aiMeasures <- rio::import(file = "Data/PreppedData/CollatedData/TargetMeasures_aiMeasures.csv")  %>%
  dplyr::mutate(Sex = factor(Sex, levels = c("M","F")),
                condition = factor(condition,
                                   levels = c("conv",
                                              "moreClear",
                                              "lessClear")))

modelData <- aiMeasures

# Taking out the trash
rm(aiMeasures)
```

M0 - Fully unconditional model
```{r}
# Building the model
F2_Slope_m0 <- lmerTest::lmer(F2_Slope ~ 1 +
                           (1 | StudyID),
                         data = modelData)
# Model summary
summary(F2_Slope_m0)

```

M1 - condition
```{r}
# Building the model
F2_Slope_m1 <- lmerTest::lmer(F2_Slope ~ condition +
                           (1 | StudyID),
                         data = modelData)
# Model summary
summary(F2_Slope_m1)

# Perform likelihood ratio test
anova(F2_Slope_m0, F2_Slope_m1)
```
M2 - condition*Group
```{r}
# Building the model
F2_Slope_m2 <- lmerTest::lmer(F2_Slope ~ condition*Group +
                           (1 | StudyID),
                         data = modelData)
# Model summary
summary(F2_Slope_m2)

# Perform likelihood ratio test
anova(F2_Slope_m1, F2_Slope_m2)

```

M3 - Condition*Group*Sex
```{r}
# Building the model
F2_Slope_m3 <- lmerTest::lmer(F2_Slope ~ condition*Group*Sex +
                           (1 | StudyID),
                         data = modelData)
# Model summary
summary(F2_Slope_m3)

# Perform likelihood ratio test
anova(F2_Slope_m2, F2_Slope_m3)
```

#### Final Model
```{r}
F2_Slope_finalModel <- F2_Slope_m3
summary(F2_Slope_finalModel)

# Saving the model
base::saveRDS(
  object = F2_Slope_finalModel,
  file = "Study-1/Models/F2_Slope_finalModel.rds")

# Taking out the trash
rm(list=ls(pattern="^F2_Slope_m"))
rm(list=ls(pattern="^emms"))
rm(modelData)
```


## Kinematic Measures
### 6. kVSA

```{r}
vsaMeasures <- rio::import(file = "Data/PreppedData/CollatedData/TargetMeasures_vsaMeasures.csv")  %>%
  dplyr::mutate(Sex = factor(Sex, levels = c("M","F")),
                condition = factor(condition,
                                   levels = c("conv",
                                              "moreClear",
                                              "lessClear")))

modelData <- vsaMeasures

# Taking out the trash
rm(vsaMeasures)
```

M0 - Fully unconditional model
```{r}
# Building the model
kVSA_m0 <- stats::lm(kVSA ~ 1,
                     data = modelData)
# Model summary
summary(kVSA_m0)

```

M1 - Group
```{r}
# Building the model
kVSA_m1 <- stats::lm(kVSA ~ condition,
                         data = modelData)
# Model summary
summary(kVSA_m1)

# Perform likelihood ratio test
anova(kVSA_m0, kVSA_m1)
```
M2 - Condition*Group
```{r}
# Building the model
kVSA_m2 <- stats::lm(kVSA ~ condition*Group,
                         data = modelData)
# Model summary
summary(kVSA_m2)

# Perform likelihood ratio test
anova(kVSA_m1, kVSA_m2)
```

M3 - Condition*Group*Sex
```{r}
# Building the model
kVSA_m3 <- lmerTest::lmer(kVSA ~ condition*Group*Sex +
                            (1|StudyID),
                         data = modelData)
# Model summary
summary(kVSA_m3)

# Perform likelihood ratio test
anova(kVSA_m2, kVSA_m3)

```

#### Final Model
```{r}
kVSA_finalModel <- kVSA_m3
summary(kVSA_finalModel)

# Saving the model
base::saveRDS(
  object = kVSA_finalModel,
  file = "Study-1/Models/kVSA_finalModel.rds")

# Taking out the trash
rm(list=ls(pattern="^kVSA_m"))
rm(list=ls(pattern="^emms"))
rm(modelData)
```

### 7. Kin Distance
```{r}
aiMeasures <- rio::import(file = "Data/PreppedData/CollatedData/TargetMeasures_aiMeasures.csv")  %>%
  dplyr::mutate(Sex = factor(Sex, levels = c("M","F")),
                condition = factor(condition,
                                   levels = c("conv",
                                              "moreClear",
                                              "lessClear")))

modelData <- aiMeasures

# Taking out the trash
rm(aiMeasures)
```

M0 - Fully unconditional model
```{r}
# Building the model
kinDistance_m0 <- lmerTest::lmer(kinDistance ~ 1 +
                           (1 | StudyID),
                         data = modelData)
# Model summary
summary(kinDistance_m0)

```

M1 - Condition
```{r}
# Building the model
kinDistance_m1 <- lmerTest::lmer(kinDistance ~ condition +
                           (1 | StudyID),
                         data = modelData)
# Model summary
summary(kinDistance_m1)

# Perform likelihood ratio test
anova(kinDistance_m0, kinDistance_m1)

```
M2 - Condition*Group
```{r}
# Building the model
kinDistance_m2 <- lmerTest::lmer(kinDistance ~ condition*Group +
                           (1 | StudyID),
                         data = modelData)
# Model summary
summary(kinDistance_m2)

# Perform likelihood ratio test
anova(kinDistance_m1, kinDistance_m2)
```

M3 - Condition*Group*Sex
```{r}
# Building the model
kinDistance_m3 <- lmerTest::lmer(kinDistance ~ condition*Group*Sex +
                           (1 | StudyID),
                         data = modelData)
# Model summary
summary(kinDistance_m3)

# Perform likelihood ratio test
anova(kinDistance_m2, kinDistance_m3)

```

#### Final Model
```{r}
kinDistance_finalModel <- kinDistance_m3

summary(kinDistance_finalModel)

# Saving the model
base::saveRDS(
  object = kinDistance_finalModel,
  file = "Study-1/Models/kinDistance_finalModel.rds")

# Taking out the trash
rm(list=ls(pattern="^kinDistance_m"))
rm(list=ls(pattern="^emms"))
rm(modelData)
```

### 8. TB Speed Max
```{r}
aiMeasures <- rio::import(file = "Data/PreppedData/CollatedData/TargetMeasures_aiMeasures.csv")  %>%
  dplyr::mutate(Sex = factor(Sex, levels = c("M","F")),
                condition = factor(condition,
                                   levels = c("conv",
                                              "moreClear",
                                              "lessClear")))

modelData <- aiMeasures

# Taking out the trash
rm(aiMeasures)
```

M0 - Fully unconditional model
```{r}
# Building the model
TB_speedMax_m0 <- lmerTest::lmer(TB_speedMax ~ 1 +
                           (1 | StudyID),
                         data = modelData)
# Model summary
summary(TB_speedMax_m0)

```

M1 - Condition
```{r}
# Building the model
TB_speedMax_m1 <- lmerTest::lmer(TB_speedMax ~ condition +
                           (1 | StudyID),
                         data = modelData)
# Model summary
summary(TB_speedMax_m1)

# Perform likelihood ratio test
anova(TB_speedMax_m0, TB_speedMax_m1)

```
M2 - Condition*Group
```{r}
# Building the model
TB_speedMax_m2 <- lmerTest::lmer(TB_speedMax ~ condition*Group +
                           (1 | StudyID),
                         data = modelData)
# Model summary
summary(TB_speedMax_m2)

# Perform likelihood ratio test
anova(TB_speedMax_m1, TB_speedMax_m2)
```

M3 - Condition*Group*Sex
```{r}
# Building the model
TB_speedMax_m3 <- lmerTest::lmer(TB_speedMax ~ condition*Group*Sex +
                           (1 | StudyID),
                         data = modelData)
# Model summary
summary(TB_speedMax_m3)

# Perform likelihood ratio test
anova(TB_speedMax_m2, TB_speedMax_m3)
```

#### Final Model
```{r}
TB_speedMax_finalModel <- TB_speedMax_m3
summary(TB_speedMax_finalModel)

# Saving the model
base::saveRDS(
  object = TB_speedMax_finalModel,
  file = "Study-1/Models/TB_speedMax_finalModel.rds")

# Taking out the trash
rm(list=ls(pattern="^dTB_speedMax_m"))
rm(list=ls(pattern="^emms"))
rm(modelData)
```


# Plots - Condition
```{r}
myPal <- rcartocolor::carto_pal(n = 7, name = "Geyser")[c(1, 2, 3, 4, 5, 6, 7)]
color_HC <- myPal[2] 
color_PD <- myPal[6]
```

## 1. Intelligibility
```{r}
model <- base::readRDS("Study-1/Models/Int_finalModel.rds") %>%
  sjPlot::plot_model(type = "int")

plotData <- model[[4]][["data"]] %>%
  as.data.frame() %>%
  dplyr::mutate(
    condition = factor(x,
                       levels = c(3, 1, 2),
                       labels = c("Less\nClear",
                                  "Conv",
                                  "More\nClear")),
    facet = factor(facet,
                   levels = c("M", "F"),
                   labels = c("Male Speakers", "Female Speakers"))) 

lim_y_int <- c(0,
          (base::max(plotData$conf.high) + base::max(plotData$conf.high)*.45))
lim_group_int <- base::max(plotData$conf.high) + base::max(plotData$conf.high)*.10
lim_condition_HC_int <- base::max(plotData$conf.high) + base::max(plotData$conf.high)*.25
lim_condition_PD_int <- base::max(plotData$conf.high) + base::max(plotData$conf.high)*.40


  # Making the Plot
plot_Int <- plotData %>%
  ggplot() +
  aes(y = predicted,
      x = condition) +
  
  # Line
  geom_line(
    aes(color = group,
        group = group),
    position = position_dodge(width = .45),
    alpha = .6,
    ) +
  
  # Error Bars
  geom_errorbar(aes(
    ymin = conf.low,
    ymax = conf.high,
    color = group,
    group = group
    ),
    position = position_dodge(width = .45),
    width = 0,
    ) +
  
  # Point
  geom_point(
    aes(color = group,
        group = group),
    position = position_dodge(width = .45)
    ) +

  # Adding significance bars - HC*Condition ----
  ggsignif::geom_signif(data = data.frame(group = c("Less\nClear",
                                          "Conv",
                                         "More\nClear")),
                        aes(y_position = c(rep(lim_condition_HC_int, 6)),
                            xmin = c(1.1, 2.1, NA, 1.1, 2.1, NA),
                            xmax = c(1.9, 2.9, NA, 1.9, 2.9, NA),
                            annotations = c("*", "*", NA, "*", "*", NA),
                            group=c(1,2,3,4,5,6)),
                        vjust = .5,
                        color = color_HC,
                        tip_length = 0,
                        manual = T) +
  
  # Adding significance bars - PD*Condition ----
  ggsignif::geom_signif(data = data.frame(group = c("Less\nClear",
                                          "Conv",
                                         "More\nClear")),
                        aes(y_position = c(rep(lim_condition_PD_int, 6)),
                            xmin = c(1.1, 2.1, NA, 1.1, 2.1, NA),
                            xmax = c(1.9, 2.9, NA, 1.9, 2.9, NA),
                            annotations = c("*", "*", NA, "*", "*", NA),
                            group=c(1,2,3,4,5,6)),
                        vjust = .5,
                        color = color_PD,
                        tip_length = 0,
                        manual = T) +
  
  # Adding significance bars - Group ----
  ggsignif::geom_signif(data = data.frame(group = c("Less\nClear",
                                          "Conv",
                                         "More\nClear")),
                        aes(y_position = c(rep(lim_group_int, 6)),
                            xmin = c(.9, 1.9, 2.9, NA, NA, NA),
                            xmax = c(1.1, 2.1, 3.1, NA, NA, NA),
                            annotations = c("*", "*", "*", NA, NA, NA),
                            group=c(1,2,3,4,5,6)),
                        vjust = .5,
                        color = "black",
                        tip_length = 0,
                        manual = T) +
  
  # Facet by Sex
  facet_grid(~facet) +
  
  # Changing the y axis scale
  coord_cartesian(ylim = lim_y_int) +
  scale_y_continuous(breaks=c(0, 25, 50, 75, 100),
                     minor_breaks = seq(0,100, (25/2))) +
  
  # Changing the theme, labels, and title
  theme_minimal() +
  labs(y = "VAS Rating",
       color = "Group") +
  ggtitle("Intelligibility") +
  theme(
    aspect.ratio = 1.333333,
    plot.title = element_text(hjust = 0.5),
    #axis.text.x = element_blank(),
    #axis.ticks.x = element_blank(),
    axis.title.x = element_blank(),
    panel.border = element_rect(fill = NA, color = "black")
    ) +
  
  # Color Palate
  scale_color_manual(values = c(color_HC,color_PD)) +
  scale_fill_manual(values = c(color_HC,color_PD))

plot_Int
```

## 2. Articulatory Precision
```{r}
model <- base::readRDS("Study-1/Models/AP_finalModel.rds") %>%
  sjPlot::plot_model(type = "int")

plotData <- model[[4]][["data"]] %>%
  as.data.frame() %>%
  dplyr::mutate(
    condition = factor(x,
                       levels = c(3, 1, 2),
                       labels = c("Less\nClear",
                                  "Conv",
                                  "More\nClear")),
    facet = factor(facet,
                   levels = c("M", "F"),
                   labels = c("Male Speakers", "Female Speakers"))) 

lim_y_AP <- c(0,
          (base::max(plotData$conf.high) + base::max(plotData$conf.high)*.45))
lim_group_AP <- base::max(plotData$conf.high) + base::max(plotData$conf.high)*.10
lim_condition_HC_AP <- base::max(plotData$conf.high) + base::max(plotData$conf.high)*.25
lim_condition_PD_AP <- base::max(plotData$conf.high) + base::max(plotData$conf.high)*.40
  
  # Making the Plot
plot_AP <- plotData %>%
  ggplot() +
  aes(y = predicted,
      x = condition) +
  
  # Line
  geom_line(
    aes(color = group,
        group = group),
    position = position_dodge(width = .45),
    alpha = .6,
    ) +
  
  # Error Bars
  geom_errorbar(aes(
    ymin = conf.low,
    ymax = conf.high,
    color = group,
    group = group
    ),
    position = position_dodge(width = .45),
    width = 0,
    ) +
  
  # Point
  geom_point(
    aes(color = group,
        group = group),
    position = position_dodge(width = .45)
    ) +

  # Adding significance bars - HC*Condition ----
  ggsignif::geom_signif(data = data.frame(Group = c("Less\nClear",
                                          "Conv",
                                         "More\nClear")),
                        aes(y_position = c(rep(lim_condition_HC_AP, 6)),
                            xmin = c(1.1, 2.1, NA, 1.1, NA, NA),
                            xmax = c(1.9, 2.9, NA, 1.9, NA, NA),
                            annotations = c("*", "*", NA, "*", NA, NA),
                            group=c(1,2,3,4,5,6)),
                        vjust = .5,
                        color = color_HC,
                        tip_length = 0,
                        manual = T) +
  
  # Adding significance bars - PD*Condition ----
  ggsignif::geom_signif(data = data.frame(Group = c("Less\nClear",
                                          "Conv",
                                         "More\nClear")),
                        aes(y_position = c(rep(lim_condition_PD_AP, 6)),
                            xmin = c(1.1, 2.1, NA, 1.1, 2.1, NA),
                            xmax = c(1.9, 2.9, NA, 1.9, 2.9, NA),
                            annotations = c("*", "*", NA, "*", "*", NA),
                            group=c(1,2,3,4,5,6)),
                        vjust = .5,
                        color = color_PD,
                        tip_length = 0,
                        manual = T) +
  
  # Adding significance bars - Group ----
  ggsignif::geom_signif(data = data.frame(Group = c("Less\nClear",
                                          "Conv",
                                         "More\nClear")),
                        aes(y_position = c(rep(lim_group_AP, 6)),
                            xmin = c(.9, 1.9, 2.9, NA, NA, NA),
                            xmax = c(1.1, 2.1, 3.1, NA, NA, NA),
                            annotations = c("*", "*", "*", NA, NA, NA),
                            group=c(1,2,3,4,5,6)),
                        vjust = .5,
                        color = "black",
                        tip_length = 0,
                        manual = T) +
  
  # Facet by Sex
  facet_grid(~facet) +
  
  # Changing the y axis scale
  coord_cartesian(ylim = lim_y_AP) +
  scale_y_continuous(breaks=c(0, 25, 50, 75, 100),
                     minor_breaks = seq(0,100, (25/2))) +
  
  # Changing the theme, labels, and title
  theme_minimal() +
  labs(y = "VAS Rating",
       color = "Group") +
  ggtitle("Articulatory Precision") +
  theme(
    aspect.ratio = 1.333333,
    plot.title = element_text(hjust = 0.5),
    #axis.text.x = element_blank(),
    #axis.ticks.x = element_blank(),
    axis.title.x = element_blank(),
    panel.border = element_rect(fill = NA, color = "black"),
    ) +
  
  # Color Palate
  scale_color_manual(values = c(color_HC,color_PD)) +
  scale_fill_manual(values = c(color_HC,color_PD))

plot_AP
```

## 3. Acoustic VSA
```{r}
model <- base::readRDS("Study-1/Models/aVSA_finalModel.rds") %>%
  sjPlot::plot_model(type = "int")

plotData <- model[[4]][["data"]] %>%
  as.data.frame() %>%
  dplyr::mutate(
    condition = factor(x,
                       levels = c(3, 1, 2),
                       labels = c("Less\nClear",
                                  "Conv",
                                  "More\nClear")),
    facet = factor(facet,
                   levels = c("M", "F"),
                   labels = c("Male Speakers", "Female Speakers"))) 

lim_y_aVSA <- c(0,
          (base::max(plotData$conf.high) + base::max(plotData$conf.high)*.45))
lim_group_aVSA <- base::max(plotData$conf.high) + base::max(plotData$conf.high)*.10
lim_condition_HC_aVSA <- base::max(plotData$conf.high) + base::max(plotData$conf.high)*.25
lim_condition_PD_aVSA <- base::max(plotData$conf.high) + base::max(plotData$conf.high)*.40

  
  # Making the Plot
plot_aVSA <- plotData %>%
    ggplot() +
  aes(y = predicted,
      x = condition) +
  
  # Line
  geom_line(
    aes(color = group,
        group = group),
    position = position_dodge(width = .45),
    alpha = .6,
    ) +
  
  # Error Bars
  geom_errorbar(aes(
    ymin = conf.low,
    ymax = conf.high,
    color = group,
    group = group
    ),
    position = position_dodge(width = .45),
    width = 0,
    ) +
  
  # Point
  geom_point(
    aes(color = group,
        group = group),
    position = position_dodge(width = .45)
    ) +
  
  # Adding significance bars - HC*Condition ----
  ggsignif::geom_signif(data = data.frame(Group = c("Less\nClear",
                                          "Conv",
                                         "More\nClear")),
                        aes(y_position = c(rep(lim_condition_HC_aVSA, 6)),
                            xmin = c(1.1, 2.1, NA, 1.1, 2.1, NA),
                            xmax = c(1.9, 2.9, NA, 1.9, 2.9, NA),
                            annotations = c(NA, NA, NA, NA, "*", NA),
                            group=c(1,2,3,4,5,6)),
                        vjust = .5,
                        color = color_HC,
                        tip_length = 0,
                        manual = T) +
  
  # Adding significance bars - Group ----
  ggsignif::geom_signif(data = data.frame(Group = c("Less\nClear",
                                          "Conv",
                                         "More\nClear")),
                        aes(y_position = c(rep(lim_group_aVSA, 6)),
                            xmin = c(.9, 1.9, 2.9, .9, 1.9, 2.9),
                            xmax = c(1.1, 2.1, 3.1, 1.1, 2.1, 3.1),
                            annotations = c(NA, NA, NA, "*", NA, "*"),
                            group=c(1,2,3,4,5,6)),
                        vjust = .5,
                        color = "black",
                        tip_length = 0,
                        manual = T) +
  

  # Facet by Sex
  facet_grid(~facet) +
  
  # Changing the y axis scale
  coord_cartesian(ylim = lim_y_aVSA-65) +
  #scale_y_continuous(breaks=c(0, 25, 50, 75, 100)) +
  
  # Changing the theme, labels, and title
  theme_minimal() +
  labs(y = bquote('Hz'^2),
       color = "Group") +
  ggtitle("Acoustic VSA") +
  theme(
    aspect.ratio = 1.333333,
    plot.title = element_text(hjust = 0.5),
    #axis.text.x = element_blank(),
    #axis.ticks.x = element_blank(),
    axis.title.x = element_blank(),
    panel.border = element_rect(fill = NA, color = "black"),
    legend.position = "none"
    ) +
  
  # Color Palate
  scale_color_manual(values = c(color_HC,color_PD)) +
  scale_fill_manual(values = c(color_HC,color_PD))

plot_aVSA
```


## 4. Acoustic Distance
```{r}
model <- base::readRDS("Study-1/Models/acoDistance_finalModel.rds") %>%
  sjPlot::plot_model(type = "int")

plotData <- model[[4]][["data"]] %>%
  as.data.frame() %>%
  dplyr::mutate(
    condition = factor(x,
                       levels = c(3, 1, 2),
                       labels = c("Less\nClear",
                                  "Conv",
                                  "More\nClear")),
    facet = factor(facet,
                   levels = c("M", "F"),
                   labels = c("Male Speakers", "Female Speakers"))) 

lim_y_aDist <- c(0,
          (base::max(plotData$conf.high) + base::max(plotData$conf.high)*.45))
lim_group_aDist <- base::max(plotData$conf.high) + base::max(plotData$conf.high)*.10
lim_condition_HC_aDist <- base::max(plotData$conf.high) + base::max(plotData$conf.high)*.25
lim_condition_PD_aDist <- base::max(plotData$conf.high) + base::max(plotData$conf.high)*.40
  
  # Making the Plot
plot_acoDistance <- plotData %>%
  ggplot() +
  aes(y = predicted,
      x = condition,
      group = group,
      color = group) +
  
  # Line
  geom_line(
    aes(color = group,
        group = group),
    position = position_dodge(width = .45),
    alpha = .6,
    ) +
  
  # Error Bars
  geom_errorbar(aes(
    ymin = conf.low,
    ymax = conf.high,
    color = group,
    group = group
    ),
    position = position_dodge(width = .45),
    width = 0,
    ) +
  
  # Point
  geom_point(
    aes(color = group,
        group = group),
    position = position_dodge(width = .45)
    ) +
  
  # Adding significance bars - HC*Condition -----
  ggsignif::geom_signif(data = data.frame(Group = c(
    "Less\nClear",
    "Conv",
    "More\nClear")),
    aes(y_position = c(rep(lim_condition_HC_aDist, 6)),
        xmin = c(
          # Male Speakers
          1, # Less Clear -> Conv
          2.1, # Conv -> More Clear
          NA,  # Padding
          # Female Speakers
          1, # Less Clear -> Conv
          2.1, # Conv -> More Clear
          NA), # Padding
        xmax = c(
          # Male Speakers
          1.9, # Less Clear -> Conv
          2.9, # Conv -> More Clear
          NA,  # Padding
          # Female Speakers
          1.9, # Less Clear -> Conv
          2.9, # Conv -> More Clear
          NA), # Padding
        annotations = c(
          # Male Speakers
          NA,  # Less Clear -> Conv
          "*",  # Conv -> More Clear
          NA,  # Padding
          # Female Speakers
          "*",  # Less Clear -> Conv
          "*",  # Conv -> More Clear
          NA), # Padding
        group=c(1,2,3,4,5,6),
        ),
    vjust = .5,
    color = color_HC,
    tip_length = 0,
    manual = T) +
  
  # Adding significance bars - PD*Condition ----
  ggsignif::geom_signif(data = data.frame(Group = c(
    "Less\nClear",
    "Conv",
    "More\nClear")),
    aes(y_position = c(rep(lim_condition_PD_aDist, 6)),
        xmin = c(
          # Male Speakers
          1,   # Less Clear -> Conv
          2.1, # Conv -> More Clear
          NA,  # Padding
          # Female Speakers
          1,   # Less Clear -> Conv
          2.1, # Conv -> More Clear
          NA),  # Padding
        xmax = c(
          # Male Speakers
          1.9, # Less Clear -> Conv
          2.9, # Conv -> More Clear
          NA,  # Padding
          # Female Speakers
          1.9, # Less Clear -> Conv
          2.9, # Conv -> More Clear
          NA), # Padding
        annotations = c(
          # Male Speakers
          NA,  # Less Clear -> Conv
          "*",  # Conv -> More Clear
          NA,  # Padding
          # Female Speakers
          NA,  # Less Clear -> Conv
          "*",  # Conv -> More Clear
          NA), # Padding
        group=c(1,2,3,4,5,6)),
    vjust = .5,
    color = color_PD,
    tip_length = 0,
    manual = T) +
  
  # Facet by Sex ----
  facet_grid(~facet) +
  
  # Changing the y axis scale
  coord_cartesian(ylim = lim_y_aDist) +
  
  # Changing the theme, labels, and title
  theme_minimal() +
  labs(y = "Hz",
       color = "Group") +
  ggtitle("Acoustic Distance") +
  theme(
    aspect.ratio = 1.333333,
    plot.title = element_text(hjust = 0.5),
    #axis.text.x = element_blank(),
    #axis.ticks.x = element_blank(),
    axis.title.x = element_blank(),
    panel.border = element_rect(fill = NA, color = "black"),
    ) +
  
  # Color Palate
  scale_color_manual(values = c(color_HC,color_PD)) +
  scale_fill_manual(values = c(color_HC,color_PD))

plot_acoDistance
```

## 5. F2 Slope
```{r}
model <- base::readRDS("Study-1/Models/F2_Slope_finalModel.rds") %>%
  sjPlot::plot_model(type = "int")

plotData <- model[[4]][["data"]] %>%
  as.data.frame() %>%
  dplyr::mutate(
    condition = factor(x,
                       levels = c(3, 1, 2),
                       labels = c("Less\nClear",
                                  "Conv",
                                  "More\nClear")),
    facet = factor(facet,
                   levels = c("M", "F"),
                   labels = c("Male Speakers", "Female Speakers"))) 

lim_y_F2 <- c(0,
          (base::max(plotData$conf.high) + base::max(plotData$conf.high)*.45))
lim_group_F2 <- base::max(plotData$conf.high) + base::max(plotData$conf.high)*.10
lim_condition_HC_F2 <- base::max(plotData$conf.high) + base::max(plotData$conf.high)*.25
lim_condition_PD_F2 <- base::max(plotData$conf.high) + base::max(plotData$conf.high)*.40
  
  # Making the Plot
plot_F2_Slope <- plotData %>%
  ggplot() +
  aes(y = predicted,
      x = condition,
      group = group,
      color = group) +
  
  # Line
  geom_line(
    aes(color = group,
        group = group),
    position = position_dodge(width = .45),
    alpha = .6,
    ) +
  
  # Error Bars
  geom_errorbar(aes(
    ymin = conf.low,
    ymax = conf.high,
    color = group,
    group = group
    ),
    position = position_dodge(width = .45),
    width = 0,
    ) +
  
  # Point
  geom_point(
    aes(color = group,
        group = group),
    position = position_dodge(width = .45)
    ) +
  
  # Facet by Sex ----
  facet_grid(~facet) +
  
  # Changing the y axis scale
  coord_cartesian(ylim = lim_y_F2) +
  
  # Changing the theme, labels, and title
  theme_minimal() +
  labs(y = "Hz/ms",
       color = "Group") +
  ggtitle("F2 Slope") +
  theme(
    aspect.ratio = 1.333333,
    plot.title = element_text(hjust = 0.5),
    #axis.text.x = element_blank(),
    #axis.ticks.x = element_blank(),
    axis.title.x = element_blank(),
    panel.border = element_rect(fill = NA, color = "black"),
    ) +
  
  # Color Palate
  scale_color_manual(values = c(color_HC,color_PD)) +
  scale_fill_manual(values = c(color_HC,color_PD)) +
  
    # Adding significance bars - HC*Condition -----
  ggsignif::geom_signif(data = data.frame(Group = c(
    "Less\nClear",
    "Conv",
    "More\nClear")),
    aes(y_position = c(rep(lim_condition_HC_F2, 6)),
        xmin = c(
          # Male Speakers
          1,   # Less Clear -> Conv
          2.1, # Conv -> More Clear
          NA,  # Padding
          # Female Speakers
          1,   # Less Clear -> Conv
          2.1, # Conv -> More Clear
          NA),  # Padding
        xmax = c(
          # Male Speakers
          1.9, # Less Clear -> Conv
          2.9, # Conv -> More Clear
          NA,  # Padding
          # Female Speakers
          1.9, # Less Clear -> Conv
          2.9, # Conv -> More Clear
          NA), # Padding
        annotations = c(
          # Male Speakers
          NA,  # Less Clear -> Conv
          NA,  # Conv -> More Clear
          NA,  # Padding
          # Female Speakers
          NA,  # Less Clear -> Conv
          "*",  # Conv -> More Clear
          NA), # Padding
        group=c(1,2,3,4,5,6)),
    vjust = .5,
    color = color_HC,
    tip_length = 0,
    manual = T) +
  
  # Adding significance bars - PD*Condition ----
  ggsignif::geom_signif(data = data.frame(Group = c(
    "Less\nClear",
    "Conv",
    "More\nClear")),
    aes(y_position = c(rep(lim_condition_PD_F2, 6)),
        xmin = c(
          # Male Speakers
          1,   # Less Clear -> Conv
          2.1, # Conv -> More Clear
          NA,  # Padding
          # Female Speakers
          1,   # Less Clear -> Conv
          2.1, # Conv -> More Clear
          NA),  # Padding
        xmax = c(
          # Male Speakers
          1.9, # Less Clear -> Conv
          2.9, # Conv -> More Clear
          NA,  # Padding
          # Female Speakers
          1.9, # Less Clear -> Conv
          2.9, # Conv -> More Clear
          NA), # Padding
        annotations = c(
          # Male Speakers
          NA,  # Less Clear -> Conv
          NA,  # Conv -> More Clear
          NA,  # Padding
          # Female Speakers
          NA,  # Less Clear -> Conv
          "*",  # Conv -> More Clear
          NA), # Padding
        group=c(1,2,3,4,5,6)),
    vjust = .5,
    color = color_PD,
    tip_length = 0,
    manual = T)

plot_F2_Slope

```
## 6. Kinematic VSA
```{r}
model <- base::readRDS("Study-1/Models/kVSA_finalModel.rds") %>%
  sjPlot::plot_model(type = "int")

plotData <- model[[4]][["data"]] %>%
  as.data.frame() %>%
  dplyr::mutate(
    condition = factor(x,
                       levels = c(3, 1, 2),
                       labels = c("Less\nClear",
                                  "Conv",
                                  "More\nClear")),
    facet = factor(facet,
                   levels = c("M", "F"),
                   labels = c("Male Speakers", "Female Speakers"))) 

lim_y_kVSA <- c(0,
          (base::max(plotData$conf.high) + base::max(plotData$conf.high)*.45))
lim_group_kVSA <- base::max(plotData$conf.high) + base::max(plotData$conf.high)*.10
lim_condition_HC_kVSA <- base::max(plotData$conf.high) + base::max(plotData$conf.high)*.25
lim_condition_PD_kVSA <- base::max(plotData$conf.high) + base::max(plotData$conf.high)*.40
  
# Making the Plot
plot_kVSA <- plotData %>%
  ggplot() +
  aes(y = predicted,
      x = condition,
      group = group,
      color = group) +
  
  # Line
  geom_line(
    aes(color = group,
        group = group),
    position = position_dodge(width = .45),
    alpha = .6,
    ) +
  
  # Error Bars
  geom_errorbar(aes(
    ymin = conf.low,
    ymax = conf.high,
    color = group,
    group = group
    ),
    position = position_dodge(width = .45),
    width = 0,
    ) +
  
  # Point
  geom_point(
    aes(color = group,
        group = group),
    position = position_dodge(width = .45)
    ) +
  
  # Facet by Sex ----
  facet_grid(~facet) +
  
  # Changing the y axis scale
  coord_cartesian(ylim = lim_y_kVSA) +
  
  # Changing the theme, labels, and title
  theme_minimal() +
  labs(y = bquote('mm'^2),
       color = "Group") +
  ggtitle("Kinematic VSA") +
  theme(
    aspect.ratio = 1.333333,
    plot.title = element_text(hjust = 0.5),
    #axis.text.x = element_blank(),
    #axis.ticks.x = element_blank(),
    axis.title.x = element_blank(),
    panel.border = element_rect(fill = NA, color = "black"),
    ) +
  
  # Color Palate
  scale_color_manual(values = c(color_HC,color_PD)) +
  scale_fill_manual(values = c(color_HC,color_PD))

plot_kVSA
```

## 7. Kin Distance
```{r}
model <- base::readRDS("Study-1/Models/kinDistance_finalModel.rds") %>%
  sjPlot::plot_model(type = "int")

plotData <- model[[4]][["data"]] %>%
  as.data.frame() %>%
  dplyr::mutate(
    condition = factor(x,
                       levels = c(3, 1, 2),
                       labels = c("Less\nClear",
                                  "Conv",
                                  "More\nClear")),
    facet = factor(facet,
                   levels = c("M", "F"),
                   labels = c("Male Speakers", "Female Speakers"))) 

lim_y_kinDist <- c(0,
          (base::max(plotData$conf.high) + base::max(plotData$conf.high)*.45))
lim_group_kinDist <- base::max(plotData$conf.high) + base::max(plotData$conf.high)*.10
lim_condition_HC_kinDist <- base::max(plotData$conf.high) + base::max(plotData$conf.high)*.25
lim_condition_PD_kinDist <- base::max(plotData$conf.high) + base::max(plotData$conf.high)*.40
  
# Making the Plot
plot_kinDistance <- plotData %>%
  ggplot() +
  aes(y = predicted,
      x = condition,
      group = group,
      color = group) +
  
  # Line
  geom_line(
    aes(color = group,
        group = group),
    position = position_dodge(width = .45),
    alpha = .6,
    ) +
  
  # Error Bars
  geom_errorbar(aes(
    ymin = conf.low,
    ymax = conf.high,
    color = group,
    group = group
    ),
    position = position_dodge(width = .45),
    width = 0,
    ) +
  
  # Point
  geom_point(
    aes(color = group,
        group = group),
    position = position_dodge(width = .45)
    ) +
  
  # Facet by Sex ----
  facet_grid(~facet) +
  
  # Changing the y axis scale
  coord_cartesian(ylim = lim_y_kinDist) +
  
  # Changing the theme, labels, and title
  theme_minimal() +
  labs(y = "mm",
       color = "Group") +
  ggtitle("Kinematic Distance") +
  theme(
    aspect.ratio = 1.333333,
    plot.title = element_text(hjust = 0.5),
    #axis.text.x = element_blank(),
    #axis.ticks.x = element_blank(),
    axis.title.x = element_blank(),
    panel.border = element_rect(fill = NA, color = "black"),
    ) +
  
  # Color Palate
  scale_color_manual(values = c(color_HC,color_PD)) +
  scale_fill_manual(values = c(color_HC,color_PD)) +
  
  # Adding significance bars - HC*Condition -----
  ggsignif::geom_signif(data = data.frame(Group = c(
    "Less\nClear",
    "Conv",
    "More\nClear")),
    aes(y_position = c(rep(lim_condition_HC_kinDist, 6)),
        xmin = c(
          # Male Speakers
          1,   # Less Clear -> Conv
          2.1, # Conv -> More Clear
          NA,  # Padding
          # Female Speakers
          1,   # Less Clear -> Conv
          2.1, # Conv -> More Clear
          NA),  # Padding
        xmax = c(
          # Male Speakers
          1.9, # Less Clear -> Conv
          2.9, # Conv -> More Clear
          NA,  # Padding
          # Female Speakers
          1.9, # Less Clear -> Conv
          2.9, # Conv -> More Clear
          NA), # Padding
        annotations = c(
          # Male Speakers
          NA,  # Less Clear -> Conv
          "*",  # Conv -> More Clear
          NA,  # Padding
          # Female Speakers
          NA,  # Less Clear -> Conv
          "*",  # Conv -> More Clear
          NA), # Padding
        group=c(1,2,3,4,5,6)),
    vjust = .5,
    color = color_HC,
    tip_length = 0,
    manual = T) +
  
  # Adding significance bars - PD*Condition ----
  ggsignif::geom_signif(data = data.frame(Group = c(
    "Less\nClear",
    "Conv",
    "More\nClear")),
    aes(y_position = c(rep(lim_condition_PD_kinDist, 6)),
        xmin = c(
          # Male Speakers
          1,   # Less Clear -> Conv
          2.1, # Conv -> More Clear
          NA,  # Padding
          # Female Speakers
          1,   # Less Clear -> Conv
          2.1, # Conv -> More Clear
          NA),  # Padding
        xmax = c(
          # Male Speakers
          1.9, # Less Clear -> Conv
          2.9, # Conv -> More Clear
          NA,  # Padding
          # Female Speakers
          1.9, # Less Clear -> Conv
          2.9, # Conv -> More Clear
          NA), # Padding
        annotations = c(
          # Male Speakers
          "*",  # Less Clear -> Conv
          "*",  # Conv -> More Clear
          NA,  # Padding
          # Female Speakers
          NA,  # Less Clear -> Conv
          "*",  # Conv -> More Clear
          NA), # Padding
        group=c(1,2,3,4,5,6)),
    vjust = .5,
    color = color_PD,
    tip_length = 0,
    manual = T)

plot_kinDistance
```

## 8. TB Speed
```{r}
model <- base::readRDS("Study-1/Models/TB_speedMax_finalModel.rds") %>%
  sjPlot::plot_model(type = "int")

plotData <- model[[4]][["data"]] %>%
  as.data.frame() %>%
  dplyr::mutate(
    condition = factor(x,
                       levels = c(3, 1, 2),
                       labels = c("Less\nClear",
                                  "Conv",
                                  "More\nClear")),
    facet = factor(facet,
                   levels = c("M", "F"),
                   labels = c("Male Speakers", "Female Speakers"))) 

lim_y_TB <- c(0,
          (base::max(plotData$conf.high) + base::max(plotData$conf.high)*.45))
lim_group_TB <- base::max(plotData$conf.high) + base::max(plotData$conf.high)*.10
lim_condition_HC_TB <- base::max(plotData$conf.high) + base::max(plotData$conf.high)*.25
lim_condition_PD_TB <- base::max(plotData$conf.high) + base::max(plotData$conf.high)*.40
  
# Making the Plot
plot_TB_Speed <- plotData %>%
  ggplot() +
  aes(y = predicted,
      x = condition,
      group = group,
      color = group) +
  
  # Line
  geom_line(
    aes(color = group,
        group = group),
    position = position_dodge(width = .45),
    alpha = .6,
    ) +
  
  # Error Bars
  geom_errorbar(aes(
    ymin = conf.low,
    ymax = conf.high,
    color = group,
    group = group
    ),
    position = position_dodge(width = .45),
    width = 0,
    ) +
  
  # Point
  geom_point(
    aes(color = group,
        group = group),
    position = position_dodge(width = .45)
    ) +
  
  # Facet by Sex ----
  facet_grid(~facet) +
  
  # Changing the y axis scale
  coord_cartesian(ylim = lim_y_TB) +
  
  # Changing the theme, labels, and title
  theme_minimal() +
  labs(y = "mm/s",
       color = "Group") +
  ggtitle("TB Speed") +
  theme(
    aspect.ratio = 1.333333,
    plot.title = element_text(hjust = 0.5),
    #axis.text.x = element_blank(),
    #axis.ticks.x = element_blank(),
    axis.title.x = element_blank(),
    panel.border = element_rect(fill = NA, color = "black"),
    ) +
  
  # Color Palate
  scale_color_manual(values = c(color_HC,color_PD)) +
  scale_fill_manual(values = c(color_HC,color_PD)) +
  
  # Adding significance bars - HC*Condition -----
  ggsignif::geom_signif(data = data.frame(Group = c(
    "Less\nClear",
    "Conv",
    "More\nClear")),
    aes(y_position = c(rep(lim_condition_HC_TB, 6)),
        xmin = c(
          # Male Speakers
          1,   # Less Clear -> Conv
          2.1, # Conv -> More Clear
          NA,  # Padding
          # Female Speakers
          1,   # Less Clear -> Conv
          2.1, # Conv -> More Clear
          NA),  # Padding
        xmax = c(
          # Male Speakers
          1.9, # Less Clear -> Conv
          2.9, # Conv -> More Clear
          NA,  # Padding
          # Female Speakers
          1.9, # Less Clear -> Conv
          2.9, # Conv -> More Clear
          NA), # Padding
        annotations = c(
          # Male Speakers
          NA,  # Less Clear -> Conv
          "*",  # Conv -> More Clear
          NA,  # Padding
          # Female Speakers
          NA,  # Less Clear -> Conv
          NA,  # Conv -> More Clear
          NA), # Padding
        group=c(1,2,3,4,5,6)),
    vjust = .5,
    color = color_HC,
    tip_length = 0,
    manual = T)

plot_TB_Speed

```
## Combining all of the plots
```{r}
library(patchwork)

# Perceptual Plots
plot_s2_perceptual <- ggarrange(plot_Int,plot_AP,
                                common.legend = T,
                                legend = "bottom")
plot_s2_perceptual

dir.create(path = "Data/Plots/Results",
           showWarnings = F)
ggsave(filename = "Results_perceptual.png",
       plot = plot_s2_perceptual,
       path = "Data/Plots/Results",
       height = 3.3,
       width = 6.5,
       scale = 1,
       bg = "white")

# Acoustic Plots
plot_s2_acoustic <- plot_aVSA + patchwork::plot_spacer() + plot_acoDistance +
  plot_F2_Slope + patchwork::plot_spacer() + patchwork::guide_area() +
    patchwork::plot_layout(
      widths = c(1, -.075, 1),
      guides = "collect",
      #design = "
      #        AABB
      #        CCDD"
      )
plot_s2_acoustic

dir.create(path = "Data/Plots/Results",
           showWarnings = F)
ggsave(filename = "Results_acoustic.png",
       plot = plot_s2_acoustic,
       path = "Data/Plots/Results",
       height = 5,
       width = 6.5,
       scale = 1)

# Kinematic Plots
plot_s2_kinematic <- plot_kVSA + patchwork::plot_spacer() + plot_kinDistance +
  plot_TB_Speed + patchwork::plot_spacer() + patchwork::guide_area() +
    patchwork::plot_layout(
      widths = c(1, -.02, 1),
      guides = "collect",
      #design = "
      #        AABB
      #        CCDD",
      )
plot_s2_kinematic

dir.create(path = "Data/Plots/Results",
           showWarnings = F)
ggsave(filename = "Results_kinematic.png",
       plot = plot_s2_kinematic,
       path = "Data/Plots/Results",
       height = 5,
       width = 6.5,
       scale = 1)

```

```{r}
library(dplyr)
library(ggplot2)
library(tidyr)

myPal <- rcartocolor::carto_pal(n = 15, name = "Geyser")
color_HC <- myPal[2] 
color_PD <- myPal[6]
myPal_1 <- myPal[1]
myPal_2 <- myPal[3]
myPal_3 <- myPal[5]


perceptualMeasures <- rio::import(file = "Data/PreppedData/ListenerData/ListenerRatings_allRatings.csv") %>%
  dplyr::rename(Measure = ratingType,
                Value = Rating) %>%
  dplyr::group_by(condition, Measure) %>%
  dplyr::summarise(M = mean(Value, na.rm = T),
                   sd = sd(Value, na.rm = T),
                   CV = sd / M * 100) %>%
  dplyr::ungroup() %>%
  dplyr::mutate(Domain = "Perceptual")

vsaMeasures <- rio::import(file = "Data/PreppedData/CollatedData/TargetMeasures_vsaMeasures.csv") %>%
  dplyr::mutate(Sex = factor(Sex, levels = c("M","F")),
                aVSA = aVSA/1000) %>%
  tidyr::pivot_longer(cols = aVSA:kVSA,
                      names_to = "Measure",
                      values_to = "Value") %>%
  dplyr::group_by(condition, Measure) %>%
  dplyr::summarise(M = mean(Value, na.rm = T),
                   sd = sd(Value, na.rm = T),
                   CV = sd / M * 100) %>%
  dplyr::ungroup() %>%
  dplyr::mutate(Domain = case_when(
    Measure == "aVSA" ~ "Acoustic",
    Measure == "kVSA" ~ "Kinematic",
  ))

aiMeasures <- rio::import(file = "Data/PreppedData/CollatedData/TargetMeasures_aiMeasures.csv") %>%
  dplyr::mutate(Sex = factor(Sex, levels = c("M","F"))) %>%
  tidyr::pivot_longer(cols = c(acoDistance, kinDistance,
                               F2_Slope, dTB_speedMax, Jaw_speedMax),
                      names_to = "Measure",
                      values_to = "Value") %>%
  dplyr::group_by(condition, Measure) %>%
  dplyr::summarise(M = mean(Value, na.rm = T),
                   sd = sd(Value, na.rm = T),
                   CV = sd / M * 100) %>%
  dplyr::ungroup() %>%
  dplyr::mutate(Domain = case_when(
    Measure == "acoDistance" ~ "Acoustic",
    Measure == "F2_Slope" ~ "Acoustic",
    Measure == "kinDistance" ~ "Kinematic",
    Measure == "dTB_speedMax" ~ "Kinematic",
    Measure == "Jaw_speedMax" ~ "Kinematic",
  ))

variabilityMeasures <- rbind(perceptualMeasures,
                             aiMeasures,
                             vsaMeasures) %>%
  dplyr::mutate(condition = factor(condition,
                                   levels = c(
                                     "lessClear",
                                     "conv",
                                     "moreClear"
                                   ),
                                   labels = c(
                                     "Less Clear",
                                     "Conversational",
                                     "More Clear"
                                   )),
                Measure = factor(Measure,
                                 levels = c(
                                   "Int",
                                   "AP",
                                   "aVSA",
                                   "kVSA",
                                   "acoDistance",
                                   "kinDistance",
                                   "F2_Slope",
                                   "dTB_speedMax",
                                   "Jaw_speedMax"
                                 ),
                                 labels = c(
                                   "Intelligibility",
                                   "Articulatory Precision",
                                   "Acoustic VSA",
                                   "Kinematic VSA",
                                   "Acoustic Distance",
                                   "Kinematic Distance",
                                   "F2 Slope",
                                   "dTB Peak Speed",
                                   "Jaw Peak Speed"
                                 )),
                Domain = factor(Domain,
                                levels = c(
                                  "Perceptual",
                                  "Acoustic",
                                  "Kinematic")))

variabilityMeasures %>%
  ggplot() +
  aes(x = condition,
      y = CV,
      group = Measure,
      label = Measure,
      color = Domain,
      ) +
  geom_line(show.legend = FALSE) +
  geom_point(show.legend = FALSE) +
  geom_text(data = variabilityMeasures %>% dplyr::filter(condition == "More Clear"),
              hjust = 0, nudge_x = 0.1,
              color = "black",
            show.legend = FALSE) +
  facet_wrap(~Domain, ncol = 1,
             scales = "free_y") +
  scale_x_discrete(expand = expansion(mult = c(0.1, .75))) +
  labs(y = "Coefficient of Variation (%)",
       x = NULL) +
  scale_color_manual(values = c(myPal_1, myPal_2, myPal_3)) +
  theme_minimal()

ggsave(plot = last_plot(),
       filename = "S2_MeasureVariability.png",
       path = "Data/Plots/Results",
       height = 5,
       width = 4,
       units = "in",
       scale = 1.2)

```

## Duration, Extent, Slope
```{r}
library(rcartocolor) # install.packages('rcartocolor')
myPal <- rcartocolor::carto_pal(n = 11, name = "Geyser")[c(2, 3, 4, 5)]

vowels <- rio::import(file = "Data/PreppedData/CollatedData/allSpeakers_AcousticSegments.csv") %>%
  dplyr::filter(phrase == "bsent") %>%
  dplyr::group_by(DatabaseID, Group, condition, phrase) %>%
  dplyr::mutate(time = time - min(time),
                condition = factor(condition,
                                   levels = c(
                                     "lessClear",
                                     "conv",
                                     "moreClear"
                                   ),
                                   labels = c(
                                     "Less Clear",
                                     "Conversational",
                                     "More Clear"
                                   )),
                label = factor(label,
                               levels = c(
                                 "ai",
                                 "a",
                                 "i",
                                 "v"
                               ),
                               labels = c(
                                 "aÉª",
                                 "a",
                                 "i",
                                 "ÊŒ"
                                 )))

vowelBoundaries <- vowels %>%
  dplyr::group_by(DatabaseID, Group, condition, phrase, label, token) %>%
  dplyr::summarise(onset = min(time),
                   offset = max(time)) %>%
  dplyr::filter(token != "a.1") %>%
  dplyr::filter(token != "ai.1") %>%
  dplyr::filter(token != "i.2") %>%
  dplyr::filter(token != "i.3") %>%
  dplyr::filter(token != "v.1") %>%
  dplyr::filter(token != "`") %>%
  dplyr::filter(token != "a.3") %>%
  dplyr::group_by(condition, phrase, label, token) %>%
  dplyr::summarise(onset = mean(onset, na.rm = T),
                   offset = mean(offset, na.rm = T))

vowelLabels <- vowelBoundaries %>%
  dplyr::mutate(midpoint = (offset - onset)/2 + onset)

wordLabels <- vowelLabels %>%
  dplyr::filter(condition == "More Clear") %>%
  dplyr::mutate(word = case_when(
    token == "ai" ~ "Buy",
    token == "a" ~ "Bobby",
    token == "i" ~ "Bobby",
    token == "v" ~ "puppy",
    token == "i.1" ~ "puppy"
  )) %>%
  dplyr::group_by(condition, phrase, word) %>%
  dplyr::summarize(midpoint = mean(midpoint)) %>%
  dplyr::ungroup() %>%
  dplyr::add_row(condition = "More Clear",
                 phrase = "bsent",
                 word = "a",
                 midpoint = mean(x = c(.$midpoint[.$word == "Bobby"],
                                       .$midpoint[.$word == "puppy"]),
                                 na.rm = T))


phraseBoundaries <- vowels %>%
  dplyr::group_by(DatabaseID, Group, condition, phrase) %>%
  dplyr::summarise(onset = min(time),
                   offset = max(time)) %>%
  dplyr::group_by(condition, phrase) %>%
  dplyr::summarise(onset = mean(onset, na.rm = T),
                   offset = mean(offset, na.rm = T)) %>%
  tidyr::pivot_longer(names_to = "timePoint",
                      values_to = "time",
                      cols = c(onset, offset))

phraseBoundaries %>%
  ggplot() +
  aes(x = time,
      y = condition) +
  geom_line(linetype = 2) +
  # Adding the vowels
  geom_segment(data = vowelBoundaries,
            aes(x = onset, xend = offset,
                y = condition, yend = condition,
                color = label,
                group = condition),
            size = 10,
            lineend = "butt",
            show.legend = F) +
  # Vowel Labels
  geom_text(data = vowelLabels,
            aes(x = midpoint,
                y = condition,
                label = label),
            show.legend = F) +
  # Word Labels
  geom_text(data = wordLabels,
            aes(x = midpoint,
                y = condition,
                label = word),
            nudge_y = .5,
            show.legend = F) +
  labs(x = "Time (s, Normalized)",
       y = NULL) +
  theme_classic() +
  scale_color_manual(values = myPal)

ggsave(filename = "S2_Relative Vowel Duations.png",
       plot = last_plot(),
       path = "Data/Plots/Results",
       height = 4,
       width = 6,
       scale = .9)

```

## Intelligibility and Articulatory Precision Ranges
```{r, eval = F}
# Color Pallate
myPal <- rcartocolor::carto_pal(n = 7, name = "Geyser")[c(1, 2, 3, 4, 5, 6, 7)]
color_HC <- myPal[2] 
color_PD <- myPal[6]

# Load in the Data
speakerList <- rio::import(file = "Data/PreppedData/Speaker List_Clean.csv")

plotData <- utils::read.csv(file = "Data/PreppedData/ListenerData/ListenerRatings.csv") %>%
  dplyr::select(!1) %>%
  dplyr::group_by(DatabaseID, ratingType, condition) |>
  dplyr::summarise(M = mean(M, na.rm = T)) %>%
  tidyr::pivot_wider(
    names_from = condition,
    values_from = M) %>%
  dplyr::mutate(segMin = base::min(conv,lessClear,moreClear),
                segMax = base::max(conv,lessClear,moreClear),
                range = segMax - segMin,
                ratingAvg = base::mean(conv,lessClear,moreClear),
                ratingType = factor(ratingType,
                                    levels = c("Int",
                                               "AP"),
                                    labels = c("Intelligibility",
                                               "Articulatory Precision"))) %>%
  base::merge(., speakerList %>% dplyr::select(DatabaseID, StudyID, Group)) %>%
  dplyr::mutate(StudyID = as.factor(StudyID)) %>%
  arrange(segMax)

segmentData <- plotData %>%
  dplyr::select(DatabaseID, StudyID, Group, ratingType, segMin, segMax)

pointData <- plotData %>%
    dplyr::select(DatabaseID, StudyID, Group, ratingType, conv, lessClear, moreClear) %>%
  tidyr::pivot_longer(
    cols = c(conv,lessClear,moreClear),
    values_to = "Value",
    names_to = "Condition") %>%
  dplyr::mutate(Condition = factor(Condition,
                                   levels = c(
                                     "lessClear",
                                     "conv",
                                     "moreClear"
                                   ),
                                   labels = c(
                                     "Less Clear",
                                     "Conversational",
                                     "More Clear"
                                   )))


# With a bit more style
plot_IntAP <- plotData %>%
  ggplot() +
  geom_segment(
    data = segmentData,
    aes(x = fct_inorder(StudyID),
        xend = StudyID,
        y = segMin,
        yend = segMax),
    color="grey") +
  geom_point(
    data = pointData,
    aes(x = fct_inorder(StudyID),
        y = Value,
        shape = Condition,
        alpha = Condition,
        color = Group),
    size = 2) +
  coord_flip()+
  
  # Specifying the theme
  theme_minimal() +
  theme(
    #legend.position = "none",
    panel.border = element_blank(),
    #aspect.ratio = 1,
  ) +
  
  # Facet and modify y axis scale
  facet_grid(Group~ratingType, scales = "free_y") +
  ylim(c(0,100)) +
  
  # Labels & Title
  labs(x = NULL,
       y = "Perceptual Ratings (VAS)",
       title = NULL) +
  
  # Color Palate
  scale_color_manual(values = c(color_HC,color_PD)) +
  scale_fill_manual(values = c(color_HC,color_PD)) +
  scale_shape_manual(values = c(17, 16, 15)) +
  scale_alpha_manual(values = c(.6, .8, 1))

plot_IntAP


ggplot2::ggsave("Data/Plots/Results/S2_avgRatings.png",
                plot = last_plot(),
                height = 6,
                width = 6.5,
                units = "in")

rm(plotData, segmentData, pointData, speakerList)
```

# Motor Equivilance Plot
PDM04 - PDM06
```{r}
aiMeasures <- rio::import(file = "Data/PreppedData/CollatedData/TargetMeasures_aiMeasures.csv")

speakers <- aiMeasures %>%
  dplyr::select(StudyID, Sex, Group, Age) %>%
  base::unique()

speakerContrast <- aiMeasures %>%
  dplyr::filter(condition == "conv") %>%
  dplyr::filter(StudyID == "HCF03" | StudyID == "HCF05") %>%
  dplyr::mutate(duration = duration*1000)

speakerContrast_pair1 <- rbind(
  aiMeasures %>%
    dplyr::filter(condition == "conv") %>%
    dplyr::filter(StudyID == "PDM04" & rep == 4),
  aiMeasures %>%
    dplyr::filter(condition == "conv") %>%
    dplyr::filter(StudyID == "PDM06" & rep == 5)
)

speakerContrast_pair2 <- rbind(
  aiMeasures %>%
    dplyr::filter(condition == "conv") %>%
    dplyr::filter(StudyID == "HCF03" & rep == 2),
  aiMeasures %>%
    dplyr::filter(condition == "conv") %>%
    dplyr::filter(StudyID == "HCF05" & rep == 1)
)

speakerContrast_pair3 <- rbind(
  aiMeasures %>%
    dplyr::filter(condition == "conv") %>%
    dplyr::filter(StudyID == "HCM06" & rep == 4), # 4 is good
  aiMeasures %>%
    dplyr::filter(condition == "conv") %>%
    dplyr::filter(StudyID == "HCM07" & rep == 2) # 2 is good
)

speakerContrast_pair4 <- rbind(
  aiMeasures %>%
    dplyr::filter(condition == "conv") %>%
    dplyr::filter(StudyID == "HCM07" & rep == 3),
  aiMeasures %>%
    dplyr::filter(condition == "conv") %>%
    dplyr::filter(StudyID == "HCM08" & rep == 1)
)

speakerContrast_pair5 <- rbind(
  aiMeasures %>%
    dplyr::filter(condition == "conv") %>%
    dplyr::filter(StudyID == "HCM05" & rep == 1),
  aiMeasures %>%
    dplyr::filter(condition == "conv") %>%
    dplyr::filter(StudyID == "HCM08" & rep == 2)
)


targetContrastPair <- speakerContrast_pair4
speaker1 <- targetContrastPair %>%
  dplyr::filter(row_number() == 1)
speaker2 <- targetContrastPair %>%
  dplyr::filter(row_number() == 2)

# Acoustic Data
acousticSegments <- rio::import(file = "Data/PreppedData/CollatedData/allSpeakers_AcousticSegments.csv") %>%
  dplyr::filter(DatabaseID == speaker1$DatabaseID & between(time,
                                                            speaker1$onset,
                                                            speaker1$offset) |
                  DatabaseID == speaker2$DatabaseID & between(time,
                                                            speaker2$onset,
                                                            speaker2$offset))


plot_acousticSegment <- acousticSegments %>%
  dplyr::group_by(DatabaseID) %>%
  dplyr::mutate(time = time - min(time)) %>%
  ggplot() +
  aes(x = F2,
      y = F1,
      alpha = time) +
  geom_path() +
  geom_point() +
  scale_y_reverse() +
  facet_wrap(~DatabaseID) +
  theme_minimal() +
  theme(aspect.ratio = 1)
plot_acousticSegment

# Movement Data
movementSegments <- rio::import(file = "Data/PreppedData/CollatedData/allSpeakers_MovementSegments.csv") %>%
  dplyr::filter(DatabaseID == speaker1$DatabaseID & between(time,
                                                            speaker1$onset,
                                                            speaker1$offset) |
                  DatabaseID == speaker2$DatabaseID & between(time,
                                                            speaker2$onset,
                                                            speaker2$offset))

plot_movementSegments <- movementSegments %>%
  dplyr::group_by(DatabaseID) %>%
  dplyr::mutate(time = time - min(time),
                tb_x = scale(tb_x, center = T, scale = F)) %>%
  ggplot() +
  aes(x = tb_x,
      y = tb_y,
      alpha = time) +
  geom_path() +
  geom_point() +
  facet_wrap(~DatabaseID) +
  theme_minimal() +
  theme(aspect.ratio = 1) +
  labs(x = "Posterior-Anterior (x)",
       y = "Inferior-Superior (y)")
plot_movementSegments

library(patchwork)
plot_speakerContrast <- plot_acousticSegment +
  plot_movementSegments +
  patchwork::plot_layout(ncol = 1)
plot_speakerContrast
```

# Contrast - 1 dimension
```{r}
targetContrastPair <- speakerContrast_pair5
speaker1 <- targetContrastPair %>%
  dplyr::filter(row_number() == 1)
speaker2 <- targetContrastPair %>%
  dplyr::filter(row_number() == 2)


# Acoustic Data
acousticSegments <- rio::import(file = "Data/PreppedData/CollatedData/allSpeakers_AcousticSegments.csv") %>%
  dplyr::filter(DatabaseID == speaker1$DatabaseID & between(time,
                                                            speaker1$onset,
                                                            speaker1$offset) |
                  DatabaseID == speaker2$DatabaseID & between(time,
                                                            speaker2$onset,
                                                            speaker2$offset))
# Movement Data
movementSegments <- rio::import(file = "Data/PreppedData/CollatedData/allSpeakers_MovementSegments.csv") %>%
  dplyr::filter(DatabaseID == speaker1$DatabaseID & between(time,
                                                            speaker1$onset,
                                                            speaker1$offset) |
                  DatabaseID == speaker2$DatabaseID & between(time,
                                                            speaker2$onset,
                                                           speaker2$offset))

# Combining data
plotData <- rbind(acousticSegments %>%
                    dplyr::group_by(DatabaseID) %>%
                    dplyr::mutate(time = time - min(time),
                                  xlab = "Acoustic (F2)") %>%
                    dplyr::select(DatabaseID, time, xlab, F2) %>%
                    dplyr::rename(x = F2),
                  
                  movementSegments %>%
                    dplyr::group_by(DatabaseID) %>%
                    dplyr::mutate(time = time - min(time),
                                  xlab = "Movement (x)") %>%
                  dplyr::select(DatabaseID, time, xlab, tb_x) %>%
                    dplyr::rename(x = tb_x)) %>%
  dplyr::group_by(DatabaseID, xlab) %>%
  dplyr::mutate(x = scale(x, center = T, scale = F))



plot <- plotData %>%
  ggplot() +
  aes(x = time,
      y = x,
      alpha = time) +
  geom_path() +
  geom_point() +
  facet_grid(xlab~DatabaseID,
             scales = "free_y") +
  theme_classic() +
  theme(aspect.ratio = 1) +
  labs(x = "time",
       y = "Inferior-Superior Dimension")
plot

```
# Contrast - all Movement
```{r}
targetContrastPair <- speakerContrast_pair4
speaker1 <- targetContrastPair %>%
  dplyr::filter(row_number() == 1)
speaker2 <- targetContrastPair %>%
  dplyr::filter(row_number() == 2)

# Acoustic Data
acousticSegments <- rio::import(file = "Data/PreppedData/CollatedData/allSpeakers_AcousticSegments.csv") %>%
  dplyr::filter(DatabaseID == speaker1$DatabaseID & between(time,
                                                            speaker1$onset,
                                                            speaker1$offset) |
                  DatabaseID == speaker2$DatabaseID & between(time,
                                                            speaker2$onset,
                                                            speaker2$offset))


plot_acousticSegment <- acousticSegments %>%
  dplyr::group_by(DatabaseID) %>%
  dplyr::mutate(time = time - min(time)) %>%
  ggplot() +
  aes(x = time,
      y = F2,
      alpha = time) +
  geom_path() +
  geom_point() +
  #scale_y_reverse() +
  facet_wrap(~DatabaseID) +
  theme_classic() +
  theme(aspect.ratio = 1)
plot_acousticSegment

# Movement Data
movementSegments <- rio::import(file = "Data/PreppedData/CollatedData/allSpeakers_MovementSegments.csv") %>%
  dplyr::filter(DatabaseID == speaker1$DatabaseID & between(time,
                                                            speaker1$onset,
                                                            speaker1$offset) |
                  DatabaseID == speaker2$DatabaseID & between(time,
                                                            speaker2$onset,
                                                            speaker2$offset)) %>%
  dplyr::select(DatabaseID, time,
                tb_x, tb_y,
                tf_x, tf_y,
                ul_x, ul_y,
                ll_x, ll_y,
                jaw_x, jaw_y)
x <- movementSegments %>%
  dplyr::select(DatabaseID, time, tb_x, tf_x, ul_x,ll_x, jaw_x) %>%
  tidyr::pivot_longer(cols = tb_x:jaw_x,
                      names_to = "Articulator",
                      values_to = "x") %>%
  dplyr::mutate(Articulator = gsub(pattern = "_x",
                                   replacement = "",
                                   x = Articulator))

y <- movementSegments %>%
  dplyr::select(DatabaseID, time, tb_y, tf_y, ul_y,ll_y, jaw_y) %>%
  tidyr::pivot_longer(cols = tb_y:jaw_y,
                      names_to = "Articulator",
                      values_to = "y") %>%
  dplyr::mutate(Articulator = gsub(pattern = "_y",
                                   replacement = "",
                                   x = Articulator))

movementSegments <- base::merge(x, y)

plot_movementSegments <- movementSegments %>%
  dplyr::group_by(DatabaseID) %>%
  dplyr::mutate(time = time - min(time)) %>%
  ggplot() +
  aes(x = x,
      y = y,
      color = Articulator,
      alpha = time) +
  geom_path() +
  geom_point() +
  facet_wrap(~DatabaseID) +
  theme_classic() +
  theme(aspect.ratio = 1) +
  labs(x = "x",
       y = "Inferior-Superior (y)")
plot_movementSegments


library(patchwork)
plot_speakerContrast <- plot_acousticSegment +
  plot_movementSegments +
  plot_movementSegments_tf +
  patchwork::plot_layout(ncol = 1)
plot_speakerContrast
```

# aVSA vs. kVSA
```{r}
myPal <- rcartocolor::carto_pal(n = 7, name = "Geyser")[c(1, 2, 3, 4, 5, 6, 7)]
color_HC <- myPal[2] 
color_PD <- myPal[6]

speakers <- rio::import(file = "Data/PreppedData/Speaker List_Clean.csv") %>%
  dplyr::select(DatabaseID:Sex)

vsaMeasures <- rio::import(file = "Data/PreppedData/CollatedData/allSpeakers_tempMid.csv") %>%
  dplyr::select(DatabaseID, Group, condition, label,
                F1_tempMid, F2_tempMid,
                TB_x_tempMid, TB_y_tempMid) %>%
  base::merge(., speakers, no.dups = F) %>%
  dplyr::group_by(DatabaseID) %>%
  dplyr::mutate(TB_x_tempMid = scale(TB_x_tempMid, center = T, scale = F),
                TB_y_tempMid = scale(TB_y_tempMid, center = T, scale = F)) %>%
  dplyr::group_by(Group, Sex, condition, label) %>%
  dplyr::summarise(F1_tempMid = mean(F1_tempMid, na.rm = T),
                   F2_tempMid = mean(F2_tempMid, na.rm = T),
                   TB_x_tempMid = mean(TB_x_tempMid, na.rm = T),
                   TB_y_tempMid = mean(TB_y_tempMid, na.rm = T)) %>%
  dplyr::mutate(Sex = factor(Sex,
                             levels = c(
                               "M",
                               "F"
                             ),
                             labels = c(
                               "Male Speakers",
                               "Female Speakers"
                             )))
variability_xyCoords <- rio::import(file = "Data/PreppedData/CollatedData/allSpeakers_tempMid.csv") %>%
  dplyr::select(DatabaseID, Group, condition, label,
                F1_tempMid, F2_tempMid,
                TB_x_tempMid, TB_y_tempMid) %>%
  base::merge(., speakers, no.dups = F) %>%
  dplyr::group_by(DatabaseID) %>%
  dplyr::mutate(TB_x_tempMid = scale(TB_x_tempMid, center = T, scale = F),
                TB_y_tempMid = scale(TB_y_tempMid, center = T, scale = F)) %>%
  tidyr::pivot_longer(cols = F1_tempMid:TB_y_tempMid,
                      names_to = "Dimension",
                      values_to = "Value") %>%
  dplyr::group_by(Group, Sex, condition, Dimension, label) %>%
  dplyr::summarise(M = mean(Value, na.rm = T),
                   SD = sd(Value, na.rm = T)) %>%
  dplyr::group_by(condition, Dimension) %>%
  dplyr::mutate(CV = abs(SD / M * 100),
                M_z = scale(M),
                SD_z = scale(SD))

coordVariability <- variability_xyCoords %>%
  ggplot() +
  aes(x = Dimension,
      y = SD_z) +
  geom_boxplot() +
  facet_wrap(~Sex)
coordVariability

aVSA <- vsaMeasures %>%
  dplyr::filter(condition == "conv") %>%
  ggplot() +
  aes(x = F2_tempMid,
      y = F1_tempMid,
      label = label,
      color = Group,
      linetype = Group,
      fill = Group) +
  geom_point() +
  geom_polygon(fill = NA) +
  geom_label(color = "white",
             show.legend = FALSE) +
  scale_x_reverse() +
  scale_y_reverse() +
  facet_grid(~ Sex) +
  theme_minimal() +
  theme(aspect.ratio = 1) +
  
  # Labels
  labs(x = "F2",
       y = "F1",
       title = "Acoustic VSA") +
  
  # Color Palate
  scale_color_manual(values = c(color_HC,color_PD)) +
  scale_fill_manual(values = c(color_HC,color_PD))
aVSA

kVSA <- vsaMeasures %>%
  dplyr::filter(condition == "conv") %>%
  ggplot() +
  aes(x = TB_x_tempMid,
      y = TB_y_tempMid,
      label = label,
      color = Group,
      linetype = Group,
      fill = Group) +
  geom_point() +
  geom_polygon(
    fill=NA) +
  geom_label(color = "white",
             show.legend = FALSE) +
  scale_x_reverse() +
  facet_grid(~ Sex) +
  theme_minimal() +
  theme(aspect.ratio = 1) +
  
  # Labels
  labs(x = "Anterior-Posterior (x)",
       y = "Inferior-Superior (y)",
       title = "Kinematic VSA") +
  
  # Color Palate
  scale_color_manual(values = c(color_HC,color_PD)) +
  scale_fill_manual(values = c(color_HC,color_PD))
kVSA

vsaComparisons <- aVSA + kVSA + 
  plot_layout(guides = "collect",
              ncol = 1)
vsaComparisons

ggsave(filename = "S1_vsaComparison.png",
       path = "Data/Plots/Results/",
       plot = vsaComparisons,
       height = 3.5,
       width = 3,
       units = "in",
       scale = 1.7)
```

# Tables
## Emmeans Tables
```{r}
models <- list.files(path = "Study-1/Models/")

k <- 1
while (k <= NROW(models)) {
  targetModel <- readRDS(file = paste0("Study-1/Models/",models[k]))
  targetMeasure <- paste0(targetModel@call[["formula"]][[2]])
  
  # Compute EMMs for Group and Sex
  emms_group <- emmeans(targetModel, ~ Group | Sex*condition)
  emms_condition <- emmeans(targetModel, ~ condition | Sex*Group)

  # Compare EMMs for Group and Sex
  pairs(emms_group)
  pairs(emms_condition)
  
  # Compare EMMs for Group and Sex
  groupDiff <- summary(pairs(emms_group)) %>%
    dplyr::rename(stat.value = 7) %>%
      dplyr::mutate(
        Measure = targetMeasure,
        sig = ifelse(p.value < alpha_s1, TRUE, FALSE),
        stat = ifelse(df == "Inf",
                      paste0("z="),
                      paste0("t=")),
        apa = paste0(Sex, ", ",
                     condition, ", ",
                     contrast, ": ",
                     stat, round(stat.value, digits = 2), ", ",
                   ifelse(p.value < .001, "p<.001", paste0("p=",round(p.value, digits = 3)))),
      apa = gsub(pattern = "0[.]", replacement = ".", apa)) %>%
    dplyr::relocate(Measure, .before = contrast)
  
  conditionDiff <- summary(pairs(emms_condition)) %>%
    dplyr::rename(stat.value = 7) %>%
    dplyr::mutate(
      Measure = targetMeasure,
      sig = ifelse(p.value < alpha_s1, TRUE, FALSE),
      stat = ifelse(df == "Inf",
                    paste0("z="),
                    paste0("t=")),
      apa = paste0(Sex, ", ",
                   Group, ", ",
                   contrast, ": ",
                   stat, round(stat.value, digits = 2), ", ",
                   ifelse(p.value < .001, "p<.001", paste0("p=",round(p.value, digits = 3)))),
      apa = gsub(pattern = "0[.]", replacement = ".", apa)) %>%
    dplyr::relocate(Measure, .before = contrast)
  
  if (k == 1) {
    table_groupDiff <- groupDiff
    table_conditionDiff <- conditionDiff
  } else {
    table_groupDiff <- rbind(table_groupDiff, groupDiff)
    table_conditionDiff <- rbind(table_conditionDiff, conditionDiff)
  }
  
  k <- k + 1
  rm(groupDiff, conditionDiff, targetMeasure, targetModel)
}
```

### Group Constrasts
```{r}
table_groupDiff %>%
  dplyr::select(Measure:condition, estimate, SE, stat.value, df, p.value, sig) %>%
  dplyr::select(!contrast) %>%
  dplyr::mutate(p.value = ifelse(p.value < .001,"<.001", round(p.value, digits = 3)),
                p.value = gsub(p.value, pattern = "0[.]", replacement = ".")) %>%
  tidyr::pivot_wider(
    names_from = Sex,
    values_from = c(estimate, SE, stat.value, p.value,df, sig)
  ) %>%
  dplyr::mutate(
    condition = factor(condition,
                       levels = c(
                         "conv",
                         "lessClear",
                         "moreClear"
                       ),
                       labels = c(
                         "Conversational",
                         "Less Clear",
                         "More Clear"
                       )),
    Measure = factor(Measure,
                     levels = c(
                       "Int",
                       "AP",
                       "aVSA",
                       "acoDistance",
                       "F2_Slope",
                       "kVSA",
                       "kinDistance",
                       "TB_speedMax"
                     ),
                     labels = c(
                       "Intelligibility (%)",
                       "Articulatory Precision (%)",
                       "Acoustic VSA (Hz^2)",
                       "Acoustic Distance (Hz)",
                       "F2 Slope (Hz/ms)",
                       "Kinematic VSA (mm^2)",
                       "Kinematic Distance (mm)",
                       "TB Speed (mm/s)"
                     ))) %>%
  arrange(Measure) %>%
  gt::gt(
    rowname_col = "condition",
    groupname_col = "Measure") %>%
  
  # Female Speakers Spanner
  gt::tab_spanner(
    label = "Female Speakers",
    columns = c(estimate_F,
              SE_F,
              stat.value_F,
              df_F,
              p.value_F)
  ) %>%
  
  # Male Speakers Spanner
  gt::tab_spanner(
    label = "Male Speakers",
    columns = c(estimate_M,
              SE_M,
              stat.value_M,
              df_M,
              p.value_M)
  ) %>%
  gt::fmt_number(
    columns = everything(),
    decimals = 2
  ) %>%
  gt::fmt_number(
    columns = c(p.value_M, p.value_F),
    decimals = 3,
  ) %>%
  gt::cols_align(align = "right",
                 columns = c(p.value_M, p.value_F)) %>%
 
  # Conditionally bold M rows
  gt::tab_style(style = list(gt::cell_text(weight = 'bold')), 
            locations = gt::cells_body(columns = c(
              estimate_M,
              SE_M,
              stat.value_M,
              df_M,
              p.value_M),
              rows = sig_M == TRUE)) %>%
  
  # Conditionally bold M rows
  gt::tab_style(style = list(gt::cell_text(weight = 'bold')), 
            locations = gt::cells_body(columns = c(
              estimate_F,
              SE_F,
              stat.value_F,
              df_F,
              p.value_F),
              rows = sig_F == TRUE)) %>%
  
  # Rename Columns
  gt::cols_label(
    estimate_M = "Est",
    SE_M = "SE",
    stat.value_M = "F/Z Ratio",
    df_F = "df",
    p.value_M = "p",
    estimate_F = "Est",
    SE_F = "SE",
    stat.value_F = "F/Z Ratio",
    df_M = "df",
    p.value_F = "p"
  ) %>%
  gt::cols_hide(columns = c(sig_M,sig_F)) %>%
  gt::tab_options(row_group.as_column = TRUE)  %>%
  gt::gtsave(filename = "Data/Tables/Supplemental Info_Group Contrasts.html")
```

### Condition Contrasts
```{r}
table_conditionDiff %>%
  dplyr::select(Measure:Group, estimate, SE, stat.value, df, p.value, sig) %>%
  dplyr::mutate(p.value = ifelse(p.value < .001,"<.001", round(p.value, digits = 3)),
                p.value = gsub(p.value, pattern = "0[.]", replacement = ".")) %>%
  tidyr::pivot_wider(
    names_from = Sex,
    values_from = c(estimate, SE, stat.value, p.value,df, sig)
  ) %>%
  dplyr::mutate(
    Measure = factor(Measure,
                     levels = c(
                       "Int",
                       "AP",
                       "aVSA",
                       "acoDistance",
                       "F2_Slope",
                       "kVSA",
                       "kinDistance",
                       "TB_speedMax"
                     ),
                     labels = c(
                       "Intelligibility (%)",
                       "Articulatory Precision (%)",
                       "Acoustic VSA (Hz^2)",
                       "Acoustic Distance (Hz)",
                       "F2 Slope (Hz/ms)",
                       "Kinematic VSA (mm^2)",
                       "Kinematic Distance (mm)",
                       "TB Speed (mm/s)"
                     ))) %>%
  arrange(Measure) %>%
  gt::gt(
    rowname_col = "contrast",
    groupname_col = c("Measure")) %>%
  
  # Female Speakers Spanner
  gt::tab_spanner(
    label = "Female Speakers",
    columns = c(estimate_F,
              SE_F,
              stat.value_F,
              df_F,
              p.value_F)
  ) %>%
  
  # Male Speakers Spanner
  gt::tab_spanner(
    label = "Male Speakers",
    columns = c(estimate_M,
              SE_M,
              stat.value_M,
              df_M,
              p.value_M)
  ) %>%
  gt::fmt_number(
    columns = everything(),
    decimals = 2
  ) %>%
  gt::fmt_number(
    columns = c(p.value_M, p.value_F),
    decimals = 3,
  ) %>%
  gt::cols_align(align = "right",
                 columns = c(p.value_M, p.value_F)) %>%
 
  # Conditionally bold M rows
  gt::tab_style(style = list(gt::cell_text(weight = 'bold')), 
            locations = gt::cells_body(columns = c(
              estimate_M,
              SE_M,
              stat.value_M,
              df_M,
              p.value_M),
              rows = sig_M == TRUE)) %>%
  
  # Conditionally bold M rows
  gt::tab_style(style = list(gt::cell_text(weight = 'bold')), 
            locations = gt::cells_body(columns = c(
              estimate_F,
              SE_F,
              stat.value_F,
              df_F,
              p.value_F),
              rows = sig_F == TRUE)) %>%
  
  # Rename Columns
  gt::cols_label(
    estimate_M = "Est",
    SE_M = "SE",
    stat.value_M = "F/Z Ratio",
    df_F = "df",
    p.value_M = "p",
    estimate_F = "Est",
    SE_F = "SE",
    stat.value_F = "F/Z Ratio",
    df_M = "df",
    p.value_F = "p"
  ) %>%
  gt::cols_hide(columns = c(sig_M,sig_F)) %>%
  gt::tab_options(row_group.as_column = TRUE) %>%
  gt::gtsave(filename = "Data/Tables/Supplemental Info_Condition Contrasts.html")
  
```

