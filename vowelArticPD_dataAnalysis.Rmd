---
title: "A multidimensional study of articulation deficits in Parkinsonâ€™s disease - Data Analysis: Study 1"
---

```{r}
rm(list = ls())
```

# Packages
```{r}
library(tidyverse) # install.packages('tidyverse')
library(emmeans)
library(ggpubr) # install.packages('ggpubr')
library(plyr) # install.packages('plyr')
library(beepr) # install.packages('beepr')
library(plotrix) # install.packages('plotrix')
source('Functions/MSL Tools.R')
```

# General
## Participants Table
```{r}
fileInventories <- rio::import(file = "Data/RawData/File Inventories.xlsx") %>%
  dplyr::rename(DatabaseID = `Sub #`,
                dxTime = `Time Since Diagnosis`) %>%
  dplyr::select(DatabaseID, dxTime, MoCA)

listenerRatings <- rio::import(file = "Data/PreppedData/ListenerData/ListenerRatings_allRatings.csv") %>%
  dplyr::filter(ratingType == "Int") %>%
  dplyr::filter(condition == "conv") %>%
  dplyr::group_by(DatabaseID, StudyID) %>%
  dplyr::summarise(Rating_M = mean(Rating, na.rm = T))

speakerList <- rio::import(file = "Data/PreppedData/Speaker List_Clean.csv") %>%
  dplyr::select(!`Folder 2`:`Sentence Repetition`) %>%
  base::merge(., fileInventories) %>%
  base::merge(., listenerRatings) %>%
  
  # Making sure dxTime is numeric
  dplyr::mutate(dxTime = as.numeric(dxTime)) %>%
  
  # Refactoring Sex
  dplyr::mutate(Sex = factor(Sex, 
                             levels = c(
                               "M",
                               "F"
                               ),
                             labels = c(
                               "Male Speakers",
                               "Female Speakers"
                             ))) %>%
  
  # Severity-surrogate ratings
  dplyr::mutate(Severity = case_when(
    Group == "HC" ~ "",
    Rating_M > 94 ~ "Normal",
    between(Rating_M, 85, 94.99) ~ "Mild",
    between(Rating_M, 70, 84.99) ~ "Moderate",
    between(Rating_M, 45, 69.99) ~ "Severe",
    Rating_M < 45 ~ "Profound"
  )) %>%
  
  # Removing the MoCA Scores - Not all speakers had them
  dplyr::select(!MoCA)
```

### Summaries
```{r}
speakerList %>%
    dplyr::group_by(Group) %>%
    dplyr::summarise(Mean = mean(Age, na.rm = T),
                     sd = sd(Age, na.rm = T),
                     n = NROW(Age))

speakerList %>%
    dplyr::group_by(Group, Sex) %>%
    dplyr::summarise(Mean = mean(Age, na.rm = T),
                     sd = sd(Age, na.rm = T),
                     n = NROW(Age))
```


### All Speakers
```{r}
# All Speakers ----
speakerList %>%
  dplyr::select(!DatabaseID) %>%
  dplyr::arrange(StudyID) %>%
  
  # Creating the gt table
  gt::gt(rowname_col = "StudyID",
    groupname_col = "Group") %>%
  
  # Title
  gt::tab_header(
      title = "Speaker Demographics"
      ) %>%
  
  # Replace missing values with blanks
  gt::sub_missing(
  columns = everything(),
  rows = everything(),
  missing_text = ""
  ) %>%
  
  # Renaming columns
  gt::cols_label(
    dxTime = "Time Since Diagnosis",
    Rating_M = "Intelligibility (%)",
  ) %>%
  
  # Formatting the Intelligibility data
  gt::fmt_number(
  columns = Rating_M,
  decimals = 2,
  ) %>%
  
  # Format groups
  gt::tab_options(row_group.as_column = TRUE) %>%
  
  # Saving the table
  gt::gtsave(filename = "SpeakerDemo.html",
             path = "Data/Tables")
```

### HC Speakers
```{r}
# HC Speakers ----
speakerList %>%
  dplyr::filter(Group == "HC") %>%
  dplyr::select(!DatabaseID) %>%
  dplyr::arrange(StudyID) %>%
  
  # Creating the gt table
  gt::gt(rowname_col = "StudyID",
    groupname_col = "Sex") %>%
  
  # Title
  gt::tab_header(
      title = "Speaker Demographics"
      ) %>%
  
  # Replace missing values with blanks
  gt::sub_missing(
  columns = everything(),
  rows = everything(),
  missing_text = ""
  ) %>%
  
  # Renaming columns
  gt::cols_label(
    dxTime = "Time Since Diagnosis",
    Rating_M = "Intelligibility (%)",
  ) %>%
  
  # Formatting the Intelligibility data
  gt::fmt_number(
  columns = Rating_M,
  decimals = 2,
  ) %>%
  
  # Adding summary rows
  ## Male Speakers
  gt::summary_rows(
    groups = "Male Speakers",
    columns = c(Age, Rating_M),
    fns = list(
      M = ~ mean(., na.rm = TRUE),
      SD = ~ sd(., na.rm = TRUE)
    ),
    fmt = list(~ gt::fmt_number(., decimals = 2))
  ) %>%
  
  ## Female Speakers
  gt::summary_rows(
    groups = "Female Speakers",
    columns = c(Age, Rating_M),
    fns = list(
      M = ~ mean(., na.rm = TRUE),
      SD = ~ sd(., na.rm = TRUE)
    ),
    fmt = list(~ gt::fmt_number(., decimals = 2))
  ) %>%
  
  
  # Adding footnote to Intelligibility
  gt::tab_footnote(
    footnote = "The reported intelligibility (%) scores are aggregated from the Visual Analog Scale (VAS) ratings made for conversational speech samples in the current study.",
    locations = gt::cells_column_labels(
      columns = Rating_M
    )
  ) %>%
  
  # Adding footnote to HCM02
  gt::tab_footnote(
    footnote = "The HCM02 speaker, while healthy and intelligible, had a Spanish accent that likely influenced his intelligibility ratings. Further discussion about this speaker and the implications for his intelligibility ratings can be found in the limitations section.",
    locations = gt::cells_body(
      columns = Rating_M,
      rows = StudyID =="HCM02"
    )
  ) %>%
  
  # Adding footnote to HCM04
  gt::tab_footnote(
    footnote = "The HCM04 speaker, presented with a perceptually rough voice quality consistent with healthy aging. This voice quality likely influenced his intelligibility ratings.",
    locations = gt::cells_body(
      columns = Rating_M,
      rows = StudyID =="HCM04"
    )
  ) %>%
  
  # Format groups
  gt::tab_options(row_group.as_column = TRUE) %>%
  
  # Hiding time since diagnosis and severity
  gt::cols_hide(columns = c(dxTime,Severity)) %>%
  
  # Saving the table
  gt::gtsave(filename = "SpeakerDemo_HC.html",
             path = "Data/Tables")
```

### PD Speakers
```{r}
# PD Speakers ----
speakerList %>%
  dplyr::filter(Group == "PD") %>%
  dplyr::select(!DatabaseID) %>%
  dplyr::arrange(StudyID) %>%
  
  # Creating the gt table
  gt::gt(rowname_col = "StudyID",
    groupname_col = "Sex") %>%
  
  # Title
  gt::tab_header(
      title = "Speaker Demographics"
      ) %>%
  
  # Replace missing values with blanks
  gt::sub_missing(
  columns = everything(),
  rows = everything(),
  missing_text = ""
  ) %>%
  
  # Renaming columns
  gt::cols_label(
    dxTime = "Time Since Diagnosis (Years)",
    Rating_M = "Intelligibility (%)",
  ) %>%
  
  # Formatting the Intelligibility data
  gt::fmt_number(
  columns = Rating_M,
  decimals = 2,
  ) %>%
  
  # Formatting the dxTime data
  gt::fmt_number(
  columns = dxTime,
  decimals = 0,
  ) %>%
  
  # Adding summary rows
  ## Male Speakers
  gt::summary_rows(
    groups = "Male Speakers",
    columns = c(Age, dxTime, Rating_M),
    fns = list(
      M = ~ mean(., na.rm = TRUE),
      SD = ~ sd(., na.rm = TRUE)
    ),
    fmt = list(~ gt::fmt_number(., decimals = 2))
  ) %>%
  
  ## Female Speakers
  gt::summary_rows(
    groups = "Female Speakers",
    columns = c(Age, dxTime, Rating_M),
    fns = list(
      M = ~ mean(., na.rm = TRUE),
      SD = ~ sd(., na.rm = TRUE)
    ),
    fmt = list(~ gt::fmt_number(., decimals = 2))
  ) %>%
  
  # Adding footnote to Intelligibility
  gt::tab_footnote(
    footnote = "The reported intelligibility (%) scores are aggregated from the Visual Analog Scale (VAS) ratings made for conversational speech samples in the current study.",
    locations = gt::cells_column_labels(
      columns = Rating_M
    )
  ) %>%
  
  # Adding footnote to Severity
  gt::tab_footnote(
    footnote = "Severity labels were determined based on the intelligibility measures using the surrogate-severity measures outlined in Stipancic et al. (2022). Specifically, intelligibility values > 94% are `Normal`, 85% - 94% are `Mild`, 70% - 84% are `Moderate`, 45% - 69% are `Severe`, and < 45% are `Profound`.",
    locations = gt::cells_column_labels(
      columns = Severity
    )
  ) %>%
  
  # Format groups
  gt::tab_options(row_group.as_column = TRUE) %>%
  
  # Saving the table
  gt::gtsave(filename = "SpeakerDemo_PD.html",
             path = "Data/Tables")

```

## Listener Descriptions
```{r}
listenerRatings <- rio::import(file = "Data/PreppedData/ListenerData/ListenerRatings_allRatings.csv")

ratingCount <- listenerRatings %>%
  dplyr::group_by(StudyID, ratingType) %>%
  dplyr::summarise(n = NROW(Rating)) %>%
  dplyr::ungroup()

ratingCount %>%
  dplyr::summarise(mean = mean(n),
                   sd = sd(n),
                   min = min(n),
                   max = max(n))

NROW(unique(listenerRatings$ListenerID))

listenerDemo <- rio::import(file = "Data/PreppedData/ListenerData/ListenerDemographics.csv")
NROW(unique(listenerDemo$ListenerID))

# Age and N
listenerDemo %>%
  dplyr::mutate(duration = `Duration (in seconds)`/60) %>%
  #dplyr::group_by(gender) %>%
  dplyr::summarise(age_m = mean(age, na.rm = T),
                   age_sd = sd(age, na.rm = T),
                   min = base::min(age, na.rm = T),
                   max = base::max(age, na.rm = T),
                   N = NROW(age),
                   duration_M = base::mean(duration, na.rm = T),
                   duration_sd = sd(duration, na.rm = T))

listenerDemo %>%
  dplyr::mutate(duration = `Duration (in seconds)`/60) %>%
  dplyr::group_by(gender) %>%
  dplyr::summarise(N = NROW(age))

listenerDemo %>%
  dplyr::mutate(duration = `Duration (in seconds)`/60) %>%
  dplyr::group_by(race) %>%
  dplyr::summarise(N = NROW(race))

listenerDemo %>%
  dplyr::mutate(duration = `Duration (in seconds)`/60) %>%
  dplyr::group_by(ethnicity) %>%
  dplyr::summarise(N = NROW(ethnicity))
```

## Descriptives Table
```{r}
# Perceptual Measures ----
perceptualMeasures <- rio::import(file = "Data/PreppedData/ListenerData/ListenerRatings_allRatings.csv") %>%
  dplyr::select(!1) %>%
  
  # Selecting only the data we need
  dplyr::select(DatabaseID, Group, Sex, condition, ratingType, Rating)
  
  ## By Sex
  perceptualMeasures_bySex <- perceptualMeasures %>%
    # Summarizing the measures by taking the average across groups
    dplyr::group_by(Group, Sex, condition, ratingType) %>%
    dplyr::summarise(
      M = mean(Rating, na.rm = T),
      SD = sd(Rating, na.rm = T),
      ) %>%
    
    # Pivoting the data back to wide for the table
    tidyr::pivot_wider(
      names_from = c(Group, condition),
      values_from = c(M,SD),
      )
  
  ## All Speakers
  perceptualMeasures_allSpeakers <- perceptualMeasures %>%
    # Summarizing the measures by taking the average across groups
    dplyr::group_by(Group, condition, ratingType) %>%
    dplyr::summarise(
      M = mean(Rating, na.rm = T),
      SD = sd(Rating, na.rm = T),
      ) %>%
    
    # Pivoting the data back to wide for the table
    tidyr::pivot_wider(
      names_from = c(Group, condition),
      values_from = c(M,SD),
      ) %>%
    
    # Add "All Speakers" label to the Sex
    dplyr::mutate(Sex = "All Speakers")
  
  
  perceptualMeasures <- base::rbind(
    perceptualMeasures_allSpeakers,
    perceptualMeasures_bySex,
    deparse.level = 1) %>%
    dplyr::relocate(Sex, .before = ratingType) %>%
    dplyr::rename(Measure = ratingType)
  
  # Removing the unneeded items
  rm(
    perceptualMeasures_allSpeakers,
    perceptualMeasures_bySex)
  
  

# VSA Measures ----
vsaMeasures <- rio::import(file = "Data/PreppedData/CollatedData/TargetMeasures_vsaMeasures.csv") %>%
    
    # Converting aVSA from Hz to kHz, to make table cleaner
    dplyr::mutate(aVSA = aVSA / 1000) %>%
  
    # Selecting only the data we need
    dplyr::select(DatabaseID:kVSA) %>%
    
    # Formatting for the table
    tidyr::pivot_longer(cols = aVSA:kVSA,
                        names_to = "Measure",
                        values_to = "Value")

  ## By Sex
  vsaMeasures_bySex <- vsaMeasures %>%
    # Summarizing the measures by taking the average across groups
    dplyr::group_by(Group, Sex, condition, Measure) %>%
    dplyr::summarise(
      M = mean(Value, na.rm = T),
      SD = sd(Value, na.rm = T),
      ) %>%
    
    # Pivoting the data back to wide for the table
    tidyr::pivot_wider(
      names_from = c(Group,condition),
      values_from = c(M,SD),
      )
  
  ## All Speakers
  vsaMeasures_allSpeakers <- vsaMeasures %>%
    # Summarizing the measures by taking the average across groups
    dplyr::group_by(Group, condition, Measure) %>%
    dplyr::summarise(
      M = mean(Value, na.rm = T),
      SD = sd(Value, na.rm = T),
      ) %>%
    
    # Pivoting the data back to wide for the table
    tidyr::pivot_wider(
      names_from = c(Group, condition),
      values_from = c(M,SD),
      ) %>%
    
    # Add "All Speakers" label to the Sex
    dplyr::mutate(Sex = "All Speakers")

vsaMeasures <- base::rbind(
  vsaMeasures_allSpeakers,
  vsaMeasures_bySex,
  deparse.level = 1
  ) %>%
  dplyr::relocate(Sex, .before = Measure)

  # Removing the unneeded items
  rm(
    vsaMeasures_allSpeakers,
    vsaMeasures_bySex)

# /ai/ Measures ----
aiMeasures <- rio::import(file = "Data/PreppedData/CollatedData/TargetMeasures_aiMeasures.csv") %>%
  
  # Selecting only the data we need
  dplyr::select(
    DatabaseID:Group,
    condition,
    acoDistance,
    kinDistance,
    F2_Slope,
    TB_speedMax,
    ) %>%
  
  # Formatting for the table
  tidyr::pivot_longer(cols = acoDistance:TB_speedMax,
                      names_to = "Measure",
                      values_to = "Value")
  
  ## By sex
  aiMeasures_bySex <- aiMeasures %>%
    # Summarizing the measures by taking the average across groups
    dplyr::group_by(Group, Sex, condition, Measure) %>%
    dplyr::summarise(
      M = mean(Value, na.rm = T),
      SD = sd(Value, na.rm = T),
    ) %>%
  
    # Pivoting the data back to wide for the table
    tidyr::pivot_wider(
      names_from = c(Group,condition),
      values_from = c(M,SD),
      )
  
  ## All Speakers
  aiMeasures_allSpeakers <- aiMeasures %>%
    # Summarizing the measures by taking the average across groups
    dplyr::group_by(Group, condition, Measure) %>%
    dplyr::summarise(
      M = mean(Value, na.rm = T),
      SD = sd(Value, na.rm = T),
    ) %>%
  
    # Pivoting the data back to wide for the table
    tidyr::pivot_wider(
      names_from = c(Group, condition),
      values_from = c(M,SD),
      ) %>%
  
    # Add "All Speakers" label to the Sex
    dplyr::mutate(Sex = "All Speakers")
  
  aiMeasures <- base::rbind(
    aiMeasures_allSpeakers,
    aiMeasures_bySex,
    deparse.level = 1
    ) %>%
    dplyr::relocate(Sex, .before = Measure)
  
  
  # Removing the unneeded items
  rm(
    aiMeasures_allSpeakers,
    aiMeasures_bySex)
  
  
# All Measures ----
descriptivesData <- base::rbind(
  perceptualMeasures,
  vsaMeasures,
  aiMeasures,
  deparse.level = 1
) %>%
    dplyr::mutate_at(vars(-c(Sex,Measure)), round, digits = 2) %>%
    dplyr::mutate(Measure = factor(
      Measure,
      levels = c(
        "Int",
        "AP",
        "aVSA",
        "acoDistance",
        "F2_Slope",
        "kVSA",
        "kinDistance",
        "dTB_speedMax",
        "TB_speedMax",
        "Jaw_speedMax"
       ),
       labels = c(
         "Intelligibility (VAS)",
         "Articulatory Precision (VAS)",
         "Acoustic VSA (kHz^2)",
         "Acoustic Distance (Hz)",
         "F2 Slope (Hz/ms)",
         "Kinematic VSA (mm^2)",
         "Kinematic Distance (mm)",
         "dTB Peak Speed (mm/s)",
         "TB Peak Speed (mm/s)",
         "Jaw Peak Speed (mm/s)"
         )),
        Sex = factor(Sex,
                             levels = c(
                               "All Speakers",
                               "M",
                               "F"),
                             labels = c(
                               "All Speakers",
                               "Male Speakers",
                               "Female Speakers"))) %>%
    dplyr::arrange(Measure) %>%
    dplyr::select(
      Sex, Measure,
      M_HC_conv, SD_HC_conv, M_PD_conv, SD_PD_conv,
      M_HC_lessClear, SD_HC_lessClear, M_PD_lessClear, SD_PD_lessClear,
      M_HC_moreClear, SD_HC_moreClear, M_PD_moreClear, SD_PD_moreClear,
    )
  
  # Creating the GT table
  descriptivesTable <- descriptivesData %>%
    gt::gt(
      rowname_col = "Measure",
      groupname_col = "Sex") %>%
    gt::tab_header(
      title = "Study 2: Descriptive Statistics",
      subtitle = "The target measures for study 2, presented for Conv, Less Clear, and More Clear speaking conditions."
      ) %>%
  # Spanner 1: PD Speakers
  gt::tab_spanner(
    label = "PD",
    level = 1,
    gather = FALSE,
    columns = c(M_PD_conv, SD_PD_conv,
                M_PD_lessClear, SD_PD_lessClear,
                M_PD_moreClear, SD_PD_moreClear)
  ) %>%
  # Spanner 1: HC Speakers
  gt::tab_spanner(
    label = "HC",
    level = 1,
    gather = FALSE,
    columns = c(M_HC_conv, SD_HC_conv,
                M_HC_lessClear, SD_HC_lessClear,
                M_HC_moreClear, SD_HC_moreClear)
  ) %>%
  # Spanner 2: Conversational
  gt::tab_spanner(
    label = "Conversational",
    level = 2,
    gather = TRUE,
    columns = c(M_HC_conv,
                SD_HC_conv,
                M_PD_conv,
                SD_PD_conv)
  ) %>%
  # Spanner 2: Less Clear
  gt::tab_spanner(
    label = "Less Clear",
    level = 2,
    gather = TRUE,
    columns = c(M_HC_lessClear,
                SD_HC_lessClear,
                M_PD_lessClear,
                SD_PD_lessClear)
  ) %>%
  # Spanner 2: More Clear
  gt::tab_spanner(
    label = "More Clear",
    level = 2,
    gather = TRUE,
    columns = c(M_HC_moreClear,
                SD_HC_moreClear,
                M_PD_moreClear,
                SD_PD_moreClear)
  ) %>%
  gt::cols_label(
    M_HC_conv = "M",
    SD_HC_conv = "SD",
    M_PD_conv = "M",
    SD_PD_conv = "SD",
    M_HC_lessClear = "M",
    SD_HC_lessClear = "SD",
    M_PD_lessClear = "M",
    SD_PD_lessClear = "SD",
    M_HC_moreClear = "M",
    SD_HC_moreClear = "SD",
    M_PD_moreClear = "M",
    SD_PD_moreClear = "SD"
  ) %>%
    
    # Align the measure labels to the right
    gt::cols_align(
      align = c("right"),
      columns = Measure
      ) %>%
  gt::tab_options(row_group.as_column = FALSE)
  
  # Save as HTML
  gt::gtsave(
    data = descriptivesTable,
    filename = "Data/Tables/descriptivesTable.html"
    )
  
  # Save as .docx
  gt::gtsave(
    data = descriptivesTable,
    filename = "Data/Tables/descriptivesTable.docx"
    )

    
```

# APA reporting function
```{r}

apa_lmResults <- function(model, fixedEffect) {
  
coefficients <- summary(model)[["coefficients"]] %>%
  as.data.frame() %>%
  dplyr::rename(
    stdError = `Std. Error`,
    t = `t value`,
    p = `Pr(>|t|)`) %>%
  dplyr::mutate(
    Estimate = round(Estimate, digits = 2),
    #df = round(df, digits = 2),
    t = round(t, digits = 2),
    p = round(p, digits = 3),
  ) %>%
  dplyr::filter(rownames(.) == fixedEffect)

if(coefficients$p < .001) {
  p <- "p<.001"
} else {
  p <- paste0("p=",as.numeric(coefficients$p))
}

df <- as.numeric(model$df.residual)
t <- paste0("t(",df,")=", as.numeric(coefficients$t))

CI_intervals <- stats::confint(model) %>%
  as.data.frame() %>%
  dplyr::mutate(
    ll = round(`2.5 %`, digits = 2),
    ul = round(`97.5 %`, digits = 2),
                ) %>%
  dplyr::select(ll, ul) %>%
  dplyr::filter(rownames(.) == fixedEffect)

CI <- base::paste0("95% CI [",
                  as.numeric(CI_intervals$ll),
                  ", ",
                  as.numeric(CI_intervals$ul),
                  "]")

formula <- paste(t, p, CI, sep = ", ")

return(formula)

rm(coefficients, t, p, CI_intervals, CI)
}

apa_lmeResults <- function(model, fixedEffect) {
  
coefficients <- summary(model)[["coefficients"]] %>%
  as.data.frame() %>%
  dplyr::rename(
    stdError = `Std. Error`,
    t = `t value`,
    p = `Pr(>|t|)`) %>%
  dplyr::mutate(
    Estimate = round(Estimate, digits = 2),
    df = round(df, digits = 2),
    t = round(t, digits = 2),
    p = round(p, digits = 3),
  ) %>%
  dplyr::filter(rownames(.) == fixedEffect)

if(coefficients$p < .001) {
  p <- "p<.001"
} else {
  p <- paste0("p=",as.numeric(coefficients$p))
}

t <- paste0("t(",as.numeric(coefficients$df),")=", as.numeric(coefficients$t))

CI_intervals <- stats::confint(model) %>%
  as.data.frame() %>%
  dplyr::mutate(
    ll = round(`2.5 %`, digits = 2),
    ul = round(`97.5 %`, digits = 2),
                ) %>%
  dplyr::select(ll, ul) %>%
  dplyr::filter(rownames(.) == fixedEffect)

CI <- base::paste0("95% CI [",
                  as.numeric(CI_intervals$ll),
                  ", ",
                  as.numeric(CI_intervals$ul),
                  "]")

formula <- paste(t, p, CI, sep = ", ")

return(formula)

rm(coefficients, t, p, CI_intervals, CI)
}

apa_levelDescriptives <- function(data,level, outcome) {

  
descriptiveData <- modelData %>%
  dplyr::select(Group, Sex, sym(outcome)) %>%
  dplyr::rename(outcome = 3)

group <- descriptiveData %>%
  dplyr::group_by(Group) %>%
  dplyr::summarize(M = mean(outcome, na.rm = T),
                SD = sd(outcome, na.rm = T),
                .groups = 'drop') %>%
  dplyr::mutate(M = round(M, digits = 2),
                SD = round(SD, digits = 2)) %>%
  dplyr::rename(Grouping = 1) %>%
  as.data.frame()

sex <- descriptiveData %>%
  dplyr::group_by(Sex) %>%
  dplyr::summarize(M = mean(outcome, na.rm = T),
                SD = sd(outcome, na.rm = T),
                .groups = 'drop') %>%
  dplyr::mutate(M = round(M, digits = 2),
                SD = round(SD, digits = 2)) %>%
  dplyr::rename(Grouping = 1) %>%
  as.data.frame()

groupSex <- descriptiveData %>%
  dplyr::group_by(Group, Sex) %>%
  dplyr::summarize(M = mean(outcome, na.rm = T),
                SD = sd(outcome, na.rm = T),
                .groups = 'drop') %>%
  dplyr::ungroup() %>%
  dplyr::mutate(M = round(M, digits = 2),
                SD = round(SD, digits = 2),
                Grouping = paste(Group, Sex, sep = "_")) %>%
  dplyr::select(Grouping, M, SD) %>%
  as.data.frame()

descriptives <- rbind(group,
                      sex,
                      groupSex) %>%
  dplyr::filter(Grouping == level)
  
  output <- paste0(level,": (M=",descriptives$M,", SD=",descriptives$SD,")")
  
  return(output)
  
  rm(descriptives, group, sex, groupSex)
  
}


apa_emmsPairs <- function(emmsPair, sex, Condition) {
  summary_table <- summary(emmsPair, infer = TRUE) %>%
    dplyr::filter(Sex == sex) %>%
    dplyr::filter(condition == condition)
  
if(summary_table$p.value < .001) {
  p <- "p < .001"
} else {
    p <- paste0("p=",
                round(summary_table$p.value, digits = 3))
  }
  
  if("t.ratio" %in% colnames(summary_table)) {
  output <- paste(
    sex,
    ", HC - PD: (",
    "t(",
    round(summary_table$df, digits = 2),
    ")=",
    as.numeric(round(summary_table$t.ratio, 2)),
    ", ",
    p,
    ")",
    sep = "")
  }
  
  
  if("z.ratio" %in% colnames(summary_table)) {
  output <- paste(
    sex,
    ", HC - PD: (",
    "z = (",
    as.numeric(round(summary_table$z.ratio, 2)),
    ", ",
    p,
    ")",
    sep = "")
  }
  
  return(output)
}

apa_s1_emmPairs <- function(emmsPair, sex, Condition) {
  summary_table <- summary(emmsPair, infer = TRUE) %>%
    dplyr::filter(Sex == sex) %>%
    dplyr::filter(condition == Condition)
  
  if(summary_table$p.value < .001) {
  p <- "p<.001"
} else {
    p <- paste0("p=",
                round(summary_table$p.value, digits = 3))
  }
  
  if("t.ratio" %in% colnames(summary_table)) {
  output <- paste(
    sex,
    ", HC - PD: (",
    "t(",
    round(summary_table$df, digits = 2),
    ")=",
    as.numeric(round(summary_table$t.ratio, 2)),
    ", ",
    p,
    ")",
    sep = "")
  }
  
  
  if("z.ratio" %in% colnames(summary_table)) {
  output <- paste(
    sex,
    ", HC - PD: (",
    "z=",
    as.numeric(round(summary_table$z.ratio, 2)),
    ", ",
    p,
    ")",
    sep = "")
  }
  
  return(output)
}

apa_s2_emmPairs <- function(emmsPair, Sex_Input, Group_Input, Contrast_Input) {
  summary_table <- summary(emmsPair, infer = TRUE) %>%
    dplyr::filter(Sex == Sex_Input) %>%
    dplyr::filter(Group == Group_Input) %>%
    dplyr::filter(contrast == Contrast_Input)
  
  if(summary_table$p.value < .001) {
  p <- "p<.001"
} else {
    p <- paste0("p=",
                round(summary_table$p.value, digits = 3))
  }
  
  if("t.ratio" %in% colnames(summary_table)) {
  output <- paste(
    Sex_Input,
    ", ",
    Group_Input,
    ", ",
    Contrast_Input,
    ": (",
    "t(",
    round(summary_table$df, digits = 2),
    ")=",
    as.numeric(round(summary_table$t.ratio, 2)),
    ", ",
    p,
    ")",
    sep = "")
  }
  
  
  if("z.ratio" %in% colnames(summary_table)) {
  output <- paste(
    Sex_Input,
    ", ",
    Group_Input,
    ", ",
    Contrast_Input,
    ": (",
    "z=",
    as.numeric(round(summary_table$z.ratio, 2)),
    ", ",
    p,
    ")",
    sep = "")
  }
  
  return(output)
}



```

# Study 1
The first study examines group differences between PD and HC for the following measures:
(1) Intelligibility
(2) Articulatory Precision
(3) Acoustic Distance
(4) Kinematic Distance (TB Displacement)
(5) Acoustic VSA
(6) Kinematic VSA
(7) F2 Slope
(8) Kinematic Speed (TB Peak Speed)

Alpha will be evaluated at the bonferonni corrected level of 0.0055.
```{r}
alpha_s1 <- .05/8

# Prepping the model folders to be saved
dir.create(path = "Data/Models/",showWarnings = F)
dir.create(path = "Data/Models/Study 1",showWarnings = F)
```

## Perceptual Measures
### 1. Intelligibility
```{r}
perceptualMeasures <- rio::import(file = "Data/PreppedData/ListenerData/ListenerRatings_allRatings.csv") %>%
  dplyr::select(!V1) %>%
  dplyr::filter(ratingType == "Int") %>%
  dplyr::rename(Int = Rating) %>%
  dplyr::mutate(Sex = factor(Sex, levels = c("M","F")),
                condition = factor(condition,
                                   levels = c("conv",
                                              "moreClear",
                                              "lessClear")))

modelData <- perceptualMeasures

# Taking out the trash
rm(perceptualMeasures)
```

M0 - Fully unconditional model
```{r}
# Building the model
Int_m0 <- lmerTest::lmer(Int ~ 1 +
                           (1 | ListenerID) +
                           (1 | StudyID),
                         data = modelData)
# Model summary
summary(Int_m0)

```

M1 - Condition
```{r}
# Building the model
Int_m1 <- lmerTest::lmer(Int ~ condition +
                           (1 | ListenerID) +
                           (1 | StudyID),
                         data = modelData)
# Model summary
summary(Int_m1)

# Perform likelihood ratio test
anova(Int_m0, Int_m1)

```
M2 - Condition*Group
```{r}
# Building the model
Int_m2 <- lmerTest::lmer(Int ~ 
                           condition*Group +
                           (1 | ListenerID) +
                           (1 | StudyID),
                         data = modelData)
# Model summary
summary(Int_m2)

# Perform likelihood ratio test
anova(Int_m1, Int_m2)
```

M3 - Condition*Group*Sex
```{r}
# Building the model
Int_m3 <- lmerTest::lmer(Int ~ condition*Group*Sex +
                           (1 | ListenerID) +
                           (1 | StudyID),
                         data = modelData)
# Model summary
summary(Int_m3)

# Perform likelihood ratio test
anova(Int_m2, Int_m3)

```

#### Final Model
```{r}
Int_finalModel <- Int_m3

summary(Int_finalModel)

# Compute EMMs for Group and Sex
emms_group <- emmeans(Int_finalModel, ~ Group | Sex*condition)
emms_condition <- emmeans(Int_finalModel, ~ condition | Sex*Group)

# Compare EMMs for Group and Sex
pairs(emms_group)
t <- summary(pairs(emms_condition))

apa_s2_emmPairs(pairs(emms_condition),
                Sex_Input = "M",
                Group_Input = "HC",
                Contrast_Input = "conv - moreClear")
apa_s2_emmPairs(pairs(emms_condition),
                Sex_Input = "F",
                Group_Input = "HC",
                Contrast_Input = "conv - moreClear")

# Saving the model
base::saveRDS(
  object = Int_finalModel,
  file = "Data/Models/Study 1/Int_finalModel.rds")

# Taking out the trash
rm(list=ls(pattern="^Int_m"))
rm(list=ls(pattern="^emms_"))
rm(modelData)
```

### 2. Articulatory Precision
```{r}
perceptualMeasures <- rio::import(file = "Data/PreppedData/ListenerData/ListenerRatings_allRatings.csv") %>%
  dplyr::select(!V1) %>%
  #dplyr::filter(condition == "conv") %>%
  dplyr::filter(ratingType == "AP") %>%
  dplyr::rename(AP = Rating) %>%
  dplyr::mutate(Sex = factor(Sex, levels = c("M","F")),
                condition = factor(condition,
                                   levels = c("conv",
                                              "moreClear",
                                              "lessClear")))

modelData <- perceptualMeasures

# Taking out the trash
rm(perceptualMeasures)
```

M0 - Fully unconditional model
```{r}
# Building the model
AP_m0 <- lmerTest::lmer(AP ~ 1 +
                           (1 | ListenerID) +
                           (1 | StudyID),
                         data = modelData)
# Model summary
summary(AP_m0)

```

M1 - Condition
```{r}
# Building the model
AP_m1 <- lmerTest::lmer(AP ~ condition +
                           (1 | ListenerID) +
                           (1 | StudyID),
                         data = modelData)
# Model summary
summary(AP_m1)

# Perform likelihood ratio test
anova(AP_m0, AP_m1)

```

M2 - Condition*Group
```{r}
# Building the model
AP_m2 <- lmerTest::lmer(AP ~
                           condition*Group +
                           (1 | ListenerID) +
                           (1 | StudyID),
                         data = modelData)
# Model summary
summary(AP_m2)

# Perform likelihood ratio test
anova(AP_m1, AP_m2)

```

M3 - Condition*Group*Sex
```{r}
# Building the model
AP_m3 <- lmerTest::lmer(AP ~ condition*Group*Sex +
                           (1 | ListenerID) +
                           (1 | StudyID),
                         data = modelData)
# Model summary
summary(AP_m3)

# Perform likelihood ratio test
anova(AP_m2, AP_m3)
```

#### Final Model
```{r}
AP_finalModel <- AP_m3

summary(AP_finalModel)

# Compute EMMs for Group and Sex
emms_group <- emmeans(AP_finalModel, ~ Group | Sex*condition)
emms_condition <- emmeans(AP_finalModel, ~ condition | Sex*Group)

# Compare EMMs for Group and Sex
pairs(emms_group)
pairs(emms_condition)

# APA Reporting
apa_s1_emmPairs(pairs(emms_group),
                sex = "F",
                Condition = "conv")

# Saving the model
base::saveRDS(
  object = AP_finalModel,
  file = "Data/Models/Study 1/AP_finalModel.rds")

# Taking out the trash
rm(list=ls(pattern="^AP_m"))
rm(list=ls(pattern="^emms"))
rm(modelData)
```

## Acoustic Measures

### 3. aVSA
```{r}
vsaMeasures <- rio::import(file = "Data/PreppedData/CollatedData/TargetMeasures_vsaMeasures.csv") %>%
  #dplyr::filter(condition == "conv") %>%
  dplyr::mutate(Sex = factor(Sex, levels = c("M","F")),
                condition = factor(condition,
                                   levels = c("conv",
                                              "moreClear",
                                              "lessClear")),
                aVSA = aVSA/1000)

modelData <- vsaMeasures

# Taking out the trash
rm(vsaMeasures)
```

M0 - Fully unconditional model
```{r}
# Building the model
aVSA_m0 <- lmerTest::lmer(aVSA ~ 1 +
                       (1 | StudyID),
                     data = modelData)

# Model summary
summary(aVSA_m0)

```

M1 - Condition
```{r}
# Building the model
aVSA_m1 <- lmerTest::lmer(aVSA ~ condition +
                       (1 | StudyID),
                     data = modelData)
# Model summary
summary(aVSA_m1)

# Perform likelihood ratio test
anova(aVSA_m0, aVSA_m1)

```
M2 - Condition*Group
```{r}
# Building the model
aVSA_m2 <- lmerTest::lmer(aVSA ~ condition*Group +
                       (1 | StudyID),
                     data = modelData)
# Model summary
summary(aVSA_m2)

# Perform likelihood ratio test
anova(aVSA_m1, aVSA_m2)
```

M3 - Condition*Group*Sex
```{r}
# Building the model
aVSA_m3 <- lmerTest::lmer(aVSA ~ condition*Group*Sex +
                       (1 | StudyID),
                     data = modelData)
# Model summary
summary(aVSA_m3)

# Perform likelihood ratio test
anova(aVSA_m2, aVSA_m3)
```

#### Final Model
```{r}
aVSA_finalModel <- aVSA_m3

summary(aVSA_finalModel)

# Compute EMMs for Group and Sex
emms_group <- emmeans(aVSA_finalModel, ~ Group | Sex*condition)
emms_condition <- emmeans(aVSA_finalModel, ~ condition | Sex*Group)

# Compare EMMs for Group and Sex
pairs(emms_group)
pairs(emms_condition)

# APA Reporting
apa_s1_emmPairs(pairs(emms_group),
                sex = "F",
                Condition = "conv")
apa_s1_emmPairs(pairs(emms_group),
                sex = "M",
                Condition = "conv")

# Saving the model
base::saveRDS(
  object = aVSA_finalModel,
  file = "Data/Models/Study 1/aVSA_finalModel.rds")

# Taking out the trash
rm(list=ls(pattern="^aVSA_m"))
rm(list=ls(pattern="^emms"))
rm(modelData)
```
### 4. Aco Distance
```{r}
aiMeasures <- rio::import(file = "Data/PreppedData/CollatedData/TargetMeasures_aiMeasures.csv") %>%
  #dplyr::filter(condition == "conv") %>%
  dplyr::mutate(Sex = factor(Sex, levels = c("M","F")),
                condition = factor(condition,
                                   levels = c("conv",
                                              "moreClear",
                                              "lessClear")))

modelData <- aiMeasures

# Taking out the trash
rm(aiMeasures)
```

M0 - Fully unconditional model
```{r}
# Building the model
acoDistance_m0 <- lmerTest::lmer(acoDistance ~ 1 +
                           (1 | StudyID),
                         data = modelData)
# Model summary
summary(acoDistance_m0)

```

M1 - Condition
```{r}
# Building the model
acoDistance_m1 <- lmerTest::lmer(acoDistance ~ condition +
                           (1 | StudyID),
                         data = modelData)
# Model summary
summary(acoDistance_m1)

# Perform likelihood ratio test
anova(acoDistance_m0, acoDistance_m1)

```
M2 - condition*Group
```{r}
# Building the model
acoDistance_m2 <- lmerTest::lmer(acoDistance ~ condition*Group +
                           (1 | StudyID),
                         data = modelData)
# Model summary
summary(acoDistance_m2)

# Perform likelihood ratio test
anova(acoDistance_m1, acoDistance_m2)
```

M3 - Condition*Group*Sex
```{r}
# Building the model
acoDistance_m3 <- lmerTest::lmer(acoDistance ~ condition*Group*Sex +
                           (1 | StudyID),
                         data = modelData)
# Model summary
summary(acoDistance_m3)

# Perform likelihood ratio test
anova(acoDistance_m2, acoDistance_m3)
```

#### Final Model
```{r}
acoDistance_finalModel <- acoDistance_m3

summary(acoDistance_finalModel)

# Compute EMMs for Group and Sex
emms_group <- emmeans(acoDistance_finalModel, ~ Group | Sex*condition)
emms_condition <- emmeans(acoDistance_finalModel, ~ condition | Sex*Group)

# Compare EMMs for Group and Sex
pairs(emms_group)
pairs(emms_condition)

# APA Reporting
apa_s1_emmPairs(pairs(emms_group),
                sex = "F",
                Condition = "conv")
apa_s1_emmPairs(pairs(emms_group),
                sex = "M",
                Condition = "conv")

# Saving the model
base::saveRDS(
  object = acoDistance_finalModel,
  file = "Data/Models/Study 1/acoDistance_finalModel.rds")

# Taking out the trash
rm(list=ls(pattern="^acoDistance_m"))
rm(list=ls(pattern="^emms"))
rm(modelData)
```

### 5. F2 Slope
```{r}
aiMeasures <- rio::import(file = "Data/PreppedData/CollatedData/TargetMeasures_aiMeasures.csv") %>%
  dplyr::mutate(Sex = factor(Sex, levels = c("M","F")))

modelData <- aiMeasures

# Taking out the trash
rm(aiMeasures)
```

M0 - Fully unconditional model
```{r}
# Building the model
F2_Slope_m0 <- lmerTest::lmer(F2_Slope ~ 1 +
                           (1 | StudyID),
                         data = modelData)
# Model summary
summary(F2_Slope_m0)

```

M1 - condition
```{r}
# Building the model
F2_Slope_m1 <- lmerTest::lmer(F2_Slope ~ condition +
                           (1 | StudyID),
                         data = modelData)
# Model summary
summary(F2_Slope_m1)

# Perform likelihood ratio test
anova(F2_Slope_m0, F2_Slope_m1)
```
M2 - condition*Group
```{r}
# Building the model
F2_Slope_m2 <- lmerTest::lmer(F2_Slope ~ condition*Group +
                           (1 | StudyID),
                         data = modelData)
# Model summary
summary(F2_Slope_m2)

# Perform likelihood ratio test
anova(F2_Slope_m1, F2_Slope_m2)

```

M3 - Condition*Group*Sex
```{r}
# Building the model
F2_Slope_m3 <- lmerTest::lmer(F2_Slope ~ condition*Group*Sex +
                           (1 | StudyID),
                         data = modelData)
# Model summary
summary(F2_Slope_m3)

# Perform likelihood ratio test
anova(F2_Slope_m2, F2_Slope_m3)
```

#### Final Model
```{r}
F2_Slope_finalModel <- F2_Slope_m3

summary(F2_Slope_finalModel)

# Compute EMMs for Group and Sex
emms_group <- emmeans(F2_Slope_finalModel, ~ Group | Sex*condition)
emms_condition <- emmeans(F2_Slope_finalModel, ~ condition | Sex*Group)

# APA Reporting
apa_s1_emmPairs(pairs(emms_group),
                sex = "F",
                Condition = "conv")
apa_s1_emmPairs(pairs(emms_group),
                sex = "M",
                Condition = "conv")

# Saving the model
base::saveRDS(
  object = F2_Slope_finalModel,
  file = "Data/Models/Study 1/F2_Slope_finalModel.rds")

# Taking out the trash
rm(list=ls(pattern="^F2_Slope_m"))
rm(list=ls(pattern="^emms"))
rm(modelData)
```


## Kinematic Measures
### 6. kVSA

```{r}
vsaMeasures <- rio::import(file = "Data/PreppedData/CollatedData/TargetMeasures_vsaMeasures.csv") %>%
  dplyr::mutate(Sex = factor(Sex, levels = c("M","F")))

modelData <- vsaMeasures

# Taking out the trash
rm(vsaMeasures)
```

M0 - Fully unconditional model
```{r}
# Building the model
kVSA_m0 <- stats::lm(kVSA ~ 1,
                     data = modelData)
# Model summary
summary(kVSA_m0)

```

M1 - Group
```{r}
# Building the model
kVSA_m1 <- stats::lm(kVSA ~ condition,
                         data = modelData)
# Model summary
summary(kVSA_m1)

# Perform likelihood ratio test
anova(kVSA_m0, kVSA_m1)
```
M2 - Condition*Group
```{r}
# Building the model
kVSA_m2 <- stats::lm(kVSA ~ condition*Group,
                         data = modelData)
# Model summary
summary(kVSA_m2)

# Perform likelihood ratio test
anova(kVSA_m1, kVSA_m2)
```

M3 - Condition*Group*Sex
```{r}
# Building the model
kVSA_m3 <- stats::lm(kVSA ~ condition*Group*Sex,
                         data = modelData)
# Model summary
summary(kVSA_m3)

# Perform likelihood ratio test
anova(kVSA_m2, kVSA_m3)

```

#### Final Model
```{r}
kVSA_finalModel <- kVSA_m1

summary(kVSA_finalModel)

# Saving the model
base::saveRDS(
  object = kVSA_finalModel,
  file = "Data/Models/Study 1/kVSA_finalModel.rds")

# Taking out the trash
rm(list=ls(pattern="^kVSA_m"))
rm(list=ls(pattern="^emms"))
rm(modelData)
```

### 7. Kin Distance
```{r}
aiMeasures <- rio::import(file = "Data/PreppedData/CollatedData/TargetMeasures_aiMeasures.csv") %>%
  dplyr::mutate(Sex = factor(Sex, levels = c("M","F")))

modelData <- aiMeasures

# Taking out the trash
rm(aiMeasures)
```

M0 - Fully unconditional model
```{r}
# Building the model
kinDistance_m0 <- lmerTest::lmer(kinDistance ~ 1 +
                           (1 | StudyID),
                         data = modelData)
# Model summary
summary(kinDistance_m0)

```

M1 - Condition
```{r}
# Building the model
kinDistance_m1 <- lmerTest::lmer(kinDistance ~ condition +
                           (1 | StudyID),
                         data = modelData)
# Model summary
summary(kinDistance_m1)

# Perform likelihood ratio test
anova(kinDistance_m0, kinDistance_m1)

```
M2 - Condition*Group
```{r}
# Building the model
kinDistance_m2 <- lmerTest::lmer(kinDistance ~ condition*Group +
                           (1 | StudyID),
                         data = modelData)
# Model summary
summary(kinDistance_m2)

# Perform likelihood ratio test
anova(kinDistance_m1, kinDistance_m2)
```

M3 - Condition*Group*Sex
```{r}
# Building the model
kinDistance_m3 <- lmerTest::lmer(kinDistance ~ condition*Group*Sex +
                           (1 | StudyID),
                         data = modelData)
# Model summary
summary(kinDistance_m3)

# Perform likelihood ratio test
anova(kinDistance_m2, kinDistance_m3)

```

#### Final Model
```{r}
kinDistance_finalModel <- kinDistance_m2

summary(kinDistance_finalModel)

# Saving the model
base::saveRDS(
  object = kinDistance_finalModel,
  file = "Data/Models/Study 1/kinDistance_finalModel.rds")

# Taking out the trash
rm(list=ls(pattern="^kinDistance_m"))
rm(list=ls(pattern="^emms"))
rm(modelData)
```

### 8. TB Speed Max
```{r}
aiMeasures <- rio::import(file = "Data/PreppedData/CollatedData/TargetMeasures_aiMeasures.csv") %>%
  dplyr::mutate(Sex = factor(Sex, levels = c("M","F")))

modelData <- aiMeasures

# Taking out the trash
rm(aiMeasures)
```

M0 - Fully unconditional model
```{r}
# Building the model
TB_speedMax_m0 <- lmerTest::lmer(TB_speedMax ~ 1 +
                           (1 | StudyID),
                         data = modelData)
# Model summary
summary(TB_speedMax_m0)

```

M1 - Condition
```{r}
# Building the model
TB_speedMax_m1 <- lmerTest::lmer(TB_speedMax ~ condition +
                           (1 | StudyID),
                         data = modelData)
# Model summary
summary(TB_speedMax_m1)

# Perform likelihood ratio test
anova(TB_speedMax_m0, TB_speedMax_m1)

```
M2 - Condition*Group
```{r}
# Building the model
TB_speedMax_m2 <- lmerTest::lmer(TB_speedMax ~ condition*Group +
                           (1 | StudyID),
                         data = modelData)
# Model summary
summary(TB_speedMax_m2)

# Perform likelihood ratio test
anova(TB_speedMax_m1, TB_speedMax_m2)
```

M3 - Condition*Group*Sex
```{r}
# Building the model
TB_speedMax_m3 <- lmerTest::lmer(TB_speedMax ~ condition*Group*Sex +
                           (1 | StudyID),
                         data = modelData)
# Model summary
summary(TB_speedMax_m3)

# Perform likelihood ratio test
anova(dTB_speedMax_m2, dTB_speedMax_m3)
```

#### Final Model
```{r}
TB_speedMax_finalModel <- TB_speedMax_m1

summary(TB_speedMax_finalModel)

# Saving the model
base::saveRDS(
  object = TB_speedMax_finalModel,
  file = "Data/Models/Study 1/TB_speedMax_finalModel.rds")

# Taking out the trash
rm(list=ls(pattern="^dTB_speedMax_m"))
rm(list=ls(pattern="^emms"))
rm(modelData)
```

## Study 1: Model Table
```{r}
# Load in the models
Int_finalModel <- readRDS(file = "Data/Models/Study 1/Int_finalModel.rds")
AP_finalModel <- readRDS(file = "Data/Models/Study 1/AP_finalModel.rds")
aVSA_finalModel <- readRDS(file = "Data/Models/Study 1/aVSA_finalModel.rds")
acoDistance_finalModel <- readRDS(file = "Data/Models/Study 1/acoDistance_finalModel.rds")
F2_Slope_finalModel <- readRDS(file = "Data/Models/Study 1/F2_Slope_finalModel.rds")
kVSA_finalModel <- readRDS(file = "Data/Models/Study 1/kVSA_finalModel.rds")
kinDistance_finalModel <- readRDS(file = "Data/Models/Study 1/kinDistance_finalModel.rds")
TB_speedMax_finalModel <- readRDS(file = "Data/Models/Study 1/TB_speedMax_finalModel.rds")

# SJ Plot Tab Model
sjPlot::tab_model(
  Int_finalModel,
  AP_finalModel,
  aVSA_finalModel,
  acoDistance_finalModel,
  F2_Slope_finalModel,
  kVSA_finalModel,
  kinDistance_finalModel,
  TB_speedMax_finalModel,
  show.reflvl = T,
  file = "Data/Models/Study 1/Study 1_ModelTable.html"
)

sjPlot::plot_models(
  Int_finalModel,
  AP_finalModel,
  aVSA_finalModel,
  acoDistance_finalModel,
  F2_Slope_finalModel,
  kVSA_finalModel,
  kinDistance_finalModel,
  dTB_speedMax_finalModel,
  Jaw_speedMax_finalModel,
  std.est = T,
  p.shape = T,
  p.threshold = c(0.005555556, 0.0000000001, 0.0000000001))

# Table for Int
summary_Int <- summary(Int_finalModel) %>%
  .$coefficients %>%
  as.data.frame() %>%
  base::merge(
    .,
    stats::confint(Int_finalModel),
    by = 'row.names') %>%
  dplyr::rename(Predictors = Row.names) %>%
  dplyr::mutate(Model = "Int") %>%
  dplyr::relocate(Model, .before = Predictors)

# Table for AP
summary_AP <- summary(AP_finalModel) %>%
  .$coefficients %>%
  as.data.frame() %>%
  base::merge(
    .,
    stats::confint(AP_finalModel),
    by = 'row.names') %>%
  dplyr::rename(Predictors = Row.names) %>%
  dplyr::mutate(Model = "AP") %>%
  dplyr::relocate(Model, .before = Predictors)

# Table for aVSA
summary_aVSA <- summary(aVSA_finalModel) %>%
  .$coefficients %>%
  as.data.frame() %>%
  base::merge(
    .,
    stats::confint(aVSA_finalModel),
    by = 'row.names') %>%
  dplyr::rename(Predictors = Row.names) %>%
  dplyr::mutate(Model = "aVSA") %>%
  dplyr::relocate(Model, .before = Predictors)

# Table for acoDistance
summary_acoDistance <- summary(acoDistance_finalModel) %>%
  .$coefficients %>%
  as.data.frame() %>%
  base::merge(
    .,
    stats::confint(acoDistance_finalModel),
    by = 'row.names') %>%
  dplyr::rename(Predictors = Row.names) %>%
  dplyr::mutate(Model = "acoDistance") %>%
  dplyr::relocate(Model, .before = Predictors)

# Table for F2 Slope
summary_F2_Slope <- summary(F2_Slope_finalModel) %>%
  .$coefficients %>%
  as.data.frame() %>%
  base::merge(
    .,
    stats::confint(F2_Slope_finalModel),
    by = 'row.names') %>%
  dplyr::rename(Predictors = Row.names) %>%
  dplyr::mutate(Model = "F2_Slope") %>%
  dplyr::relocate(Model, .before = Predictors)

# Table for kVSA
summary_kVSA <- summary(kVSA_finalModel) %>%
  .$coefficients %>%
  as.data.frame() %>%
  base::merge(
    .,
    stats::confint(kVSA_finalModel),
    by = 'row.names') %>%
  dplyr::rename(Predictors = Row.names) %>%
  dplyr::mutate(Model = "kVSA") %>%
  dplyr::relocate(Model, .before = Predictors)

# Table for kinDistance
summary_kinDistance <- summary(kinDistance_finalModel) %>%
  .$coefficients %>%
  as.data.frame() %>%
  base::merge(
    .,
    stats::confint(kinDistance_finalModel),
    by = 'row.names') %>%
  dplyr::rename(Predictors = Row.names) %>%
  dplyr::mutate(Model = "kinDistance") %>%
  dplyr::relocate(Model, .before = Predictors)

# Table for dTB Speed
summary_dTB_speedMax <- summary(dTB_speedMax_finalModel) %>%
  .$coefficients %>%
  as.data.frame() %>%
  base::merge(
    .,
    stats::confint(dTB_speedMax_finalModel),
    by = 'row.names') %>%
  dplyr::rename(Predictors = Row.names) %>%
  dplyr::mutate(Model = "dTB Speed Max") %>%
  dplyr::relocate(Model, .before = Predictors)

# Table for Jaw Speed
summary_Jaw_speedMax <- summary(Jaw_speedMax_finalModel) %>%
  .$coefficients %>%
  as.data.frame() %>%
  base::merge(
    .,
    stats::confint(Jaw_speedMax_finalModel),
    by = 'row.names') %>%
  dplyr::rename(Predictors = Row.names) %>%
  dplyr::mutate(Model = "Jaw Speed Max") %>%
  dplyr::relocate(Model, .before = Predictors)

summaryTable_data <- dplyr::bind_rows(
  summary_Int,
  summary_AP,
  summary_aVSA,
  summary_acoDistance,
  summary_F2_Slope,
  summary_kVSA,
  summary_kinDistance,
  summary_dTB_speedMax,
  summary_Jaw_speedMax,
) %>%
  dplyr::mutate_at(.vars = c("Estimate",
                             "Std. Error",
                             "df",
                             "t value",
                             "2.5 %",
                             "97.5 %"),
                   .funs = round,
                   digits = 2) %>%
  dplyr::mutate(CI = paste(`2.5 %`,`97.5 %`, sep = " - ")) %>%
  dplyr::rename(p = `Pr(>|t|)`) %>%
  dplyr::mutate(p = round(p, digits = 3)) %>%
  dplyr::select(Model, Predictors, Estimate,CI,p) %>%
  dplyr::mutate(
    Label = case_when(
      Model == "Int" ~ "Intelligibility Ratings",
      Model == "AP" ~ "Articulatory Precision Ratings",
      Model == "aVSA" ~ "Acoustic VSA",
      Model == "acoDistance" ~ "Acoustic Distance",
      Model == "F2_Slope" ~ "F2 Slope",
      Model == "kVSA" ~ "Kinematic VSA",
      Model == "kinDistance" ~ "Kinematic Distance",
      Model == "dTB Speed Max" ~ "dTB Speed Max",
      Model == "Jaw Speed Max" ~ "Jaw Speed Max"),
  # Formating SexF to Sex [F]
  Predictors = base::gsub(pattern = "SexF",
                     replacement = "Sex [F]",
                     x = Predictors),
  # Formating GroupPD to Group [PD]
  Predictors = base::gsub(pattern = "GroupPD",
                     replacement = "Group [PD]",
                     x = Predictors),
  ) %>%
  dplyr::relocate(Label, .before = Model)

summaryTable <- summaryTable_data %>%
  gt::gt(
    rowname_col = "Predictors",
    groupname_col = "Label") %>%
  gt::tab_header(
      title = "Study 1: Model Statistics",
      subtitle = "The statistics for the various models created in Study 1."
      ) %>%
  
  # Hiding the "Model" column, we will use tab row groups instead
  gt::cols_hide(columns = Model) %>%
  
  # Making the significant p-values bold, based on the alpha
  gt::tab_style(
    style = list(
      gt::cell_text(weight = "bold")
      ),
    locations = gt::cells_body(
      columns = p,
      rows = p < alpha_s1
    )
  ) %>%
  gt::tab_options(row_group.as_column = TRUE)

summaryTable %>%
  gt::gtsave(filename = "s1_modelTable.docx",
             path = "Data/Tables")
summaryTable %>%
  gt::gtsave(filename = "s1_modelTable.html",
             path = "Data/Tables")
  

```


# Plots - Condition
```{r}
myPal <- rcartocolor::carto_pal(n = 7, name = "Geyser")[c(1, 2, 3, 4, 5, 6, 7)]
color_HC <- myPal[2] 
color_PD <- myPal[6]
```

## 1. Intelligibility
```{r}
plot_Int_data <- rio::import(file = "Data/PreppedData/ListenerData/ListenerRatings_allRatings.csv") %>%
  dplyr::select(!V1) %>%
  dplyr::filter(ratingType == "Int") %>%
  dplyr::rename(Int = Rating) %>%
  dplyr::mutate(Sex = factor(Sex,
                             levels = c("M","F"),
                             labels = c("Male Speakers",
                                        "Female Speakers")),
                condition = factor(condition,
                                   levels = c(
                                     "lessClear",
                                     "conv",
                                     "moreClear"
                                   ),
                                   labels = c(
                                     "Less\nClear",
                                     "Conv",
                                     "More\nClear"
                                   ))) %>%
  dplyr::group_by(Sex, Group, condition) %>%
  dplyr::summarise(M = mean(Int, na.rm = T),
                   SE = plotrix::std.error(Int, na.rm = T)) %>%
  dplyr::ungroup() %>%
  dplyr::mutate(upper = M + SE,
                lower = M - SE)

plotData <- plot_Int_data

lim_y <- c(0,
          (base::max(plotData$upper) + base::max(plotData$upper)*.45))
lim_group <- base::max(plotData$upper) + base::max(plotData$upper)*.10
lim_group
lim_condition_HC <- base::max(plotData$upper) + base::max(plotData$upper)*.25
lim_condition_HC

lim_condition_PD <- base::max(plotData$upper) + base::max(plotData$upper)*.40
lim_condition_PD


  # Making the Plot
plot_Int <- plotData %>%
  ggplot() +
  aes(y = M,
      x = condition) +
  
  # Line
  geom_line(
    aes(color = Group,
        group = Group),
    alpha = .6,
    ) +
  
  # Error Bars
  geom_errorbar(aes(
    ymin = lower,
    ymax = upper,
    color = Group,
    group = Group
    ),
    width = .1,
    ) +
  
  # Point
  geom_point(
    aes(color = Group,
        group = Group),
    ) +

  # Adding significance bars - HC*Condition ----
  ggsignif::geom_signif(data = data.frame(Group = c("Less\nClear",
                                          "Conv",
                                         "More\nClear")),
                        aes(y_position = c(rep(lim_condition_HC, 6)),
                            xmin = c(1.1, 2.1, NA, 1.1, 2.1, NA),
                            xmax = c(1.9, 2.9, NA, 1.9, 2.9, NA),
                            annotations = c("*", "*", NA, "*", "*", NA),
                            group=c(1,2,3,4,5,6)),
                        vjust = .5,
                        color = color_HC,
                        tip_length = 0,
                        manual = T) +
  
  # Adding significance bars - PD*Condition ----
  ggsignif::geom_signif(data = data.frame(Group = c("Less\nClear",
                                          "Conv",
                                         "More\nClear")),
                        aes(y_position = c(rep(lim_condition_PD, 6)),
                            xmin = c(1.1, 2.1, NA, 1.1, 2.1, NA),
                            xmax = c(1.9, 2.9, NA, 1.9, 2.9, NA),
                            annotations = c("*", "*", NA, "*", "*", NA),
                            group=c(1,2,3,4,5,6)),
                        vjust = .5,
                        color = color_PD,
                        tip_length = 0,
                        manual = T) +
  
  # Adding significance bars - Group ----
  ggsignif::geom_signif(data = data.frame(Group = c("Less\nClear",
                                          "Conv",
                                         "More\nClear")),
                        aes(y_position = c(rep(lim_group, 6)),
                            xmin = c(.9, 1.9, 2.9, NA, NA, NA),
                            xmax = c(1.1, 2.1, 3.1, NA, NA, NA),
                            annotations = c("*", "*", "*", NA, NA, NA),
                            group=c(1,2,3,4,5,6)),
                        vjust = .5,
                        color = "black",
                        tip_length = 0,
                        manual = T) +
  
  # Facet by Sex
  facet_grid(~Sex) +
  
  # Changing the y axis scale
  coord_cartesian(ylim = lim_y) +
  scale_y_continuous(breaks=c(0, 25, 50, 75, 100)) +
  
  # Changing the theme, labels, and title
  theme_minimal() +
  labs(y = "VAS Rating") +
  ggtitle("Intelligibility") +
  theme(
    aspect.ratio = 1,
    plot.title = element_text(hjust = 0.5),
    #axis.text.x = element_blank(),
    #axis.ticks.x = element_blank(),
    axis.title.x = element_blank(),
    ) +
  
  # Color Palate
  scale_color_manual(values = c(color_HC,color_PD)) +
  scale_fill_manual(values = c(color_HC,color_PD))

plot_Int
```

## 2. Articulatory Precision
```{r}
plot_AP_data <- rio::import(file = "Data/PreppedData/ListenerData/ListenerRatings_allRatings.csv") %>%
  dplyr::select(!V1) %>%
  dplyr::filter(ratingType == "AP") %>%
  dplyr::rename(AP = Rating) %>%
  dplyr::mutate(Sex = factor(Sex,
                             levels = c("M",
                                        "F"),
                             labels = c("Male Speakers",
                                        "Female Speakers")
                             ),
                condition = factor(condition,
                                   levels = c(
                                     "lessClear",
                                     "conv",
                                     "moreClear"
                                   ),
                                   labels = c(
                                     "Less\nClear",
                                     "Conv",
                                     "More\nClear"
                                   ))) %>%
  dplyr::group_by(Sex, Group, condition) %>%
  dplyr::summarise(M = mean(AP, na.rm = T),
                   SE = plotrix::std.error(AP, na.rm = T)) %>%
  dplyr::ungroup() %>%
  dplyr::mutate(upper = M + SE,
                lower = M - SE)

plotData <- plot_AP_data

lim_y <- c(0,
          (base::max(plotData$upper) + base::max(plotData$upper)*.45))
lim_group <- base::max(plotData$upper) + base::max(plotData$upper)*.10
lim_group
lim_condition_HC <- base::max(plotData$upper) + base::max(plotData$upper)*.25
lim_condition_HC

lim_condition_PD <- base::max(plotData$upper) + base::max(plotData$upper)*.40
lim_condition_PD
  
  # Making the Plot
plot_AP <- plotData %>%
  ggplot() +
  aes(y = M,
      x = condition) +
  
  # Line
  geom_line(
    aes(color = Group,
        group = Group),
    alpha = .6,
    ) +
  
  # Error Bars
  geom_errorbar(aes(
    ymin = lower,
    ymax = upper,
    color = Group,
    group = Group
    ),
    width = .1,
    ) +
  
  # Point
  geom_point(
    aes(color = Group,
        group = Group),
    ) +

  # Adding significance bars - HC*Condition ----
  ggsignif::geom_signif(data = data.frame(Group = c("Less\nClear",
                                          "Conv",
                                         "More\nClear")),
                        aes(y_position = c(rep(lim_condition_HC, 6)),
                            xmin = c(1.1, 2.1, NA, 1.1, NA, NA),
                            xmax = c(1.9, 2.9, NA, 1.9, NA, NA),
                            annotations = c("*", "*", NA, "*", NA, NA),
                            group=c(1,2,3,4,5,6)),
                        vjust = .5,
                        color = color_HC,
                        tip_length = 0,
                        manual = T) +
  
  # Adding significance bars - PD*Condition ----
  ggsignif::geom_signif(data = data.frame(Group = c("Less\nClear",
                                          "Conv",
                                         "More\nClear")),
                        aes(y_position = c(rep(lim_condition_PD, 6)),
                            xmin = c(1.1, 2.1, NA, 1.1, 2.1, NA),
                            xmax = c(1.9, 2.9, NA, 1.9, 2.9, NA),
                            annotations = c("*", "*", NA, "*", "*", NA),
                            group=c(1,2,3,4,5,6)),
                        vjust = .5,
                        color = color_PD,
                        tip_length = 0,
                        manual = T) +
  
  # Adding significance bars - Group ----
  ggsignif::geom_signif(data = data.frame(Group = c("Less\nClear",
                                          "Conv",
                                         "More\nClear")),
                        aes(y_position = c(rep(lim_group, 6)),
                            xmin = c(.9, 1.9, 2.9, NA, NA, NA),
                            xmax = c(1.1, 2.1, 3.1, NA, NA, NA),
                            annotations = c("*", "*", "*", NA, NA, NA),
                            group=c(1,2,3,4,5,6)),
                        vjust = .5,
                        color = "black",
                        tip_length = 0,
                        manual = T) +
  
  # Facet by Sex
  facet_grid(~Sex) +
  
  # Changing the y axis scale
  coord_cartesian(ylim = lim_y) +
  scale_y_continuous(breaks=c(0, 25, 50, 75, 100)) +
  
  # Changing the theme, labels, and title
  theme_minimal() +
  labs(y = "VAS Rating") +
  ggtitle("Articulatory Precision") +
  theme(
    aspect.ratio = 1,
    plot.title = element_text(hjust = 0.5),
    #axis.text.x = element_blank(),
    #axis.ticks.x = element_blank(),
    axis.title.x = element_blank(),
    ) +
  
  # Color Palate
  scale_color_manual(values = c(color_HC,color_PD)) +
  scale_fill_manual(values = c(color_HC,color_PD))

plot_AP
```

## 3. Acoustic VSA
```{r}
plot_aVSA_data <- rio::import(file = "Data/PreppedData/CollatedData/TargetMeasures_vsaMeasures.csv") %>%
  dplyr::mutate(Sex = factor(Sex,
                             levels = c("M",
                                        "F"),
                             labels = c("Male Speakers",
                                        "Female Speakers")
                             ),
                condition = factor(condition,
                                   levels = c(
                                     "lessClear",
                                     "conv",
                                     "moreClear"
                                   ),
                                   labels = c(
                                     "Less\nClear",
                                     "Conv",
                                     "More\nClear"
                                   )),
                aVSA = aVSA/1000) %>%
  dplyr::group_by(Sex, Group, condition) %>%
  dplyr::summarise(M = mean(aVSA, na.rm = T),
                   SE = plotrix::std.error(aVSA, na.rm = T)) %>%
  dplyr::ungroup() %>%
  dplyr::mutate(upper = M + SE,
                lower = M - SE)
  
  # Making the Plot
plot_aVSA <- plot_aVSA_data %>%
    ggplot() +
  aes(y = M,
      x = condition) +
  
  # Line
  geom_line(
    aes(color = Group,
        group = Group),
    alpha = .6,
    ) +
  
  # Error Bars
  geom_errorbar(aes(
    ymin = lower,
    ymax = upper,
    color = Group,
    group = Group
    ),
    width = .1,
    ) +
  
  # Point
  geom_point(
    aes(color = Group,
        group = Group),
    ) +

  # Facet by Sex
  facet_grid(~Sex) +
  
  # Changing the y axis scale
  #coord_cartesian() +
  #scale_y_continuous(breaks=c(0, 25, 50, 75, 100)) +
  
  # Changing the theme, labels, and title
  theme_minimal() +
  labs(y = "Hz^2") +
  ggtitle("Acoustic VSA") +
  theme(
    aspect.ratio = 1,
    plot.title = element_text(hjust = 0.5),
    #axis.text.x = element_blank(),
    #axis.ticks.x = element_blank(),
    axis.title.x = element_blank(),
    legend.position = "none"
    ) +
  
  # Color Palate
  scale_color_manual(values = c(color_HC,color_PD)) +
  scale_fill_manual(values = c(color_HC,color_PD))

plot_aVSA
```


## 4. Acoustic Distance
```{r}
plot_acoDistance_data <- rio::import(file = "Data/PreppedData/CollatedData/TargetMeasures_aiMeasures.csv") %>%
  dplyr::mutate(Sex = factor(Sex,
                             levels = c("M",
                                        "F"),
                             labels = c("Male Speakers",
                                        "Female Speakers")
                             ),
                condition = factor(condition,
                                   levels = c(
                                     "lessClear",
                                     "conv",
                                     "moreClear"
                                   ),
                                   labels = c(
                                     "Less\nClear",
                                     "Conv",
                                     "More\nClear"
                                   ))) %>%
  dplyr::group_by(Sex, Group, condition) %>%
  dplyr::summarise(M = mean(acoDistance, na.rm = T),
                   SE = plotrix::std.error(acoDistance, na.rm = T)) %>%
  dplyr::ungroup() %>%
  dplyr::mutate(upper = M + SE,
                lower = M - SE)

plotData <- plot_acoDistance_data

lim_y4 <- c(0,
          (base::max(plotData$upper) + base::max(plotData$upper)*.45))
lim_group4 <- base::max(plotData$upper) + base::max(plotData$upper)*.10
lim_group4
lim_condition_HC4 <- base::max(plotData$upper) + base::max(plotData$upper)*.25
lim_condition_HC4

lim_condition_PD4 <- base::max(plotData$upper) + base::max(plotData$upper)*.40
lim_condition_PD4
  
  # Making the Plot
plot_acoDistance <- plotData %>%
  ggplot() +
  aes(y = M,
      x = condition,
      group = Group,
      color = Group) +
    geom_line() +
    geom_errorbar(aes(ymin = M - SE,
                    ymax = M + SE),
                width = .1) +
    geom_point() +
  
  # Adding significance bars - HC*Condition -----
  ggsignif::geom_signif(data = data.frame(Group = c(
    "Less\nClear",
    "Conv",
    "More\nClear")),
    aes(y_position = c(rep(lim_condition_HC4, 6)),
        xmin = c(
          # Male Speakers
          1, # Less Clear -> Conv
          2.1, # Conv -> More Clear
          NA,  # Padding
          # Female Speakers
          1, # Less Clear -> Conv
          2.1, # Conv -> More Clear
          NA), # Padding
        xmax = c(
          # Male Speakers
          1.9, # Less Clear -> Conv
          2.9, # Conv -> More Clear
          NA,  # Padding
          # Female Speakers
          1.9, # Less Clear -> Conv
          2.9, # Conv -> More Clear
          NA), # Padding
        annotations = c(
          # Male Speakers
          NA,  # Less Clear -> Conv
          "*",  # Conv -> More Clear
          NA,  # Padding
          # Female Speakers
          "*",  # Less Clear -> Conv
          "*",  # Conv -> More Clear
          NA), # Padding
        group=c(1,2,3,4,5,6),
        ),
    vjust = .5,
    color = color_HC,
    tip_length = 0,
    manual = T) +
  
  # Adding significance bars - PD*Condition ----
  ggsignif::geom_signif(data = data.frame(Group = c(
    "Less\nClear",
    "Conv",
    "More\nClear")),
    aes(y_position = c(rep(lim_condition_PD4, 6)),
        xmin = c(
          # Male Speakers
          1,   # Less Clear -> Conv
          2.1, # Conv -> More Clear
          NA,  # Padding
          # Female Speakers
          1,   # Less Clear -> Conv
          2.1, # Conv -> More Clear
          NA),  # Padding
        xmax = c(
          # Male Speakers
          1.9, # Less Clear -> Conv
          2.9, # Conv -> More Clear
          NA,  # Padding
          # Female Speakers
          1.9, # Less Clear -> Conv
          2.9, # Conv -> More Clear
          NA), # Padding
        annotations = c(
          # Male Speakers
          NA,  # Less Clear -> Conv
          "*",  # Conv -> More Clear
          NA,  # Padding
          # Female Speakers
          NA,  # Less Clear -> Conv
          "*",  # Conv -> More Clear
          NA), # Padding
        group=c(1,2,3,4,5,6)),
    vjust = .5,
    color = color_PD,
    tip_length = 0,
    manual = T) +
  
  # Facet by Sex ----
  facet_grid(~Sex) +
  
  # Changing the y axis scale
  coord_cartesian(ylim = lim_y4) +
  
  # Changing the theme, labels, and title
  theme_minimal() +
  labs(y = "Hz") +
  ggtitle("Acoustic Distance") +
  theme(
    aspect.ratio = 1,
    plot.title = element_text(hjust = 0.5),
    #axis.text.x = element_blank(),
    #axis.ticks.x = element_blank(),
    axis.title.x = element_blank(),
    ) +
  
  # Color Palate
  scale_color_manual(values = c(color_HC,color_PD)) +
  scale_fill_manual(values = c(color_HC,color_PD))

plot_acoDistance
```

## 5. F2 Slope
```{r}
plot_F2_Slope_data <- rio::import(file = "Data/PreppedData/CollatedData/TargetMeasures_aiMeasures.csv") %>%
  dplyr::mutate(Sex = factor(Sex,
                             levels = c("M",
                                        "F"),
                             labels = c("Male Speakers",
                                        "Female Speakers")
                             ),
                condition = factor(condition,
                                   levels = c(
                                     "lessClear",
                                     "conv",
                                     "moreClear"
                                   ),
                                   labels = c(
                                     "Less\nClear",
                                     "Conv",
                                     "More\nClear"
                                   ))) %>%
  dplyr::group_by(Sex, Group, condition) %>%
  dplyr::summarise(M = mean(F2_Slope, na.rm = T),
                   SE = plotrix::std.error(F2_Slope, na.rm = T)) %>%
  dplyr::ungroup() %>%
  dplyr::mutate(upper = M + SE,
                lower = M - SE)

plotData <- plot_F2_Slope_data

lim_y5 <- c(0,
          (base::max(plotData$upper) + base::max(plotData$upper)*.45))
lim_group5 <- base::max(plotData$upper) + base::max(plotData$upper)*.10
lim_group5
lim_condition_HC5 <- base::max(plotData$upper) + base::max(plotData$upper)*.25
lim_condition_HC5

lim_condition_PD5 <- base::max(plotData$upper) + base::max(plotData$upper)*.40
lim_condition_PD5
  
  # Making the Plot
plot_F2_Slope <- plotData %>%
  ggplot() +
  aes(y = M,
      x = condition,
      group = Group,
      color = Group) +
    geom_line() +
    geom_errorbar(aes(ymin = M - SE,
                    ymax = M + SE),
                width = .1) +
    geom_point() +
  
  # Adding significance bars - HC*Condition -----
  ggsignif::geom_signif(data = data.frame(Group = c(
    "Less\nClear",
    "Conv",
    "More\nClear")),
    aes(y_position = c(rep(lim_condition_HC5, 6)),
        xmin = c(
          # Male Speakers
          1,   # Less Clear -> Conv
          2.1, # Conv -> More Clear
          NA,  # Padding
          # Female Speakers
          1,   # Less Clear -> Conv
          2.1, # Conv -> More Clear
          NA),  # Padding
        xmax = c(
          # Male Speakers
          1.9, # Less Clear -> Conv
          2.9, # Conv -> More Clear
          NA,  # Padding
          # Female Speakers
          1.9, # Less Clear -> Conv
          2.9, # Conv -> More Clear
          NA), # Padding
        annotations = c(
          # Male Speakers
          NA,  # Less Clear -> Conv
          NA,  # Conv -> More Clear
          NA,  # Padding
          # Female Speakers
          NA,  # Less Clear -> Conv
          "*",  # Conv -> More Clear
          NA), # Padding
        group=c(1,2,3,4,5,6)),
    vjust = .5,
    color = color_HC,
    tip_length = 0,
    manual = T) +
  
  # Adding significance bars - PD*Condition ----
  ggsignif::geom_signif(data = data.frame(Group = c(
    "Less\nClear",
    "Conv",
    "More\nClear")),
    aes(y_position = c(rep(lim_condition_PD5, 6)),
        xmin = c(
          # Male Speakers
          1,   # Less Clear -> Conv
          2.1, # Conv -> More Clear
          NA,  # Padding
          # Female Speakers
          1,   # Less Clear -> Conv
          2.1, # Conv -> More Clear
          NA),  # Padding
        xmax = c(
          # Male Speakers
          1.9, # Less Clear -> Conv
          2.9, # Conv -> More Clear
          NA,  # Padding
          # Female Speakers
          1.9, # Less Clear -> Conv
          2.9, # Conv -> More Clear
          NA), # Padding
        annotations = c(
          # Male Speakers
          NA,  # Less Clear -> Conv
          NA,  # Conv -> More Clear
          NA,  # Padding
          # Female Speakers
          NA,  # Less Clear -> Conv
          "*",  # Conv -> More Clear
          NA), # Padding
        group=c(1,2,3,4,5,6)),
    vjust = .5,
    color = color_PD,
    tip_length = 0,
    manual = T) +
  
  # Facet by Sex ----
  facet_grid(~Sex) +
  
  # Changing the y axis scale
  coord_cartesian(ylim = lim_y5) +
  
  # Changing the theme, labels, and title
  theme_minimal() +
  labs(y = "Hz/ms") +
  ggtitle("F2 Slope") +
  theme(
    aspect.ratio = 1,
    plot.title = element_text(hjust = 0.5),
    #axis.text.x = element_blank(),
    #axis.ticks.x = element_blank(),
    axis.title.x = element_blank(),
    ) +
  
  # Color Palate
  scale_color_manual(values = c(color_HC,color_PD)) +
  scale_fill_manual(values = c(color_HC,color_PD))

plot_F2_Slope

```
## 6. kVSA
```{r}
plot_kVSA_data <- rio::import(file = "Data/PreppedData/CollatedData/TargetMeasures_vsaMeasures.csv") %>%
  dplyr::mutate(Sex = factor(Sex,
                             levels = c("M",
                                        "F"),
                             labels = c("Male Speakers",
                                        "Female Speakers")
                             ),
                condition = factor(condition,
                                   levels = c(
                                     "lessClear",
                                     "conv",
                                     "moreClear"
                                   ),
                                   labels = c(
                                     "Less\nClear",
                                     "Conv",
                                     "More\nClear"
                                   ))) %>%
  dplyr::group_by(Sex, Group, condition) %>%
  dplyr::summarise(M = mean(kVSA, na.rm = T),
                   SE = plotrix::std.error(kVSA, na.rm = T)) %>%
  dplyr::ungroup() %>%
  dplyr::mutate(upper = M + SE,
                lower = M - SE)

plotData <- plot_kVSA_data

lim_y <- c(0,
          (base::max(plotData$upper) + base::max(plotData$upper)*.45))
lim_group <- base::max(plotData$upper) + base::max(plotData$upper)*.10
lim_group
lim_condition_HC <- base::max(plotData$upper) + base::max(plotData$upper)*.25
lim_condition_HC

lim_condition_PD <- base::max(plotData$upper) + base::max(plotData$upper)*.40
lim_condition_PD
  
  # Making the Plot
plot_kVSA <- plotData %>%
  ggplot() +
  aes(y = M,
      x = condition,
      group = Group,
      color = Group) +
    geom_line() +
    geom_errorbar(aes(ymin = M - SE,
                    ymax = M + SE),
                width = .1) +
    geom_point() +
  
   # Facet by Sex ----
  facet_grid(~Sex) +

  
  # Changing the theme, labels, and title
  theme_minimal() +
  labs(y = bquote('mm'^2)) +
  ggtitle("Kinematic VSA") +
  theme(
    aspect.ratio = 1,
    plot.title = element_text(hjust = 0.5),
    #axis.text.x = element_blank(),
    #axis.ticks.x = element_blank(),
    axis.title.x = element_blank(),
    legend.position = "none"
    ) +
  
  # Color Palate
  scale_color_manual(values = c(color_HC,color_PD)) +
  scale_fill_manual(values = c(color_HC,color_PD))

plot_kVSA
```

## 7. Kin Distance
```{r}
plot_kinDistance_data <- rio::import(file = "Data/PreppedData/CollatedData/TargetMeasures_aiMeasures.csv") %>%
  dplyr::mutate(Sex = factor(Sex,
                             levels = c("M",
                                        "F"),
                             labels = c("Male Speakers",
                                        "Female Speakers")
                             ),
                condition = factor(condition,
                                   levels = c(
                                     "lessClear",
                                     "conv",
                                     "moreClear"
                                   ),
                                   labels = c(
                                     "Less\nClear",
                                     "Conv",
                                     "More\nClear"
                                   )))  %>%
  dplyr::group_by(Sex, Group, condition) %>%
  dplyr::summarise(M = mean(kinDistance, na.rm = T),
                   SE = plotrix::std.error(kinDistance, na.rm = T)) %>%
  dplyr::ungroup() %>%
  dplyr::mutate(upper = M + SE,
                lower = M - SE)

plotData <- plot_kinDistance_data

lim_y7 <- c(0,
          (base::max(plotData$upper) + base::max(plotData$upper)*.48))
lim_group7 <- base::max(plotData$upper) + base::max(plotData$upper)*.10
lim_group7
lim_condition_HC7 <- base::max(plotData$upper) + base::max(plotData$upper)*.25
lim_condition_HC7

lim_condition_PD7 <- base::max(plotData$upper) + base::max(plotData$upper)*.40
lim_condition_PD7
  
  # Making the Plot
plot_kinDistance <- plotData %>%
  ggplot() +
  aes(y = M,
      x = condition,
      group = Group,
      color = Group) +
    geom_line() +
    geom_errorbar(aes(ymin = M - SE,
                    ymax = M + SE),
                width = .1) +
    geom_point() +
  
    # Adding significance bars - HC*Condition -----
  ggsignif::geom_signif(data = data.frame(Group = c(
    "Less\nClear",
    "Conv",
    "More\nClear")),
    aes(y_position = c(rep(lim_condition_HC7, 6)),
        xmin = c(
          # Male Speakers
          1,   # Less Clear -> Conv
          2.1, # Conv -> More Clear
          NA,  # Padding
          # Female Speakers
          1,   # Less Clear -> Conv
          2.1, # Conv -> More Clear
          NA),  # Padding
        xmax = c(
          # Male Speakers
          1.9, # Less Clear -> Conv
          2.9, # Conv -> More Clear
          NA,  # Padding
          # Female Speakers
          1.9, # Less Clear -> Conv
          2.9, # Conv -> More Clear
          NA), # Padding
        annotations = c(
          # Male Speakers
          NA,  # Less Clear -> Conv
          "*",  # Conv -> More Clear
          NA,  # Padding
          # Female Speakers
          NA,  # Less Clear -> Conv
          "*",  # Conv -> More Clear
          NA), # Padding
        group=c(1,2,3,4,5,6)),
    vjust = .5,
    color = color_HC,
    tip_length = 0,
    manual = T) +
  
  # Adding significance bars - PD*Condition ----
  ggsignif::geom_signif(data = data.frame(Group = c(
    "Less\nClear",
    "Conv",
    "More\nClear")),
    aes(y_position = c(rep(lim_condition_PD7, 6)),
        xmin = c(
          # Male Speakers
          1,   # Less Clear -> Conv
          2.1, # Conv -> More Clear
          NA,  # Padding
          # Female Speakers
          1,   # Less Clear -> Conv
          2.1, # Conv -> More Clear
          NA),  # Padding
        xmax = c(
          # Male Speakers
          1.9, # Less Clear -> Conv
          2.9, # Conv -> More Clear
          NA,  # Padding
          # Female Speakers
          1.9, # Less Clear -> Conv
          2.9, # Conv -> More Clear
          NA), # Padding
        annotations = c(
          # Male Speakers
          "*",  # Less Clear -> Conv
          "*",  # Conv -> More Clear
          NA,  # Padding
          # Female Speakers
          NA,  # Less Clear -> Conv
          "*",  # Conv -> More Clear
          NA), # Padding
        group=c(1,2,3,4,5,6)),
    vjust = .5,
    color = color_PD,
    tip_length = 0,
    manual = T) +
  
  
  # Facet by Sex ----
  facet_grid(~Sex) +
  
  # Changing the y axis scale
  coord_cartesian(ylim = lim_y7) +
  
  # Changing the theme, labels, and title
  theme_minimal() +
  labs(y = "mm") +
  ggtitle("Kinematic Distance") +
  theme(
    aspect.ratio = 1,
    plot.title = element_text(hjust = 0.5),
    #axis.text.x = element_blank(),
    #axis.ticks.x = element_blank(),
    axis.title.x = element_blank(),
    ) +
  
  # Color Palate
  scale_color_manual(values = c(color_HC,color_PD)) +
  scale_fill_manual(values = c(color_HC,color_PD))

plot_kinDistance
```

## 8. TB Speed
```{r}
plot_TB_Speed_data <- rio::import(file = "Data/PreppedData/CollatedData/TargetMeasures_aiMeasures.csv") %>%
  dplyr::mutate(Sex = factor(Sex,
                             levels = c("M",
                                        "F"),
                             labels = c("Male Speakers",
                                        "Female Speakers")
                             ),
                condition = factor(condition,
                                   levels = c(
                                     "lessClear",
                                     "conv",
                                     "moreClear"
                                   ),
                                   labels = c(
                                     "Less\nClear",
                                     "Conv",
                                     "More\nClear"
                                   ))) %>%
  dplyr::group_by(Sex, Group, condition) %>%
  dplyr::summarise(M = mean(TB_speedMax, na.rm = T),
                   SE = plotrix::std.error(TB_speedMax, na.rm = T)) %>%
  dplyr::ungroup() %>%
  dplyr::mutate(upper = M + SE,
                lower = M - SE)

plotData <- plot_TB_Speed_data

lim_y8 <- c(0,
          (base::max(plotData$upper) + base::max(plotData$upper)*.45))
lim_group8 <- base::max(plotData$upper) + base::max(plotData$upper)*.10
lim_group8
lim_condition_HC8 <- base::max(plotData$upper) + base::max(plotData$upper)*.25
lim_condition_HC8

lim_condition_PD8 <- base::max(plotData$upper) + base::max(plotData$upper)*.40
lim_condition_PD8
  
  # Making the Plot
plot_TB_Speed <- plotData %>%
  ggplot() +
  aes(y = M,
      x = condition,
      group = Group,
      color = Group) +
    geom_line() +
    geom_errorbar(aes(ymin = M - SE,
                    ymax = M + SE),
                width = .1) +
    geom_point() +
  
  # Adding significance bars - HC*Condition -----
  ggsignif::geom_signif(data = data.frame(Group = c(
    "Less\nClear",
    "Conv",
    "More\nClear")),
    aes(y_position = c(rep(lim_condition_HC8, 6)),
        xmin = c(
          # Male Speakers
          1,   # Less Clear -> Conv
          2.1, # Conv -> More Clear
          NA,  # Padding
          # Female Speakers
          1,   # Less Clear -> Conv
          2.1, # Conv -> More Clear
          NA),  # Padding
        xmax = c(
          # Male Speakers
          1.9, # Less Clear -> Conv
          2.9, # Conv -> More Clear
          NA,  # Padding
          # Female Speakers
          1.9, # Less Clear -> Conv
          2.9, # Conv -> More Clear
          NA), # Padding
        annotations = c(
          # Male Speakers
          NA,  # Less Clear -> Conv
          "*",  # Conv -> More Clear
          NA,  # Padding
          # Female Speakers
          NA,  # Less Clear -> Conv
          NA,  # Conv -> More Clear
          NA), # Padding
        group=c(1,2,3,4,5,6)),
    vjust = .5,
    color = color_HC,
    tip_length = 0,
    manual = T) +
  
  # Facet by Sex ----
  facet_grid(~Sex) +
  
  # Changing the y axis scale
  coord_cartesian(ylim = lim_y8) +
  
  # Changing the theme, labels, and title
  theme_minimal() +
  labs(y = "mm/s") +
  ggtitle("TB Speed") +
  theme(
    aspect.ratio = 1,
    plot.title = element_text(hjust = 0.5),
    #axis.text.x = element_blank(),
    #axis.ticks.x = element_blank(),
    axis.title.x = element_blank(),
    ) +
  
  # Color Palate
  scale_color_manual(values = c(color_HC,color_PD)) +
  scale_fill_manual(values = c(color_HC,color_PD))

plot_TB_Speed

```
## Combining all of the plots
```{r}
library(patchwork)

# All combined
plot_s2 <- plot_Int + plot_AP + plot_spacer() + guide_area()  +
  plot_aVSA + plot_acoDistance + plot_F2_Slope + plot_spacer() +
  plot_kVSA + plot_kinDistance + plot_TB_Speed +
  plot_layout(guides = "collect",
              nrow = 3,
              ncol = 4)
plot_s2

dir.create(path = "Data/Plots/Results",
           showWarnings = F)
ggsave(filename = "S2 Results.png",
       plot = plot_s2,
       path = "Data/Plots/Results",
       height = 6,
       width = 8,
       scale = 1.2)

# Perceptual Plots
plot_s2_perceptual <- ggarrange(plot_Int,plot_AP,
                                common.legend = T,
                                legend = "bottom")
plot_s2_perceptual

dir.create(path = "Data/Plots/Results",
           showWarnings = F)
ggsave(filename = "Results_perceptual.png",
       plot = plot_s2_perceptual,
       path = "Data/Plots/Results",
       height = 2.5,
       width = 7,
       scale = 1.1,
       bg = "white")

# Acoustic Plots
plot_s2_acoustic <- plot_aVSA + plot_acoDistance +
  plot_F2_Slope + patchwork::guide_area() +
    patchwork::plot_layout(guides = "collect",
              design = "
              AABB
              CCDD")
plot_s2_acoustic

dir.create(path = "Data/Plots/Results",
           showWarnings = F)
ggsave(filename = "S2 Results_acoustic.png",
       plot = plot_s2_acoustic,
       path = "Data/Plots/Results",
       height = 4,
       width = 6,
       scale = 1.1)

# Kinematic Plots
plot_s2_kinematic <- plot_kVSA + plot_kinDistance +
  plot_TB_Speed + patchwork::guide_area() +
    patchwork::plot_layout(guides = "collect",
              design = "
              AABB
              CCDD")
plot_s2_kinematic

dir.create(path = "Data/Plots/Results",
           showWarnings = F)
ggsave(filename = "S2 Results_kinematic.png",
       plot = plot_s2_kinematic,
       path = "Data/Plots/Results",
       height = 4,
       width = 6,
       scale = 1.1)

stop()
```

```{r}
library(dplyr)
library(ggplot2)
library(tidyr)

myPal <- rcartocolor::carto_pal(n = 15, name = "Geyser")
color_HC <- myPal[2] 
color_PD <- myPal[6]
myPal_1 <- myPal[1]
myPal_2 <- myPal[3]
myPal_3 <- myPal[5]


perceptualMeasures <- rio::import(file = "Data/PreppedData/ListenerData/ListenerRatings_allRatings.csv") %>%
  dplyr::rename(Measure = ratingType,
                Value = Rating) %>%
  dplyr::group_by(condition, Measure) %>%
  dplyr::summarise(M = mean(Value, na.rm = T),
                   sd = sd(Value, na.rm = T),
                   CV = sd / M * 100) %>%
  dplyr::ungroup() %>%
  dplyr::mutate(Domain = "Perceptual")

vsaMeasures <- rio::import(file = "Data/PreppedData/CollatedData/TargetMeasures_vsaMeasures.csv") %>%
  dplyr::mutate(Sex = factor(Sex, levels = c("M","F")),
                aVSA = aVSA/1000) %>%
  tidyr::pivot_longer(cols = aVSA:kVSA,
                      names_to = "Measure",
                      values_to = "Value") %>%
  dplyr::group_by(condition, Measure) %>%
  dplyr::summarise(M = mean(Value, na.rm = T),
                   sd = sd(Value, na.rm = T),
                   CV = sd / M * 100) %>%
  dplyr::ungroup() %>%
  dplyr::mutate(Domain = case_when(
    Measure == "aVSA" ~ "Acoustic",
    Measure == "kVSA" ~ "Kinematic",
  ))

aiMeasures <- rio::import(file = "Data/PreppedData/CollatedData/TargetMeasures_aiMeasures.csv") %>%
  dplyr::mutate(Sex = factor(Sex, levels = c("M","F"))) %>%
  tidyr::pivot_longer(cols = c(acoDistance, kinDistance,
                               F2_Slope, dTB_speedMax, Jaw_speedMax),
                      names_to = "Measure",
                      values_to = "Value") %>%
  dplyr::group_by(condition, Measure) %>%
  dplyr::summarise(M = mean(Value, na.rm = T),
                   sd = sd(Value, na.rm = T),
                   CV = sd / M * 100) %>%
  dplyr::ungroup() %>%
  dplyr::mutate(Domain = case_when(
    Measure == "acoDistance" ~ "Acoustic",
    Measure == "F2_Slope" ~ "Acoustic",
    Measure == "kinDistance" ~ "Kinematic",
    Measure == "dTB_speedMax" ~ "Kinematic",
    Measure == "Jaw_speedMax" ~ "Kinematic",
  ))

variabilityMeasures <- rbind(perceptualMeasures,
                             aiMeasures,
                             vsaMeasures) %>%
  dplyr::mutate(condition = factor(condition,
                                   levels = c(
                                     "lessClear",
                                     "conv",
                                     "moreClear"
                                   ),
                                   labels = c(
                                     "Less Clear",
                                     "Conversational",
                                     "More Clear"
                                   )),
                Measure = factor(Measure,
                                 levels = c(
                                   "Int",
                                   "AP",
                                   "aVSA",
                                   "kVSA",
                                   "acoDistance",
                                   "kinDistance",
                                   "F2_Slope",
                                   "dTB_speedMax",
                                   "Jaw_speedMax"
                                 ),
                                 labels = c(
                                   "Intelligibility",
                                   "Articulatory Precision",
                                   "Acoustic VSA",
                                   "Kinematic VSA",
                                   "Acoustic Distance",
                                   "Kinematic Distance",
                                   "F2 Slope",
                                   "dTB Peak Speed",
                                   "Jaw Peak Speed"
                                 )),
                Domain = factor(Domain,
                                levels = c(
                                  "Perceptual",
                                  "Acoustic",
                                  "Kinematic")))

variabilityMeasures %>%
  ggplot() +
  aes(x = condition,
      y = CV,
      group = Measure,
      label = Measure,
      color = Domain,
      ) +
  geom_line(show.legend = FALSE) +
  geom_point(show.legend = FALSE) +
  geom_text(data = variabilityMeasures %>% dplyr::filter(condition == "More Clear"),
              hjust = 0, nudge_x = 0.1,
              color = "black",
            show.legend = FALSE) +
  facet_wrap(~Domain, ncol = 1,
             scales = "free_y") +
  scale_x_discrete(expand = expansion(mult = c(0.1, .75))) +
  labs(y = "Coefficient of Variation (%)",
       x = NULL) +
  scale_color_manual(values = c(myPal_1, myPal_2, myPal_3)) +
  theme_minimal()

ggsave(plot = last_plot(),
       filename = "S2_MeasureVariability.png",
       path = "Data/Plots/Results",
       height = 5,
       width = 4,
       units = "in",
       scale = 1.2)

```

## Duration, Extent, Slope
```{r}
library(rcartocolor) # install.packages('rcartocolor')
myPal <- rcartocolor::carto_pal(n = 11, name = "Geyser")[c(2, 3, 4, 5)]

vowels <- rio::import(file = "Data/PreppedData/CollatedData/allSpeakers_AcousticSegments.csv") %>%
  dplyr::filter(phrase == "bsent") %>%
  dplyr::group_by(DatabaseID, Group, condition, phrase) %>%
  dplyr::mutate(time = time - min(time),
                condition = factor(condition,
                                   levels = c(
                                     "lessClear",
                                     "conv",
                                     "moreClear"
                                   ),
                                   labels = c(
                                     "Less Clear",
                                     "Conversational",
                                     "More Clear"
                                   )),
                label = factor(label,
                               levels = c(
                                 "ai",
                                 "a",
                                 "i",
                                 "v"
                               ),
                               labels = c(
                                 "aÉª",
                                 "a",
                                 "i",
                                 "ÊŒ"
                                 )))

vowelBoundaries <- vowels %>%
  dplyr::group_by(DatabaseID, Group, condition, phrase, label, token) %>%
  dplyr::summarise(onset = min(time),
                   offset = max(time)) %>%
  dplyr::filter(token != "a.1") %>%
  dplyr::filter(token != "ai.1") %>%
  dplyr::filter(token != "i.2") %>%
  dplyr::filter(token != "i.3") %>%
  dplyr::filter(token != "v.1") %>%
  dplyr::filter(token != "`") %>%
  dplyr::filter(token != "a.3") %>%
  dplyr::group_by(condition, phrase, label, token) %>%
  dplyr::summarise(onset = mean(onset, na.rm = T),
                   offset = mean(offset, na.rm = T))

vowelLabels <- vowelBoundaries %>%
  dplyr::mutate(midpoint = (offset - onset)/2 + onset)

wordLabels <- vowelLabels %>%
  dplyr::filter(condition == "More Clear") %>%
  dplyr::mutate(word = case_when(
    token == "ai" ~ "Buy",
    token == "a" ~ "Bobby",
    token == "i" ~ "Bobby",
    token == "v" ~ "puppy",
    token == "i.1" ~ "puppy"
  )) %>%
  dplyr::group_by(condition, phrase, word) %>%
  dplyr::summarize(midpoint = mean(midpoint)) %>%
  dplyr::ungroup() %>%
  dplyr::add_row(condition = "More Clear",
                 phrase = "bsent",
                 word = "a",
                 midpoint = mean(x = c(.$midpoint[.$word == "Bobby"],
                                       .$midpoint[.$word == "puppy"]),
                                 na.rm = T))


phraseBoundaries <- vowels %>%
  dplyr::group_by(DatabaseID, Group, condition, phrase) %>%
  dplyr::summarise(onset = min(time),
                   offset = max(time)) %>%
  dplyr::group_by(condition, phrase) %>%
  dplyr::summarise(onset = mean(onset, na.rm = T),
                   offset = mean(offset, na.rm = T)) %>%
  tidyr::pivot_longer(names_to = "timePoint",
                      values_to = "time",
                      cols = c(onset, offset))

phraseBoundaries %>%
  ggplot() +
  aes(x = time,
      y = condition) +
  geom_line(linetype = 2) +
  # Adding the vowels
  geom_segment(data = vowelBoundaries,
            aes(x = onset, xend = offset,
                y = condition, yend = condition,
                color = label,
                group = condition),
            size = 10,
            lineend = "butt",
            show.legend = F) +
  # Vowel Labels
  geom_text(data = vowelLabels,
            aes(x = midpoint,
                y = condition,
                label = label),
            show.legend = F) +
  # Word Labels
  geom_text(data = wordLabels,
            aes(x = midpoint,
                y = condition,
                label = word),
            nudge_y = .5,
            show.legend = F) +
  labs(x = "Time (s, Normalized)",
       y = NULL) +
  theme_classic() +
  scale_color_manual(values = myPal)

ggsave(filename = "S2_Relative Vowel Duations.png",
       plot = last_plot(),
       path = "Data/Plots/Results",
       height = 4,
       width = 6,
       scale = .9)

```

## Intelligibility and Articulatory Precision Ranges
```{r, eval = F}
# Color Pallate
myPal <- rcartocolor::carto_pal(n = 7, name = "Geyser")[c(1, 2, 3, 4, 5, 6, 7)]
color_HC <- myPal[2] 
color_PD <- myPal[6]

# Load in the Data
speakerList <- rio::import(file = "Data/PreppedData/Speaker List_Clean.csv")

plotData <- utils::read.csv(file = "Data/PreppedData/ListenerData/ListenerRatings.csv") %>%
  dplyr::select(!1) %>%
  dplyr::group_by(DatabaseID, ratingType, condition) |>
  dplyr::summarise(M = mean(M, na.rm = T)) %>%
  tidyr::pivot_wider(
    names_from = condition,
    values_from = M) %>%
  dplyr::mutate(segMin = base::min(conv,lessClear,moreClear),
                segMax = base::max(conv,lessClear,moreClear),
                range = segMax - segMin,
                ratingAvg = base::mean(conv,lessClear,moreClear),
                ratingType = factor(ratingType,
                                    levels = c("Int",
                                               "AP"),
                                    labels = c("Intelligibility",
                                               "Articulatory Precision"))) %>%
  base::merge(., speakerList %>% dplyr::select(DatabaseID, StudyID, Group)) %>%
  dplyr::mutate(StudyID = as.factor(StudyID)) %>%
  arrange(segMax)

segmentData <- plotData %>%
  dplyr::select(DatabaseID, StudyID, Group, ratingType, segMin, segMax)

pointData <- plotData %>%
    dplyr::select(DatabaseID, StudyID, Group, ratingType, conv, lessClear, moreClear) %>%
  tidyr::pivot_longer(
    cols = c(conv,lessClear,moreClear),
    values_to = "Value",
    names_to = "Condition") %>%
  dplyr::mutate(Condition = factor(Condition,
                                   levels = c(
                                     "lessClear",
                                     "conv",
                                     "moreClear"
                                   ),
                                   labels = c(
                                     "Less Clear",
                                     "Conversational",
                                     "More Clear"
                                   )))


# With a bit more style
plot_IntAP <- plotData %>%
  ggplot() +
  geom_segment(
    data = segmentData,
    aes(x = fct_inorder(StudyID),
        xend = StudyID,
        y = segMin,
        yend = segMax),
    color="grey") +
  geom_point(
    data = pointData,
    aes(x = fct_inorder(StudyID),
        y = Value,
        shape = Condition,
        alpha = Condition,
        color = Group),
    size = 2) +
  coord_flip()+
  
  # Specifying the theme
  theme_minimal() +
  theme(
    #legend.position = "none",
    panel.border = element_blank(),
    #aspect.ratio = 1,
  ) +
  
  # Facet and modify y axis scale
  facet_grid(Group~ratingType, scales = "free_y") +
  ylim(c(0,100)) +
  
  # Labels & Title
  labs(x = NULL,
       y = "Perceptual Ratings (VAS)",
       title = NULL) +
  
  # Color Palate
  scale_color_manual(values = c(color_HC,color_PD)) +
  scale_fill_manual(values = c(color_HC,color_PD)) +
  scale_shape_manual(values = c(17, 16, 15)) +
  scale_alpha_manual(values = c(.6, .8, 1))

plot_IntAP


ggplot2::ggsave("Data/Plots/Results/S2_avgRatings.png",
                plot = last_plot(),
                height = 6,
                width = 6.5,
                units = "in")

rm(plotData, segmentData, pointData, speakerList)
```

# Motor Equivilance Plot
PDM04 - PDM06
```{r}
aiMeasures <- rio::import(file = "Data/PreppedData/CollatedData/TargetMeasures_aiMeasures.csv")

speakers <- aiMeasures %>%
  dplyr::select(StudyID, Sex, Group, Age) %>%
  base::unique()

speakerContrast <- aiMeasures %>%
  dplyr::filter(condition == "conv") %>%
  dplyr::filter(StudyID == "HCF03" | StudyID == "HCF05") %>%
  dplyr::mutate(duration = duration*1000)

speakerContrast_pair1 <- rbind(
  aiMeasures %>%
    dplyr::filter(condition == "conv") %>%
    dplyr::filter(StudyID == "PDM04" & rep == 4),
  aiMeasures %>%
    dplyr::filter(condition == "conv") %>%
    dplyr::filter(StudyID == "PDM06" & rep == 5)
)

speakerContrast_pair2 <- rbind(
  aiMeasures %>%
    dplyr::filter(condition == "conv") %>%
    dplyr::filter(StudyID == "HCF03" & rep == 2),
  aiMeasures %>%
    dplyr::filter(condition == "conv") %>%
    dplyr::filter(StudyID == "HCF05" & rep == 1)
)

speakerContrast_pair3 <- rbind(
  aiMeasures %>%
    dplyr::filter(condition == "conv") %>%
    dplyr::filter(StudyID == "HCM06" & rep == 4), # 4 is good
  aiMeasures %>%
    dplyr::filter(condition == "conv") %>%
    dplyr::filter(StudyID == "HCM07" & rep == 2) # 2 is good
)

speakerContrast_pair4 <- rbind(
  aiMeasures %>%
    dplyr::filter(condition == "conv") %>%
    dplyr::filter(StudyID == "HCM07" & rep == 3),
  aiMeasures %>%
    dplyr::filter(condition == "conv") %>%
    dplyr::filter(StudyID == "HCM08" & rep == 1)
)

speakerContrast_pair5 <- rbind(
  aiMeasures %>%
    dplyr::filter(condition == "conv") %>%
    dplyr::filter(StudyID == "HCM05" & rep == 1),
  aiMeasures %>%
    dplyr::filter(condition == "conv") %>%
    dplyr::filter(StudyID == "HCM08" & rep == 2)
)


targetContrastPair <- speakerContrast_pair4
speaker1 <- targetContrastPair %>%
  dplyr::filter(row_number() == 1)
speaker2 <- targetContrastPair %>%
  dplyr::filter(row_number() == 2)

# Acoustic Data
acousticSegments <- rio::import(file = "Data/PreppedData/CollatedData/allSpeakers_AcousticSegments.csv") %>%
  dplyr::filter(DatabaseID == speaker1$DatabaseID & between(time,
                                                            speaker1$onset,
                                                            speaker1$offset) |
                  DatabaseID == speaker2$DatabaseID & between(time,
                                                            speaker2$onset,
                                                            speaker2$offset))


plot_acousticSegment <- acousticSegments %>%
  dplyr::group_by(DatabaseID) %>%
  dplyr::mutate(time = time - min(time)) %>%
  ggplot() +
  aes(x = F2,
      y = F1,
      alpha = time) +
  geom_path() +
  geom_point() +
  scale_y_reverse() +
  facet_wrap(~DatabaseID) +
  theme_minimal() +
  theme(aspect.ratio = 1)
plot_acousticSegment

# Movement Data
movementSegments <- rio::import(file = "Data/PreppedData/CollatedData/allSpeakers_MovementSegments.csv") %>%
  dplyr::filter(DatabaseID == speaker1$DatabaseID & between(time,
                                                            speaker1$onset,
                                                            speaker1$offset) |
                  DatabaseID == speaker2$DatabaseID & between(time,
                                                            speaker2$onset,
                                                            speaker2$offset))

plot_movementSegments <- movementSegments %>%
  dplyr::group_by(DatabaseID) %>%
  dplyr::mutate(time = time - min(time),
                tb_x = scale(tb_x, center = T, scale = F)) %>%
  ggplot() +
  aes(x = tb_x,
      y = tb_y,
      alpha = time) +
  geom_path() +
  geom_point() +
  facet_wrap(~DatabaseID) +
  theme_minimal() +
  theme(aspect.ratio = 1) +
  labs(x = "Posterior-Anterior (x)",
       y = "Inferior-Superior (y)")
plot_movementSegments

library(patchwork)
plot_speakerContrast <- plot_acousticSegment +
  plot_movementSegments +
  patchwork::plot_layout(ncol = 1)
plot_speakerContrast
```

# Contrast - 1 dimension
```{r}
targetContrastPair <- speakerContrast_pair5
speaker1 <- targetContrastPair %>%
  dplyr::filter(row_number() == 1)
speaker2 <- targetContrastPair %>%
  dplyr::filter(row_number() == 2)


# Acoustic Data
acousticSegments <- rio::import(file = "Data/PreppedData/CollatedData/allSpeakers_AcousticSegments.csv") %>%
  dplyr::filter(DatabaseID == speaker1$DatabaseID & between(time,
                                                            speaker1$onset,
                                                            speaker1$offset) |
                  DatabaseID == speaker2$DatabaseID & between(time,
                                                            speaker2$onset,
                                                            speaker2$offset))
# Movement Data
movementSegments <- rio::import(file = "Data/PreppedData/CollatedData/allSpeakers_MovementSegments.csv") %>%
  dplyr::filter(DatabaseID == speaker1$DatabaseID & between(time,
                                                            speaker1$onset,
                                                            speaker1$offset) |
                  DatabaseID == speaker2$DatabaseID & between(time,
                                                            speaker2$onset,
                                                           speaker2$offset))

# Combining data
plotData <- rbind(acousticSegments %>%
                    dplyr::group_by(DatabaseID) %>%
                    dplyr::mutate(time = time - min(time),
                                  xlab = "Acoustic (F2)") %>%
                    dplyr::select(DatabaseID, time, xlab, F2) %>%
                    dplyr::rename(x = F2),
                  
                  movementSegments %>%
                    dplyr::group_by(DatabaseID) %>%
                    dplyr::mutate(time = time - min(time),
                                  xlab = "Movement (x)") %>%
                  dplyr::select(DatabaseID, time, xlab, tb_x) %>%
                    dplyr::rename(x = tb_x)) %>%
  dplyr::group_by(DatabaseID, xlab) %>%
  dplyr::mutate(x = scale(x, center = T, scale = F))



plot <- plotData %>%
  ggplot() +
  aes(x = time,
      y = x,
      alpha = time) +
  geom_path() +
  geom_point() +
  facet_grid(xlab~DatabaseID,
             scales = "free_y") +
  theme_classic() +
  theme(aspect.ratio = 1) +
  labs(x = "time",
       y = "Inferior-Superior Dimension")
plot

```
# Contrast - all Movement
```{r}
targetContrastPair <- speakerContrast_pair4
speaker1 <- targetContrastPair %>%
  dplyr::filter(row_number() == 1)
speaker2 <- targetContrastPair %>%
  dplyr::filter(row_number() == 2)

# Acoustic Data
acousticSegments <- rio::import(file = "Data/PreppedData/CollatedData/allSpeakers_AcousticSegments.csv") %>%
  dplyr::filter(DatabaseID == speaker1$DatabaseID & between(time,
                                                            speaker1$onset,
                                                            speaker1$offset) |
                  DatabaseID == speaker2$DatabaseID & between(time,
                                                            speaker2$onset,
                                                            speaker2$offset))


plot_acousticSegment <- acousticSegments %>%
  dplyr::group_by(DatabaseID) %>%
  dplyr::mutate(time = time - min(time)) %>%
  ggplot() +
  aes(x = time,
      y = F2,
      alpha = time) +
  geom_path() +
  geom_point() +
  #scale_y_reverse() +
  facet_wrap(~DatabaseID) +
  theme_classic() +
  theme(aspect.ratio = 1)
plot_acousticSegment

# Movement Data
movementSegments <- rio::import(file = "Data/PreppedData/CollatedData/allSpeakers_MovementSegments.csv") %>%
  dplyr::filter(DatabaseID == speaker1$DatabaseID & between(time,
                                                            speaker1$onset,
                                                            speaker1$offset) |
                  DatabaseID == speaker2$DatabaseID & between(time,
                                                            speaker2$onset,
                                                            speaker2$offset)) %>%
  dplyr::select(DatabaseID, time,
                tb_x, tb_y,
                tf_x, tf_y,
                ul_x, ul_y,
                ll_x, ll_y,
                jaw_x, jaw_y)
x <- movementSegments %>%
  dplyr::select(DatabaseID, time, tb_x, tf_x, ul_x,ll_x, jaw_x) %>%
  tidyr::pivot_longer(cols = tb_x:jaw_x,
                      names_to = "Articulator",
                      values_to = "x") %>%
  dplyr::mutate(Articulator = gsub(pattern = "_x",
                                   replacement = "",
                                   x = Articulator))

y <- movementSegments %>%
  dplyr::select(DatabaseID, time, tb_y, tf_y, ul_y,ll_y, jaw_y) %>%
  tidyr::pivot_longer(cols = tb_y:jaw_y,
                      names_to = "Articulator",
                      values_to = "y") %>%
  dplyr::mutate(Articulator = gsub(pattern = "_y",
                                   replacement = "",
                                   x = Articulator))

movementSegments <- base::merge(x, y)

plot_movementSegments <- movementSegments %>%
  dplyr::group_by(DatabaseID) %>%
  dplyr::mutate(time = time - min(time)) %>%
  ggplot() +
  aes(x = x,
      y = y,
      color = Articulator,
      alpha = time) +
  geom_path() +
  geom_point() +
  facet_wrap(~DatabaseID) +
  theme_classic() +
  theme(aspect.ratio = 1) +
  labs(x = "x",
       y = "Inferior-Superior (y)")
plot_movementSegments


library(patchwork)
plot_speakerContrast <- plot_acousticSegment +
  plot_movementSegments +
  plot_movementSegments_tf +
  patchwork::plot_layout(ncol = 1)
plot_speakerContrast
```

# aVSA vs. kVSA
```{r}
myPal <- rcartocolor::carto_pal(n = 7, name = "Geyser")[c(1, 2, 3, 4, 5, 6, 7)]
color_HC <- myPal[2] 
color_PD <- myPal[6]

speakers <- rio::import(file = "Data/PreppedData/Speaker List_Clean.csv") %>%
  dplyr::select(DatabaseID:Sex)

vsaMeasures <- rio::import(file = "Data/PreppedData/CollatedData/allSpeakers_tempMid.csv") %>%
  dplyr::select(DatabaseID, Group, condition, label,
                F1_tempMid, F2_tempMid,
                TB_x_tempMid, TB_y_tempMid) %>%
  base::merge(., speakers, no.dups = F) %>%
  dplyr::group_by(DatabaseID) %>%
  dplyr::mutate(TB_x_tempMid = scale(TB_x_tempMid, center = T, scale = F),
                TB_y_tempMid = scale(TB_y_tempMid, center = T, scale = F)) %>%
  dplyr::group_by(Group, Sex, condition, label) %>%
  dplyr::summarise(F1_tempMid = mean(F1_tempMid, na.rm = T),
                   F2_tempMid = mean(F2_tempMid, na.rm = T),
                   TB_x_tempMid = mean(TB_x_tempMid, na.rm = T),
                   TB_y_tempMid = mean(TB_y_tempMid, na.rm = T)) %>%
  dplyr::mutate(Sex = factor(Sex,
                             levels = c(
                               "M",
                               "F"
                             ),
                             labels = c(
                               "Male Speakers",
                               "Female Speakers"
                             )))
variability_xyCoords <- rio::import(file = "Data/PreppedData/CollatedData/allSpeakers_tempMid.csv") %>%
  dplyr::select(DatabaseID, Group, condition, label,
                F1_tempMid, F2_tempMid,
                TB_x_tempMid, TB_y_tempMid) %>%
  base::merge(., speakers, no.dups = F) %>%
  dplyr::group_by(DatabaseID) %>%
  dplyr::mutate(TB_x_tempMid = scale(TB_x_tempMid, center = T, scale = F),
                TB_y_tempMid = scale(TB_y_tempMid, center = T, scale = F)) %>%
  tidyr::pivot_longer(cols = F1_tempMid:TB_y_tempMid,
                      names_to = "Dimension",
                      values_to = "Value") %>%
  dplyr::group_by(Group, Sex, condition, Dimension, label) %>%
  dplyr::summarise(M = mean(Value, na.rm = T),
                   SD = sd(Value, na.rm = T)) %>%
  dplyr::group_by(condition, Dimension) %>%
  dplyr::mutate(CV = abs(SD / M * 100),
                M_z = scale(M),
                SD_z = scale(SD))

coordVariability <- variability_xyCoords %>%
  ggplot() +
  aes(x = Dimension,
      y = SD_z) +
  geom_boxplot() +
  facet_wrap(~Sex)
coordVariability

aVSA <- vsaMeasures %>%
  dplyr::filter(condition == "conv") %>%
  ggplot() +
  aes(x = F2_tempMid,
      y = F1_tempMid,
      label = label,
      color = Group,
      linetype = Group,
      fill = Group) +
  geom_point() +
  geom_polygon(fill = NA) +
  geom_label(color = "white",
             show.legend = FALSE) +
  scale_x_reverse() +
  scale_y_reverse() +
  facet_grid(~ Sex) +
  theme_minimal() +
  theme(aspect.ratio = 1) +
  
  # Labels
  labs(x = "F2",
       y = "F1",
       title = "Acoustic VSA") +
  
  # Color Palate
  scale_color_manual(values = c(color_HC,color_PD)) +
  scale_fill_manual(values = c(color_HC,color_PD))
aVSA

kVSA <- vsaMeasures %>%
  dplyr::filter(condition == "conv") %>%
  ggplot() +
  aes(x = TB_x_tempMid,
      y = TB_y_tempMid,
      label = label,
      color = Group,
      linetype = Group,
      fill = Group) +
  geom_point() +
  geom_polygon(
    fill=NA) +
  geom_label(color = "white",
             show.legend = FALSE) +
  scale_x_reverse() +
  facet_grid(~ Sex) +
  theme_minimal() +
  theme(aspect.ratio = 1) +
  
  # Labels
  labs(x = "Anterior-Posterior (x)",
       y = "Inferior-Superior (y)",
       title = "Kinematic VSA") +
  
  # Color Palate
  scale_color_manual(values = c(color_HC,color_PD)) +
  scale_fill_manual(values = c(color_HC,color_PD))
kVSA

vsaComparisons <- aVSA + kVSA + 
  plot_layout(guides = "collect",
              ncol = 1)
vsaComparisons

ggsave(filename = "S1_vsaComparison.png",
       path = "Data/Plots/Results/",
       plot = vsaComparisons,
       height = 3.5,
       width = 3,
       units = "in",
       scale = 1.7)
```


